Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&!function(){var innerText=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return innerText.get.call(this)},set:function(s){return innerText.set.call(this,s)}})}(),Array.isArray||(Array.isArray=function(arg){return"[object Array]"===Object.prototype.toString.call(arg)});var wysihtml5={version:"0.4.15",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};!function(factory,global){"function"==typeof define&&define.amd?define(factory):global.rangy=factory()}(function(){function isHostMethod(o,p){var t=typeof o[p];return t==FUNCTION||!(t!=OBJECT||!o[p])||"unknown"==t}function isHostObject(o,p){return!(typeof o[p]!=OBJECT||!o[p])}function isHostProperty(o,p){return typeof o[p]!=UNDEFINED}function createMultiplePropertyTest(testFunc){return function(o,props){for(var i=props.length;i--;)if(!testFunc(o,props[i]))return!1;return!0}}function isTextRange(range){return range&&areHostMethods(range,textRangeMethods)&&areHostProperties(range,textRangeProperties)}function getBody(doc){return isHostObject(doc,"body")?doc.body:doc.getElementsByTagName("body")[0]}function consoleLog(msg){isHostObject(window,"console")&&isHostMethod(window.console,"log")&&window.console.log(msg)}function alertOrLog(msg,shouldAlert){shouldAlert?window.alert(msg):consoleLog(msg)}function fail(reason){api.initialized=!0,api.supported=!1,alertOrLog("Rangy is not supported on this page in your browser. Reason: "+reason,api.config.alertOnFail)}function warn(msg){alertOrLog("Rangy warning: "+msg,api.config.alertOnWarn)}function getErrorDesc(ex){return ex.message||ex.description||String(ex)}function init(){if(!api.initialized){var testRange,implementsDomRange=!1,implementsTextRange=!1;isHostMethod(document,"createRange")&&(testRange=document.createRange(),areHostMethods(testRange,domRangeMethods)&&areHostProperties(testRange,domRangeProperties)&&(implementsDomRange=!0));var body=getBody(document);if(!body||"body"!=body.nodeName.toLowerCase())return void fail("No body element found");if(body&&isHostMethod(body,"createTextRange")&&(testRange=body.createTextRange(),isTextRange(testRange)&&(implementsTextRange=!0)),!implementsDomRange&&!implementsTextRange)return void fail("Neither Range nor TextRange are available");api.initialized=!0,api.features={implementsDomRange:implementsDomRange,implementsTextRange:implementsTextRange};var module,errorMessage;for(var moduleName in modules)(module=modules[moduleName])instanceof Module&&module.init(module,api);for(var i=0,len=initListeners.length;i<len;++i)try{initListeners[i](api)}catch(ex){errorMessage="Rangy init listener threw an exception. Continuing. Detail: "+getErrorDesc(ex),consoleLog(errorMessage)}}}function shim(win){win=win||window,init();for(var i=0,len=shimListeners.length;i<len;++i)shimListeners[i](win)}function Module(name,dependencies,initializer){this.name=name,this.dependencies=dependencies,this.initialized=!1,this.supported=!1,this.initializer=initializer}function createModule(isCore,name,dependencies,initFunc){var newModule=new Module(name,dependencies,function(module){if(!module.initialized){module.initialized=!0;try{initFunc(api,module),module.supported=!0}catch(ex){var errorMessage="Module '"+name+"' failed to load: "+getErrorDesc(ex);consoleLog(errorMessage)}}});modules[name]=newModule}function RangePrototype(){}function SelectionPrototype(){}var OBJECT="object",FUNCTION="function",UNDEFINED="undefined",domRangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],domRangeMethods=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],textRangeProperties=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],textRangeMethods=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],areHostMethods=createMultiplePropertyTest(isHostMethod),areHostObjects=createMultiplePropertyTest(isHostObject),areHostProperties=createMultiplePropertyTest(isHostProperty),modules={},api={version:"1.3alpha.20140804",initialized:!1,supported:!0,util:{isHostMethod:isHostMethod,isHostObject:isHostObject,isHostProperty:isHostProperty,areHostMethods:areHostMethods,areHostObjects:areHostObjects,areHostProperties:areHostProperties,isTextRange:isTextRange,getBody:getBody},features:{},modules:modules,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==UNDEFINED||rangyAutoInitialize}};api.fail=fail,api.warn=warn,{}.hasOwnProperty?api.util.extend=function(obj,props,deep){var o,p;for(var i in props)props.hasOwnProperty(i)&&(o=obj[i],p=props[i],deep&&null!==o&&"object"==typeof o&&null!==p&&"object"==typeof p&&api.util.extend(o,p,!0),obj[i]=p);return props.hasOwnProperty("toString")&&(obj.toString=props.toString),obj}:fail("hasOwnProperty not supported"),function(){var el=document.createElement("div");el.appendChild(document.createElement("span"));var toArray,slice=[].slice;try{1==slice.call(el.childNodes,0)[0].nodeType&&(toArray=function(arrayLike){return slice.call(arrayLike,0)})}catch(e){}toArray||(toArray=function(arrayLike){for(var arr=[],i=0,len=arrayLike.length;i<len;++i)arr[i]=arrayLike[i];return arr}),api.util.toArray=toArray}();var addListener;isHostMethod(document,"addEventListener")?addListener=function(obj,eventType,listener){obj.addEventListener(eventType,listener,!1)}:isHostMethod(document,"attachEvent")?addListener=function(obj,eventType,listener){obj.attachEvent("on"+eventType,listener)}:fail("Document does not have required addEventListener or attachEvent method"),api.util.addListener=addListener;var initListeners=[];api.init=init,api.addInitListener=function(listener){api.initialized?listener(api):initListeners.push(listener)};var shimListeners=[];api.addShimListener=function(listener){shimListeners.push(listener)},api.shim=api.createMissingNativeApi=shim,Module.prototype={init:function(){for(var requiredModule,moduleName,requiredModuleNames=this.dependencies||[],i=0,len=requiredModuleNames.length;i<len;++i){if(moduleName=requiredModuleNames[i],requiredModule=modules[moduleName],!(requiredModule&&requiredModule instanceof Module))throw new Error("required module '"+moduleName+"' not found");if(requiredModule.init(),!requiredModule.supported)throw new Error("required module '"+moduleName+"' not supported")}this.initializer(this)},fail:function(reason){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+reason)},warn:function(msg){api.warn("Module "+this.name+": "+msg)},deprecationNotice:function(deprecated,replacement){api.warn("DEPRECATED: "+deprecated+" in module "+this.name+"is deprecated. Please use "+replacement+" instead")},createError:function(msg){return new Error("Error in Rangy "+this.name+" module: "+msg)}},api.createModule=function(name){var initFunc,dependencies;2==arguments.length?(initFunc=arguments[1],dependencies=[]):(initFunc=arguments[2],dependencies=arguments[1]);var module=createModule(!1,name,dependencies,initFunc);api.initialized&&module.init()},api.createCoreModule=function(name,dependencies,initFunc){createModule(!0,name,dependencies,initFunc)},api.RangePrototype=RangePrototype,api.rangePrototype=new RangePrototype,api.selectionPrototype=new SelectionPrototype;var docReady=!1,loadHandler=function(e){docReady||(docReady=!0,!api.initialized&&api.config.autoInitialize&&init())};return typeof window==UNDEFINED?void fail("No window found"):typeof document==UNDEFINED?void fail("No document found"):(isHostMethod(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",loadHandler,!1),addListener(window,"load",loadHandler),api.createCoreModule("DomUtil",[],function(api,module){function isHtmlNamespace(node){var ns;return typeof node.namespaceURI==UNDEF||null===(ns=node.namespaceURI)||"http://www.w3.org/1999/xhtml"==ns}function parentElement(node){var parent=node.parentNode;return 1==parent.nodeType?parent:null}function getNodeIndex(node){for(var i=0;node=node.previousSibling;)++i;return i}function getNodeLength(node){switch(node.nodeType){case 7:case 10:return 0;case 3:case 8:return node.length;default:return node.childNodes.length}}function getCommonAncestor(node1,node2){var n,ancestors=[];for(n=node1;n;n=n.parentNode)ancestors.push(n);for(n=node2;n;n=n.parentNode)if(arrayContains(ancestors,n))return n;return null}function isAncestorOf(ancestor,descendant,selfIsAncestor){for(var n=selfIsAncestor?descendant:descendant.parentNode;n;){if(n===ancestor)return!0;n=n.parentNode}return!1}function isOrIsAncestorOf(ancestor,descendant){return isAncestorOf(ancestor,descendant,!0)}function getClosestAncestorIn(node,ancestor,selfIsAncestor){for(var p,n=selfIsAncestor?node:node.parentNode;n;){if(p=n.parentNode,p===ancestor)return n;n=p}return null}function isCharacterDataNode(node){var t=node.nodeType;return 3==t||4==t||8==t}function isTextOrCommentNode(node){if(!node)return!1;var t=node.nodeType;return 3==t||8==t}function insertAfter(node,precedingNode){var nextNode=precedingNode.nextSibling,parent=precedingNode.parentNode;return nextNode?parent.insertBefore(node,nextNode):parent.appendChild(node),node}function splitDataNode(node,index,positionsToPreserve){var newNode=node.cloneNode(!1);if(newNode.deleteData(0,index),node.deleteData(index,node.length-index),insertAfter(newNode,node),positionsToPreserve)for(var position,i=0;position=positionsToPreserve[i++];)position.node==node&&position.offset>index?(position.node=newNode,position.offset-=index):position.node==node.parentNode&&position.offset>getNodeIndex(node)&&++position.offset;return newNode}function getDocument(node){if(9==node.nodeType)return node;if(typeof node.ownerDocument!=UNDEF)return node.ownerDocument;if(typeof node.document!=UNDEF)return node.document;if(node.parentNode)return getDocument(node.parentNode);throw module.createError("getDocument: no document found for node")}function getWindow(node){var doc=getDocument(node);if(typeof doc.defaultView!=UNDEF)return doc.defaultView;if(typeof doc.parentWindow!=UNDEF)return doc.parentWindow;throw module.createError("Cannot get a window object for node")}function getIframeDocument(iframeEl){if(typeof iframeEl.contentDocument!=UNDEF)return iframeEl.contentDocument;if(typeof iframeEl.contentWindow!=UNDEF)return iframeEl.contentWindow.document;throw module.createError("getIframeDocument: No Document object found for iframe element")}function getIframeWindow(iframeEl){if(typeof iframeEl.contentWindow!=UNDEF)return iframeEl.contentWindow;if(typeof iframeEl.contentDocument!=UNDEF)return iframeEl.contentDocument.defaultView;throw module.createError("getIframeWindow: No Window object found for iframe element")}function isWindow(obj){return obj&&util.isHostMethod(obj,"setTimeout")&&util.isHostObject(obj,"document")}function getContentDocument(obj,module,methodName){var doc;if(obj?util.isHostProperty(obj,"nodeType")?doc=1==obj.nodeType&&"iframe"==obj.tagName.toLowerCase()?getIframeDocument(obj):getDocument(obj):isWindow(obj)&&(doc=obj.document):doc=document,!doc)throw module.createError(methodName+"(): Parameter must be a Window object or DOM node");return doc}function getRootContainer(node){for(var parent;parent=node.parentNode;)node=parent;return node}function comparePoints(nodeA,offsetA,nodeB,offsetB){var nodeC,root,childA,childB,n;if(nodeA==nodeB)return offsetA===offsetB?0:offsetA<offsetB?-1:1;if(nodeC=getClosestAncestorIn(nodeB,nodeA,!0))return offsetA<=getNodeIndex(nodeC)?-1:1;if(nodeC=getClosestAncestorIn(nodeA,nodeB,!0))return getNodeIndex(nodeC)<offsetB?-1:1;if(root=getCommonAncestor(nodeA,nodeB),!root)throw new Error("comparePoints error: nodes have no common ancestor");if(childA=nodeA===root?root:getClosestAncestorIn(nodeA,root,!0),childB=nodeB===root?root:getClosestAncestorIn(nodeB,root,!0),childA===childB)throw module.createError("comparePoints got to case 4 and childA and childB are the same!");for(n=root.firstChild;n;){if(n===childA)return-1;if(n===childB)return 1;n=n.nextSibling}}function isBrokenNode(node){var n;try{return n=node.parentNode,!1}catch(e){return!0}}function inspectNode(node){if(!node)return"[No node]";if(crashyTextNodes&&isBrokenNode(node))return"[Broken node]";if(isCharacterDataNode(node))return'"'+node.data+'"';if(1==node.nodeType){var idAttr=node.id?' id="'+node.id+'"':"";return"<"+node.nodeName+idAttr+">[index:"+getNodeIndex(node)+",length:"+node.childNodes.length+"]["+(node.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return node.nodeName}function fragmentFromNodeChildren(node){for(var child,fragment=getDocument(node).createDocumentFragment();child=node.firstChild;)fragment.appendChild(child);return fragment}function NodeIterator(root){this.root=root,this._next=root}function createIterator(root){return new NodeIterator(root)}function DomPosition(node,offset){this.node=node,this.offset=offset}function DOMException(codeName){this.code=this[codeName],this.codeName=codeName,this.message="DOMException: "+this.codeName}var UNDEF="undefined",util=api.util;util.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||module.fail("document missing a Node creation method"),util.isHostMethod(document,"getElementsByTagName")||module.fail("document missing getElementsByTagName method");var el=document.createElement("div");util.areHostMethods(el,["insertBefore","appendChild","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"]))||module.fail("Incomplete Element implementation"),util.isHostProperty(el,"innerHTML")||module.fail("Element is missing innerHTML property");var textNode=document.createTextNode("test");util.areHostMethods(textNode,["splitText","deleteData","insertData","appendData","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"])||!util.areHostProperties(textNode,["data"]))||module.fail("Incomplete Text Node implementation");var arrayContains=function(arr,val){for(var i=arr.length;i--;)if(arr[i]===val)return!0;return!1},crashyTextNodes=!1;!function(){var el=document.createElement("b");el.innerHTML="1";var textNode=el.firstChild;el.innerHTML="<br>",crashyTextNodes=isBrokenNode(textNode),api.features.crashyTextNodes=crashyTextNodes}();var getComputedStyleProperty;typeof window.getComputedStyle!=UNDEF?getComputedStyleProperty=function(el,propName){return getWindow(el).getComputedStyle(el,null)[propName]}:typeof document.documentElement.currentStyle!=UNDEF?getComputedStyleProperty=function(el,propName){return el.currentStyle[propName]}:module.fail("No means of obtaining computed style properties found"),NodeIterator.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var child,next,n=this._current=this._next;if(this._current)if(child=n.firstChild)this._next=child;else{for(next=null;n!==this.root&&!(next=n.nextSibling);)n=n.parentNode;this._next=next}return this._current},detach:function(){this._current=this._next=this.root=null}},DomPosition.prototype={equals:function(pos){return!!pos&&this.node===pos.node&&this.offset==pos.offset},inspect:function(){return"[DomPosition("+inspectNode(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},DOMException.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},DOMException.prototype.toString=function(){return this.message},api.dom={arrayContains:arrayContains,isHtmlNamespace:isHtmlNamespace,parentElement:parentElement,getNodeIndex:getNodeIndex,getNodeLength:getNodeLength,getCommonAncestor:getCommonAncestor,isAncestorOf:isAncestorOf,isOrIsAncestorOf:isOrIsAncestorOf,getClosestAncestorIn:getClosestAncestorIn,isCharacterDataNode:isCharacterDataNode,isTextOrCommentNode:isTextOrCommentNode,insertAfter:insertAfter,splitDataNode:splitDataNode,getDocument:getDocument,getWindow:getWindow,getIframeWindow:getIframeWindow,getIframeDocument:getIframeDocument,getBody:util.getBody,isWindow:isWindow,getContentDocument:getContentDocument,getRootContainer:getRootContainer,comparePoints:comparePoints,isBrokenNode:isBrokenNode,inspectNode:inspectNode,getComputedStyleProperty:getComputedStyleProperty,fragmentFromNodeChildren:fragmentFromNodeChildren,createIterator:createIterator,DomPosition:DomPosition},api.DOMException=DOMException}),api.createCoreModule("DomRange",["DomUtil"],function(api,module){function isNonTextPartiallySelected(node,range){return 3!=node.nodeType&&(isOrIsAncestorOf(node,range.startContainer)||isOrIsAncestorOf(node,range.endContainer))}function getRangeDocument(range){return range.document||getDocument(range.startContainer)}function getBoundaryBeforeNode(node){return new DomPosition(node.parentNode,getNodeIndex(node))}function getBoundaryAfterNode(node){return new DomPosition(node.parentNode,getNodeIndex(node)+1)}function insertNodeAtPosition(node,n,o){var firstNodeInserted=11==node.nodeType?node.firstChild:node;return isCharacterDataNode(n)?o==n.length?dom.insertAfter(node,n):n.parentNode.insertBefore(node,0==o?n:splitDataNode(n,o)):o>=n.childNodes.length?n.appendChild(node):n.insertBefore(node,n.childNodes[o]),firstNodeInserted}function rangesIntersect(rangeA,rangeB,touchingIsIntersecting){if(assertRangeValid(rangeA),assertRangeValid(rangeB),getRangeDocument(rangeB)!=getRangeDocument(rangeA))throw new DOMException("WRONG_DOCUMENT_ERR");var startComparison=comparePoints(rangeA.startContainer,rangeA.startOffset,rangeB.endContainer,rangeB.endOffset),endComparison=comparePoints(rangeA.endContainer,rangeA.endOffset,rangeB.startContainer,rangeB.startOffset);return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0}function cloneSubtree(iterator){for(var partiallySelected,node,subIterator,frag=getRangeDocument(iterator.range).createDocumentFragment();node=iterator.next();){if(partiallySelected=iterator.isPartiallySelectedSubtree(),node=node.cloneNode(!partiallySelected),partiallySelected&&(subIterator=iterator.getSubtreeIterator(),node.appendChild(cloneSubtree(subIterator)),subIterator.detach()),10==node.nodeType)throw new DOMException("HIERARCHY_REQUEST_ERR");frag.appendChild(node)}return frag}function iterateSubtree(rangeIterator,func,iteratorState){var it,n;iteratorState=iteratorState||{stop:!1};for(var node,subRangeIterator;node=rangeIterator.next();)if(rangeIterator.isPartiallySelectedSubtree()){if(func(node)===!1)return void(iteratorState.stop=!0);if(subRangeIterator=rangeIterator.getSubtreeIterator(),iterateSubtree(subRangeIterator,func,iteratorState),subRangeIterator.detach(),iteratorState.stop)return}else for(it=dom.createIterator(node);n=it.next();)if(func(n)===!1)return void(iteratorState.stop=!0)}function deleteSubtree(iterator){for(var subIterator;iterator.next();)iterator.isPartiallySelectedSubtree()?(subIterator=iterator.getSubtreeIterator(),deleteSubtree(subIterator),subIterator.detach()):iterator.remove()}function extractSubtree(iterator){for(var node,subIterator,frag=getRangeDocument(iterator.range).createDocumentFragment();node=iterator.next();){if(iterator.isPartiallySelectedSubtree()?(node=node.cloneNode(!1),subIterator=iterator.getSubtreeIterator(),node.appendChild(extractSubtree(subIterator)),subIterator.detach()):iterator.remove(),10==node.nodeType)throw new DOMException("HIERARCHY_REQUEST_ERR");frag.appendChild(node)}return frag}function getNodesInRange(range,nodeTypes,filter){var regex,filterNodeTypes=!(!nodeTypes||!nodeTypes.length),filterExists=!!filter;filterNodeTypes&&(regex=new RegExp("^("+nodeTypes.join("|")+")$"));var nodes=[];return iterateSubtree(new RangeIterator(range,(!1)),function(node){if((!filterNodeTypes||regex.test(node.nodeType))&&(!filterExists||filter(node))){var sc=range.startContainer;if(node!=sc||!isCharacterDataNode(sc)||range.startOffset!=sc.length){var ec=range.endContainer;node==ec&&isCharacterDataNode(ec)&&0==range.endOffset||nodes.push(node)}}}),nodes}function inspect(range){var name="undefined"==typeof range.getName?"Range":range.getName();return"["+name+"("+dom.inspectNode(range.startContainer)+":"+range.startOffset+", "+dom.inspectNode(range.endContainer)+":"+range.endOffset+")]"}function RangeIterator(range,clonePartiallySelectedTextNodes){if(this.range=range,this.clonePartiallySelectedTextNodes=clonePartiallySelectedTextNodes,!range.collapsed){this.sc=range.startContainer,this.so=range.startOffset,this.ec=range.endContainer,this.eo=range.endOffset;var root=range.commonAncestorContainer;this.sc===this.ec&&isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==root||isCharacterDataNode(this.sc)?getClosestAncestorIn(this.sc,root,!0):this.sc.childNodes[this.so],this._last=this.ec!==root||isCharacterDataNode(this.ec)?getClosestAncestorIn(this.ec,root,!0):this.ec.childNodes[this.eo-1])}}function createAncestorFinder(nodeTypes){return function(node,selfIsAncestor){for(var t,n=selfIsAncestor?node:node.parentNode;n;){if(t=n.nodeType,arrayContains(nodeTypes,t))return n;n=n.parentNode}return null}}function assertNoDocTypeNotationEntityAncestor(node,allowSelf){if(getDocTypeNotationEntityAncestor(node,allowSelf))throw new DOMException("INVALID_NODE_TYPE_ERR")}function assertValidNodeType(node,invalidTypes){if(!arrayContains(invalidTypes,node.nodeType))throw new DOMException("INVALID_NODE_TYPE_ERR")}function assertValidOffset(node,offset){if(offset<0||offset>(isCharacterDataNode(node)?node.length:node.childNodes.length))throw new DOMException("INDEX_SIZE_ERR")}function assertSameDocumentOrFragment(node1,node2){if(getDocumentOrFragmentContainer(node1,!0)!==getDocumentOrFragmentContainer(node2,!0))throw new DOMException("WRONG_DOCUMENT_ERR")}function assertNodeNotReadOnly(node){if(getReadonlyAncestor(node,!0))throw new DOMException("NO_MODIFICATION_ALLOWED_ERR")}function assertNode(node,codeName){if(!node)throw new DOMException(codeName)}function isOrphan(node){return crashyTextNodes&&dom.isBrokenNode(node)||!arrayContains(rootContainerNodeTypes,node.nodeType)&&!getDocumentOrFragmentContainer(node,!0)}function isValidOffset(node,offset){return offset<=(isCharacterDataNode(node)?node.length:node.childNodes.length)}function isRangeValid(range){return!!range.startContainer&&!!range.endContainer&&!isOrphan(range.startContainer)&&!isOrphan(range.endContainer)&&isValidOffset(range.startContainer,range.startOffset)&&isValidOffset(range.endContainer,range.endOffset)}function assertRangeValid(range){if(!isRangeValid(range))throw new Error("Range error: Range is no longer valid after DOM mutation ("+range.inspect()+")")}function splitRangeBoundaries(range,positionsToPreserve){assertRangeValid(range);var sc=range.startContainer,so=range.startOffset,ec=range.endContainer,eo=range.endOffset,startEndSame=sc===ec;isCharacterDataNode(ec)&&eo>0&&eo<ec.length&&splitDataNode(ec,eo,positionsToPreserve),isCharacterDataNode(sc)&&so>0&&so<sc.length&&(sc=splitDataNode(sc,so,positionsToPreserve),startEndSame?(eo-=so,ec=sc):ec==sc.parentNode&&eo>=getNodeIndex(sc)&&eo++,so=0),range.setStartAndEnd(sc,so,ec,eo)}function rangeToHtml(range){assertRangeValid(range);var container=range.commonAncestorContainer.parentNode.cloneNode(!1);return container.appendChild(range.cloneContents()),container.innerHTML}function copyComparisonConstantsToObject(obj){obj.START_TO_START=s2s,obj.START_TO_END=s2e,obj.END_TO_END=e2e,obj.END_TO_START=e2s,obj.NODE_BEFORE=n_b,obj.NODE_AFTER=n_a,obj.NODE_BEFORE_AND_AFTER=n_b_a,obj.NODE_INSIDE=n_i}function copyComparisonConstants(constructor){copyComparisonConstantsToObject(constructor),copyComparisonConstantsToObject(constructor.prototype)}function createRangeContentRemover(remover,boundaryUpdater){return function(){assertRangeValid(this);var node,boundary,sc=this.startContainer,so=this.startOffset,root=this.commonAncestorContainer,iterator=new RangeIterator(this,(!0));sc!==root&&(node=getClosestAncestorIn(sc,root,!0),boundary=getBoundaryAfterNode(node),sc=boundary.node,so=boundary.offset),iterateSubtree(iterator,assertNodeNotReadOnly),iterator.reset();var returnValue=remover(iterator);return iterator.detach(),boundaryUpdater(this,sc,so,sc,so),returnValue}}function createPrototypeRange(constructor,boundaryUpdater){function createBeforeAfterNodeSetter(isBefore,isStart){return function(node){assertValidNodeType(node,beforeAfterNodeTypes),assertValidNodeType(getRootContainer(node),rootContainerNodeTypes);var boundary=(isBefore?getBoundaryBeforeNode:getBoundaryAfterNode)(node);(isStart?setRangeStart:setRangeEnd)(this,boundary.node,boundary.offset)}}function setRangeStart(range,node,offset){var ec=range.endContainer,eo=range.endOffset;node===range.startContainer&&offset===range.startOffset||(getRootContainer(node)==getRootContainer(ec)&&1!=comparePoints(node,offset,ec,eo)||(ec=node,eo=offset),boundaryUpdater(range,node,offset,ec,eo))}function setRangeEnd(range,node,offset){var sc=range.startContainer,so=range.startOffset;node===range.endContainer&&offset===range.endOffset||(getRootContainer(node)==getRootContainer(sc)&&comparePoints(node,offset,sc,so)!=-1||(sc=node,so=offset),boundaryUpdater(range,sc,so,node,offset))}var F=function(){};F.prototype=api.rangePrototype,constructor.prototype=new F,util.extend(constructor.prototype,{setStart:function(node,offset){assertNoDocTypeNotationEntityAncestor(node,!0),assertValidOffset(node,offset),setRangeStart(this,node,offset)},setEnd:function(node,offset){assertNoDocTypeNotationEntityAncestor(node,!0),assertValidOffset(node,offset),setRangeEnd(this,node,offset)},setStartAndEnd:function(){var args=arguments,sc=args[0],so=args[1],ec=sc,eo=so;switch(args.length){case 3:eo=args[2];break;case 4:ec=args[2],eo=args[3]}boundaryUpdater(this,sc,so,ec,eo)},setBoundary:function(node,offset,isStart){this["set"+(isStart?"Start":"End")](node,offset)},setStartBefore:createBeforeAfterNodeSetter(!0,!0),setStartAfter:createBeforeAfterNodeSetter(!1,!0),setEndBefore:createBeforeAfterNodeSetter(!0,!1),setEndAfter:createBeforeAfterNodeSetter(!1,!1),collapse:function(isStart){assertRangeValid(this),isStart?boundaryUpdater(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):boundaryUpdater(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(node){assertNoDocTypeNotationEntityAncestor(node,!0),boundaryUpdater(this,node,0,node,getNodeLength(node))},selectNode:function(node){assertNoDocTypeNotationEntityAncestor(node,!1),assertValidNodeType(node,beforeAfterNodeTypes);var start=getBoundaryBeforeNode(node),end=getBoundaryAfterNode(node);boundaryUpdater(this,start.node,start.offset,end.node,end.offset)},extractContents:createRangeContentRemover(extractSubtree,boundaryUpdater),deleteContents:createRangeContentRemover(deleteSubtree,boundaryUpdater),canSurroundContents:function(){assertRangeValid(this),assertNodeNotReadOnly(this.startContainer),assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,(!0)),boundariesInvalid=iterator._first&&isNonTextPartiallySelected(iterator._first,this)||iterator._last&&isNonTextPartiallySelected(iterator._last,this);return iterator.detach(),!boundariesInvalid},splitBoundaries:function(){splitRangeBoundaries(this)},splitBoundariesPreservingPositions:function(positionsToPreserve){splitRangeBoundaries(this,positionsToPreserve)},normalizeBoundaries:function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset,mergeForward=function(node){var sibling=node.nextSibling;sibling&&sibling.nodeType==node.nodeType&&(ec=node,eo=node.length,node.appendData(sibling.data),sibling.parentNode.removeChild(sibling))},mergeBackward=function(node){var sibling=node.previousSibling;if(sibling&&sibling.nodeType==node.nodeType){sc=node;var nodeLength=node.length;if(so=sibling.length,node.insertData(0,sibling.data),sibling.parentNode.removeChild(sibling),sc==ec)eo+=so,ec=sc;else if(ec==node.parentNode){var nodeIndex=getNodeIndex(node);eo==nodeIndex?(ec=node,eo=nodeLength):eo>nodeIndex&&eo--}}},normalizeStart=!0;if(isCharacterDataNode(ec))ec.length==eo&&mergeForward(ec);else{if(eo>0){var endNode=ec.childNodes[eo-1];endNode&&isCharacterDataNode(endNode)&&mergeForward(endNode)}normalizeStart=!this.collapsed}if(normalizeStart){if(isCharacterDataNode(sc))0==so&&mergeBackward(sc);else if(so<sc.childNodes.length){var startNode=sc.childNodes[so];startNode&&isCharacterDataNode(startNode)&&mergeBackward(startNode)}}else sc=ec,so=eo;boundaryUpdater(this,sc,so,ec,eo)},collapseToPoint:function(node,offset){assertNoDocTypeNotationEntityAncestor(node,!0),assertValidOffset(node,offset),this.setStartAndEnd(node,offset)}}),copyComparisonConstants(constructor)}function updateCollapsedAndCommonAncestor(range){range.collapsed=range.startContainer===range.endContainer&&range.startOffset===range.endOffset,range.commonAncestorContainer=range.collapsed?range.startContainer:dom.getCommonAncestor(range.startContainer,range.endContainer)}function updateBoundaries(range,startContainer,startOffset,endContainer,endOffset){range.startContainer=startContainer,range.startOffset=startOffset,range.endContainer=endContainer,range.endOffset=endOffset,range.document=dom.getDocument(startContainer),updateCollapsedAndCommonAncestor(range)}function Range(doc){this.startContainer=doc,this.startOffset=0,this.endContainer=doc,this.endOffset=0,this.document=doc,updateCollapsedAndCommonAncestor(this)}var dom=api.dom,util=api.util,DomPosition=dom.DomPosition,DOMException=api.DOMException,isCharacterDataNode=dom.isCharacterDataNode,getNodeIndex=dom.getNodeIndex,isOrIsAncestorOf=dom.isOrIsAncestorOf,getDocument=dom.getDocument,comparePoints=dom.comparePoints,splitDataNode=dom.splitDataNode,getClosestAncestorIn=dom.getClosestAncestorIn,getNodeLength=dom.getNodeLength,arrayContains=dom.arrayContains,getRootContainer=dom.getRootContainer,crashyTextNodes=api.features.crashyTextNodes;RangeIterator.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var current=this._current=this._next;return current&&(this._next=current!==this._last?current.nextSibling:null,isCharacterDataNode(current)&&this.clonePartiallySelectedTextNodes&&(current===this.ec&&(current=current.cloneNode(!0)).deleteData(this.eo,current.length-this.eo),this._current===this.sc&&(current=current.cloneNode(!0)).deleteData(0,this.so))),current},remove:function(){var start,end,current=this._current;!isCharacterDataNode(current)||current!==this.sc&&current!==this.ec?current.parentNode&&current.parentNode.removeChild(current):(start=current===this.sc?this.so:0,end=current===this.ec?this.eo:current.length,start!=end&&current.deleteData(start,end-start))},isPartiallySelectedSubtree:function(){var current=this._current;return isNonTextPartiallySelected(current,this.range)},getSubtreeIterator:function(){var subRange;if(this.isSingleCharacterDataNode)subRange=this.range.cloneRange(),subRange.collapse(!1);else{subRange=new Range(getRangeDocument(this.range));var current=this._current,startContainer=current,startOffset=0,endContainer=current,endOffset=getNodeLength(current);isOrIsAncestorOf(current,this.sc)&&(startContainer=this.sc,startOffset=this.so),
isOrIsAncestorOf(current,this.ec)&&(endContainer=this.ec,endOffset=this.eo),updateBoundaries(subRange,startContainer,startOffset,endContainer,endOffset)}return new RangeIterator(subRange,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var beforeAfterNodeTypes=[1,3,4,5,7,8,10],rootContainerNodeTypes=[2,9,11],readonlyNodeTypes=[5,6,10,12],insertableNodeTypes=[1,3,4,5,7,8,10,11],surroundNodeTypes=[1,3,4,5,7,8],getDocumentOrFragmentContainer=createAncestorFinder([9,11]),getReadonlyAncestor=createAncestorFinder(readonlyNodeTypes),getDocTypeNotationEntityAncestor=createAncestorFinder([6,10,12]),styleEl=document.createElement("style"),htmlParsingConforms=!1;try{styleEl.innerHTML="<b>x</b>",htmlParsingConforms=3==styleEl.firstChild.nodeType}catch(e){}api.features.htmlParsingConforms=htmlParsingConforms;var createContextualFragment=htmlParsingConforms?function(fragmentStr){var node=this.startContainer,doc=getDocument(node);if(!node)throw new DOMException("INVALID_STATE_ERR");var el=null;return 1==node.nodeType?el=node:isCharacterDataNode(node)&&(el=dom.parentElement(node)),el=null===el||"HTML"==el.nodeName&&dom.isHtmlNamespace(getDocument(el).documentElement)&&dom.isHtmlNamespace(el)?doc.createElement("body"):el.cloneNode(!1),el.innerHTML=fragmentStr,dom.fragmentFromNodeChildren(el)}:function(fragmentStr){var doc=getRangeDocument(this),el=doc.createElement("body");return el.innerHTML=fragmentStr,dom.fragmentFromNodeChildren(el)},rangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],s2s=0,s2e=1,e2e=2,e2s=3,n_b=0,n_a=1,n_b_a=2,n_i=3;util.extend(api.rangePrototype,{compareBoundaryPoints:function(how,range){assertRangeValid(this),assertSameDocumentOrFragment(this.startContainer,range.startContainer);var nodeA,offsetA,nodeB,offsetB,prefixA=how==e2s||how==s2s?"start":"end",prefixB=how==s2e||how==s2s?"start":"end";return nodeA=this[prefixA+"Container"],offsetA=this[prefixA+"Offset"],nodeB=range[prefixB+"Container"],offsetB=range[prefixB+"Offset"],comparePoints(nodeA,offsetA,nodeB,offsetB)},insertNode:function(node){if(assertRangeValid(this),assertValidNodeType(node,insertableNodeTypes),assertNodeNotReadOnly(this.startContainer),isOrIsAncestorOf(node,this.startContainer))throw new DOMException("HIERARCHY_REQUEST_ERR");var firstNodeInserted=insertNodeAtPosition(node,this.startContainer,this.startOffset);this.setStartBefore(firstNodeInserted)},cloneContents:function(){assertRangeValid(this);var clone,frag;if(this.collapsed)return getRangeDocument(this).createDocumentFragment();if(this.startContainer===this.endContainer&&isCharacterDataNode(this.startContainer))return clone=this.startContainer.cloneNode(!0),clone.data=clone.data.slice(this.startOffset,this.endOffset),frag=getRangeDocument(this).createDocumentFragment(),frag.appendChild(clone),frag;var iterator=new RangeIterator(this,(!0));return clone=cloneSubtree(iterator),iterator.detach(),clone},canSurroundContents:function(){assertRangeValid(this),assertNodeNotReadOnly(this.startContainer),assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,(!0)),boundariesInvalid=iterator._first&&isNonTextPartiallySelected(iterator._first,this)||iterator._last&&isNonTextPartiallySelected(iterator._last,this);return iterator.detach(),!boundariesInvalid},surroundContents:function(node){if(assertValidNodeType(node,surroundNodeTypes),!this.canSurroundContents())throw new DOMException("INVALID_STATE_ERR");var content=this.extractContents();if(node.hasChildNodes())for(;node.lastChild;)node.removeChild(node.lastChild);insertNodeAtPosition(node,this.startContainer,this.startOffset),node.appendChild(content),this.selectNode(node)},cloneRange:function(){assertRangeValid(this);for(var prop,range=new Range(getRangeDocument(this)),i=rangeProperties.length;i--;)prop=rangeProperties[i],range[prop]=this[prop];return range},toString:function(){assertRangeValid(this);var sc=this.startContainer;if(sc===this.endContainer&&isCharacterDataNode(sc))return 3==sc.nodeType||4==sc.nodeType?sc.data.slice(this.startOffset,this.endOffset):"";var textParts=[],iterator=new RangeIterator(this,(!0));return iterateSubtree(iterator,function(node){3!=node.nodeType&&4!=node.nodeType||textParts.push(node.data)}),iterator.detach(),textParts.join("")},compareNode:function(node){assertRangeValid(this);var parent=node.parentNode,nodeIndex=getNodeIndex(node);if(!parent)throw new DOMException("NOT_FOUND_ERR");var startComparison=this.comparePoint(parent,nodeIndex),endComparison=this.comparePoint(parent,nodeIndex+1);return startComparison<0?endComparison>0?n_b_a:n_b:endComparison>0?n_a:n_i},comparePoint:function(node,offset){return assertRangeValid(this),assertNode(node,"HIERARCHY_REQUEST_ERR"),assertSameDocumentOrFragment(node,this.startContainer),comparePoints(node,offset,this.startContainer,this.startOffset)<0?-1:comparePoints(node,offset,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:createContextualFragment,toHtml:function(){return rangeToHtml(this)},intersectsNode:function(node,touchingIsIntersecting){if(assertRangeValid(this),assertNode(node,"NOT_FOUND_ERR"),getDocument(node)!==getRangeDocument(this))return!1;var parent=node.parentNode,offset=getNodeIndex(node);assertNode(parent,"NOT_FOUND_ERR");var startComparison=comparePoints(parent,offset,this.endContainer,this.endOffset),endComparison=comparePoints(parent,offset+1,this.startContainer,this.startOffset);return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0},isPointInRange:function(node,offset){return assertRangeValid(this),assertNode(node,"HIERARCHY_REQUEST_ERR"),assertSameDocumentOrFragment(node,this.startContainer),comparePoints(node,offset,this.startContainer,this.startOffset)>=0&&comparePoints(node,offset,this.endContainer,this.endOffset)<=0},intersectsRange:function(range){return rangesIntersect(this,range,!1)},intersectsOrTouchesRange:function(range){return rangesIntersect(this,range,!0)},intersection:function(range){if(this.intersectsRange(range)){var startComparison=comparePoints(this.startContainer,this.startOffset,range.startContainer,range.startOffset),endComparison=comparePoints(this.endContainer,this.endOffset,range.endContainer,range.endOffset),intersectionRange=this.cloneRange();return startComparison==-1&&intersectionRange.setStart(range.startContainer,range.startOffset),1==endComparison&&intersectionRange.setEnd(range.endContainer,range.endOffset),intersectionRange}return null},union:function(range){if(this.intersectsOrTouchesRange(range)){var unionRange=this.cloneRange();return comparePoints(range.startContainer,range.startOffset,this.startContainer,this.startOffset)==-1&&unionRange.setStart(range.startContainer,range.startOffset),1==comparePoints(range.endContainer,range.endOffset,this.endContainer,this.endOffset)&&unionRange.setEnd(range.endContainer,range.endOffset),unionRange}throw new DOMException("Ranges do not intersect")},containsNode:function(node,allowPartial){return allowPartial?this.intersectsNode(node,!1):this.compareNode(node)==n_i},containsNodeContents:function(node){return this.comparePoint(node,0)>=0&&this.comparePoint(node,getNodeLength(node))<=0},containsRange:function(range){var intersection=this.intersection(range);return null!==intersection&&range.equals(intersection)},containsNodeText:function(node){var nodeRange=this.cloneRange();nodeRange.selectNode(node);var textNodes=nodeRange.getNodes([3]);if(textNodes.length>0){nodeRange.setStart(textNodes[0],0);var lastTextNode=textNodes.pop();return nodeRange.setEnd(lastTextNode,lastTextNode.length),this.containsRange(nodeRange)}return this.containsNodeContents(node)},getNodes:function(nodeTypes,filter){return assertRangeValid(this),getNodesInRange(this,nodeTypes,filter)},getDocument:function(){return getRangeDocument(this)},collapseBefore:function(node){this.setEndBefore(node),this.collapse(!1)},collapseAfter:function(node){this.setStartAfter(node),this.collapse(!0)},getBookmark:function(containerNode){var doc=getRangeDocument(this),preSelectionRange=api.createRange(doc);containerNode=containerNode||dom.getBody(doc),preSelectionRange.selectNodeContents(containerNode);var range=this.intersection(preSelectionRange),start=0,end=0;return range&&(preSelectionRange.setEnd(range.startContainer,range.startOffset),start=preSelectionRange.toString().length,end=start+range.toString().length),{start:start,end:end,containerNode:containerNode}},moveToBookmark:function(bookmark){var containerNode=bookmark.containerNode,charIndex=0;this.setStart(containerNode,0),this.collapse(!0);for(var node,nextCharIndex,i,childNodes,nodeStack=[containerNode],foundStart=!1,stop=!1;!stop&&(node=nodeStack.pop());)if(3==node.nodeType)nextCharIndex=charIndex+node.length,!foundStart&&bookmark.start>=charIndex&&bookmark.start<=nextCharIndex&&(this.setStart(node,bookmark.start-charIndex),foundStart=!0),foundStart&&bookmark.end>=charIndex&&bookmark.end<=nextCharIndex&&(this.setEnd(node,bookmark.end-charIndex),stop=!0),charIndex=nextCharIndex;else for(childNodes=node.childNodes,i=childNodes.length;i--;)nodeStack.push(childNodes[i])},getName:function(){return"DomRange"},equals:function(range){return Range.rangesEqual(this,range)},isValid:function(){return isRangeValid(this)},inspect:function(){return inspect(this)},detach:function(){}}),createPrototypeRange(Range,updateBoundaries),util.extend(Range,{rangeProperties:rangeProperties,RangeIterator:RangeIterator,copyComparisonConstants:copyComparisonConstants,createPrototypeRange:createPrototypeRange,inspect:inspect,toHtml:rangeToHtml,getRangeDocument:getRangeDocument,rangesEqual:function(r1,r2){return r1.startContainer===r2.startContainer&&r1.startOffset===r2.startOffset&&r1.endContainer===r2.endContainer&&r1.endOffset===r2.endOffset}}),api.DomRange=Range}),api.createCoreModule("WrappedRange",["DomRange"],function(api,module){var WrappedRange,WrappedTextRange,dom=api.dom,util=api.util,DomPosition=dom.DomPosition,DomRange=api.DomRange,getBody=dom.getBody,getContentDocument=dom.getContentDocument,isCharacterDataNode=dom.isCharacterDataNode;if(api.features.implementsDomRange&&!function(){function updateRangeProperties(range){for(var prop,i=rangeProperties.length;i--;)prop=rangeProperties[i],range[prop]=range.nativeRange[prop];range.collapsed=range.startContainer===range.endContainer&&range.startOffset===range.endOffset}function updateNativeRange(range,startContainer,startOffset,endContainer,endOffset){var startMoved=range.startContainer!==startContainer||range.startOffset!=startOffset,endMoved=range.endContainer!==endContainer||range.endOffset!=endOffset,nativeRangeDifferent=!range.equals(range.nativeRange);(startMoved||endMoved||nativeRangeDifferent)&&(range.setEnd(endContainer,endOffset),range.setStart(startContainer,startOffset))}var rangeProto,createBeforeAfterNodeSetter,rangeProperties=DomRange.rangeProperties;WrappedRange=function(range){if(!range)throw module.createError("WrappedRange: Range must be specified");this.nativeRange=range,updateRangeProperties(this)},DomRange.createPrototypeRange(WrappedRange,updateNativeRange),rangeProto=WrappedRange.prototype,rangeProto.selectNode=function(node){this.nativeRange.selectNode(node),updateRangeProperties(this)},rangeProto.cloneContents=function(){return this.nativeRange.cloneContents()},rangeProto.surroundContents=function(node){this.nativeRange.surroundContents(node),updateRangeProperties(this)},rangeProto.collapse=function(isStart){this.nativeRange.collapse(isStart),updateRangeProperties(this)},rangeProto.cloneRange=function(){return new WrappedRange(this.nativeRange.cloneRange())},rangeProto.refresh=function(){updateRangeProperties(this)},rangeProto.toString=function(){return this.nativeRange.toString()};var testTextNode=document.createTextNode("test");getBody(document).appendChild(testTextNode);var range=document.createRange();range.setStart(testTextNode,0),range.setEnd(testTextNode,0);try{range.setStart(testTextNode,1),rangeProto.setStart=function(node,offset){this.nativeRange.setStart(node,offset),updateRangeProperties(this)},rangeProto.setEnd=function(node,offset){this.nativeRange.setEnd(node,offset),updateRangeProperties(this)},createBeforeAfterNodeSetter=function(name){return function(node){this.nativeRange[name](node),updateRangeProperties(this)}}}catch(ex){rangeProto.setStart=function(node,offset){try{this.nativeRange.setStart(node,offset)}catch(ex){this.nativeRange.setEnd(node,offset),this.nativeRange.setStart(node,offset)}updateRangeProperties(this)},rangeProto.setEnd=function(node,offset){try{this.nativeRange.setEnd(node,offset)}catch(ex){this.nativeRange.setStart(node,offset),this.nativeRange.setEnd(node,offset)}updateRangeProperties(this)},createBeforeAfterNodeSetter=function(name,oppositeName){return function(node){try{this.nativeRange[name](node)}catch(ex){this.nativeRange[oppositeName](node),this.nativeRange[name](node)}updateRangeProperties(this)}}}rangeProto.setStartBefore=createBeforeAfterNodeSetter("setStartBefore","setEndBefore"),rangeProto.setStartAfter=createBeforeAfterNodeSetter("setStartAfter","setEndAfter"),rangeProto.setEndBefore=createBeforeAfterNodeSetter("setEndBefore","setStartBefore"),rangeProto.setEndAfter=createBeforeAfterNodeSetter("setEndAfter","setStartAfter"),rangeProto.selectNodeContents=function(node){this.setStartAndEnd(node,0,dom.getNodeLength(node))},range.selectNodeContents(testTextNode),range.setEnd(testTextNode,3);var range2=document.createRange();range2.selectNodeContents(testTextNode),range2.setEnd(testTextNode,4),range2.setStart(testTextNode,2),range.compareBoundaryPoints(range.START_TO_END,range2)==-1&&1==range.compareBoundaryPoints(range.END_TO_START,range2)?rangeProto.compareBoundaryPoints=function(type,range){return range=range.nativeRange||range,type==range.START_TO_END?type=range.END_TO_START:type==range.END_TO_START&&(type=range.START_TO_END),this.nativeRange.compareBoundaryPoints(type,range)}:rangeProto.compareBoundaryPoints=function(type,range){return this.nativeRange.compareBoundaryPoints(type,range.nativeRange||range)};var el=document.createElement("div");el.innerHTML="123";var textNode=el.firstChild,body=getBody(document);body.appendChild(el),range.setStart(textNode,1),range.setEnd(textNode,2),range.deleteContents(),"13"==textNode.data&&(rangeProto.deleteContents=function(){this.nativeRange.deleteContents(),updateRangeProperties(this)},rangeProto.extractContents=function(){var frag=this.nativeRange.extractContents();return updateRangeProperties(this),frag}),body.removeChild(el),body=null,util.isHostMethod(range,"createContextualFragment")&&(rangeProto.createContextualFragment=function(fragmentStr){return this.nativeRange.createContextualFragment(fragmentStr)}),getBody(document).removeChild(testTextNode),rangeProto.getName=function(){return"WrappedRange"},api.WrappedRange=WrappedRange,api.createNativeRange=function(doc){return doc=getContentDocument(doc,module,"createNativeRange"),doc.createRange()}}(),api.features.implementsTextRange){var getTextRangeContainerElement=function(textRange){var parentEl=textRange.parentElement(),range=textRange.duplicate();range.collapse(!0);var startEl=range.parentElement();range=textRange.duplicate(),range.collapse(!1);var endEl=range.parentElement(),startEndContainer=startEl==endEl?startEl:dom.getCommonAncestor(startEl,endEl);return startEndContainer==parentEl?startEndContainer:dom.getCommonAncestor(parentEl,startEndContainer)},textRangeIsCollapsed=function(textRange){return 0==textRange.compareEndPoints("StartToEnd",textRange)},getTextRangeBoundaryPosition=function(textRange,wholeRangeContainerElement,isStart,isCollapsed,startInfo){var workingRange=textRange.duplicate();workingRange.collapse(isStart);var containerElement=workingRange.parentElement();if(dom.isOrIsAncestorOf(wholeRangeContainerElement,containerElement)||(containerElement=wholeRangeContainerElement),!containerElement.canHaveHTML){var pos=new DomPosition(containerElement.parentNode,dom.getNodeIndex(containerElement));return{boundaryPosition:pos,nodeInfo:{nodeIndex:pos.offset,containerElement:pos.node}}}var workingNode=dom.getDocument(containerElement).createElement("span");workingNode.parentNode&&workingNode.parentNode.removeChild(workingNode);for(var comparison,previousNode,nextNode,boundaryPosition,boundaryNode,workingComparisonType=isStart?"StartToStart":"StartToEnd",start=startInfo&&startInfo.containerElement==containerElement?startInfo.nodeIndex:0,childNodeCount=containerElement.childNodes.length,end=childNodeCount,nodeIndex=end;;){if(nodeIndex==childNodeCount?containerElement.appendChild(workingNode):containerElement.insertBefore(workingNode,containerElement.childNodes[nodeIndex]),workingRange.moveToElementText(workingNode),comparison=workingRange.compareEndPoints(workingComparisonType,textRange),0==comparison||start==end)break;if(comparison==-1){if(end==start+1)break;start=nodeIndex}else end=end==start+1?start:nodeIndex;nodeIndex=Math.floor((start+end)/2),containerElement.removeChild(workingNode)}if(boundaryNode=workingNode.nextSibling,comparison==-1&&boundaryNode&&isCharacterDataNode(boundaryNode)){workingRange.setEndPoint(isStart?"EndToStart":"EndToEnd",textRange);var offset;if(/[\r\n]/.test(boundaryNode.data)){var tempRange=workingRange.duplicate(),rangeLength=tempRange.text.replace(/\r\n/g,"\r").length;for(offset=tempRange.moveStart("character",rangeLength);(comparison=tempRange.compareEndPoints("StartToEnd",tempRange))==-1;)offset++,tempRange.moveStart("character",1)}else offset=workingRange.text.length;boundaryPosition=new DomPosition(boundaryNode,offset)}else previousNode=(isCollapsed||!isStart)&&workingNode.previousSibling,nextNode=(isCollapsed||isStart)&&workingNode.nextSibling,boundaryPosition=nextNode&&isCharacterDataNode(nextNode)?new DomPosition(nextNode,0):previousNode&&isCharacterDataNode(previousNode)?new DomPosition(previousNode,previousNode.data.length):new DomPosition(containerElement,dom.getNodeIndex(workingNode));return workingNode.parentNode.removeChild(workingNode),{boundaryPosition:boundaryPosition,nodeInfo:{nodeIndex:nodeIndex,containerElement:containerElement}}},createBoundaryTextRange=function(boundaryPosition,isStart){var boundaryNode,boundaryParent,workingNode,childNodes,boundaryOffset=boundaryPosition.offset,doc=dom.getDocument(boundaryPosition.node),workingRange=getBody(doc).createTextRange(),nodeIsDataNode=isCharacterDataNode(boundaryPosition.node);return nodeIsDataNode?(boundaryNode=boundaryPosition.node,boundaryParent=boundaryNode.parentNode):(childNodes=boundaryPosition.node.childNodes,boundaryNode=boundaryOffset<childNodes.length?childNodes[boundaryOffset]:null,boundaryParent=boundaryPosition.node),workingNode=doc.createElement("span"),workingNode.innerHTML="&#feff;",boundaryNode?boundaryParent.insertBefore(workingNode,boundaryNode):boundaryParent.appendChild(workingNode),workingRange.moveToElementText(workingNode),workingRange.collapse(!isStart),boundaryParent.removeChild(workingNode),nodeIsDataNode&&workingRange[isStart?"moveStart":"moveEnd"]("character",boundaryOffset),workingRange};WrappedTextRange=function(textRange){this.textRange=textRange,this.refresh()},WrappedTextRange.prototype=new DomRange(document),WrappedTextRange.prototype.refresh=function(){var start,end,startBoundary,rangeContainerElement=getTextRangeContainerElement(this.textRange);textRangeIsCollapsed(this.textRange)?end=start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,!0,!0).boundaryPosition:(startBoundary=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,!0,!1),start=startBoundary.boundaryPosition,end=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,!1,!1,startBoundary.nodeInfo).boundaryPosition),this.setStart(start.node,start.offset),this.setEnd(end.node,end.offset)},WrappedTextRange.prototype.getName=function(){return"WrappedTextRange"},DomRange.copyComparisonConstants(WrappedTextRange);var rangeToTextRange=function(range){if(range.collapsed)return createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),!0);var startRange=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),!0),endRange=createBoundaryTextRange(new DomPosition(range.endContainer,range.endOffset),!1),textRange=getBody(DomRange.getRangeDocument(range)).createTextRange();return textRange.setEndPoint("StartToStart",startRange),textRange.setEndPoint("EndToEnd",endRange),textRange};if(WrappedTextRange.rangeToTextRange=rangeToTextRange,WrappedTextRange.prototype.toTextRange=function(){return rangeToTextRange(this)},api.WrappedTextRange=WrappedTextRange,!api.features.implementsDomRange||api.config.preferTextRange){var globalObj=function(){return this}();"undefined"==typeof globalObj.Range&&(globalObj.Range=WrappedTextRange),api.createNativeRange=function(doc){return doc=getContentDocument(doc,module,"createNativeRange"),getBody(doc).createTextRange()},api.WrappedRange=WrappedTextRange}}api.createRange=function(doc){return doc=getContentDocument(doc,module,"createRange"),new api.WrappedRange(api.createNativeRange(doc))},api.createRangyRange=function(doc){return doc=getContentDocument(doc,module,"createRangyRange"),new DomRange(doc)},api.createIframeRange=function(iframeEl){return module.deprecationNotice("createIframeRange()","createRange(iframeEl)"),api.createRange(iframeEl)},api.createIframeRangyRange=function(iframeEl){return module.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),api.createRangyRange(iframeEl)},api.addShimListener(function(win){var doc=win.document;"undefined"==typeof doc.createRange&&(doc.createRange=function(){return api.createRange(doc)}),doc=win=null})}),api.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(api,module){function isDirectionBackward(dir){return"string"==typeof dir?/^backward(s)?$/i.test(dir):!!dir}function getWindow(win,methodName){if(win){if(dom.isWindow(win))return win;if(win instanceof WrappedSelection)return win.win;var doc=dom.getContentDocument(win,module,methodName);return dom.getWindow(doc)}return window}function getWinSelection(winParam){return getWindow(winParam,"getWinSelection").getSelection()}function getDocSelection(winParam){return getWindow(winParam,"getDocSelection").document.selection}function winSelectionIsBackward(sel){var backward=!1;return sel.anchorNode&&(backward=1==dom.comparePoints(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset)),backward}function updateAnchorAndFocusFromRange(sel,range,backward){var anchorPrefix=backward?"end":"start",focusPrefix=backward?"start":"end";sel.anchorNode=range[anchorPrefix+"Container"],sel.anchorOffset=range[anchorPrefix+"Offset"],sel.focusNode=range[focusPrefix+"Container"],sel.focusOffset=range[focusPrefix+"Offset"]}function updateAnchorAndFocusFromNativeSelection(sel){var nativeSel=sel.nativeSelection;sel.anchorNode=nativeSel.anchorNode,sel.anchorOffset=nativeSel.anchorOffset,sel.focusNode=nativeSel.focusNode,sel.focusOffset=nativeSel.focusOffset}function updateEmptySelection(sel){sel.anchorNode=sel.focusNode=null,sel.anchorOffset=sel.focusOffset=0,sel.rangeCount=0,sel.isCollapsed=!0,sel._ranges.length=0}function getNativeRange(range){var nativeRange;return range instanceof DomRange?(nativeRange=api.createNativeRange(range.getDocument()),nativeRange.setEnd(range.endContainer,range.endOffset),nativeRange.setStart(range.startContainer,range.startOffset)):range instanceof WrappedRange?nativeRange=range.nativeRange:features.implementsDomRange&&range instanceof dom.getWindow(range.startContainer).Range&&(nativeRange=range),nativeRange}function rangeContainsSingleElement(rangeNodes){if(!rangeNodes.length||1!=rangeNodes[0].nodeType)return!1;for(var i=1,len=rangeNodes.length;i<len;++i)if(!dom.isAncestorOf(rangeNodes[0],rangeNodes[i]))return!1;return!0}function getSingleElementFromRange(range){var nodes=range.getNodes();if(!rangeContainsSingleElement(nodes))throw module.createError("getSingleElementFromRange: range "+range.inspect()+" did not consist of a single element");return nodes[0]}function isTextRange(range){return!!range&&"undefined"!=typeof range.text}function updateFromTextRange(sel,range){var wrappedRange=new WrappedRange(range);sel._ranges=[wrappedRange],updateAnchorAndFocusFromRange(sel,wrappedRange,!1),sel.rangeCount=1,sel.isCollapsed=wrappedRange.collapsed}function updateControlSelection(sel){if(sel._ranges.length=0,"None"==sel.docSelection.type)updateEmptySelection(sel);else{var controlRange=sel.docSelection.createRange();if(isTextRange(controlRange))updateFromTextRange(sel,controlRange);else{sel.rangeCount=controlRange.length;for(var range,doc=getDocument(controlRange.item(0)),i=0;i<sel.rangeCount;++i)range=api.createRange(doc),range.selectNode(controlRange.item(i)),sel._ranges.push(range);sel.isCollapsed=1==sel.rangeCount&&sel._ranges[0].collapsed,updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],!1)}}}function addRangeToControlSelection(sel,range){for(var controlRange=sel.docSelection.createRange(),rangeElement=getSingleElementFromRange(range),doc=getDocument(controlRange.item(0)),newControlRange=getBody(doc).createControlRange(),i=0,len=controlRange.length;i<len;++i)newControlRange.add(controlRange.item(i));try{newControlRange.add(rangeElement)}catch(ex){throw module.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}newControlRange.select(),updateControlSelection(sel)}function WrappedSelection(selection,docSelection,win){this.nativeSelection=selection,this.docSelection=docSelection,this._ranges=[],this.win=win,this.refresh()}function deleteProperties(sel){sel.win=sel.anchorNode=sel.focusNode=sel._ranges=null,sel.rangeCount=sel.anchorOffset=sel.focusOffset=0,sel.detached=!0}function actOnCachedSelection(win,action){for(var cached,sel,i=cachedRangySelections.length;i--;)if(cached=cachedRangySelections[i],sel=cached.selection,"deleteAll"==action)deleteProperties(sel);else if(cached.win==win)return"delete"==action?(cachedRangySelections.splice(i,1),!0):sel;return"deleteAll"==action&&(cachedRangySelections.length=0),null}function createControlSelection(sel,ranges){for(var el,doc=getDocument(ranges[0].startContainer),controlRange=getBody(doc).createControlRange(),i=0,len=ranges.length;i<len;++i){el=getSingleElementFromRange(ranges[i]);try{controlRange.add(el)}catch(ex){throw module.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}controlRange.select(),updateControlSelection(sel)}function assertNodeInSameDocument(sel,node){if(sel.win.document!=getDocument(node))throw new DOMException("WRONG_DOCUMENT_ERR")}function createStartOrEndSetter(isStart){return function(node,offset){var range;this.rangeCount?(range=this.getRangeAt(0),range["set"+(isStart?"Start":"End")](node,offset)):(range=api.createRange(this.win.document),range.setStartAndEnd(node,offset)),this.setSingleRange(range,this.isBackward())}}function inspect(sel){var rangeInspects=[],anchor=new DomPosition(sel.anchorNode,sel.anchorOffset),focus=new DomPosition(sel.focusNode,sel.focusOffset),name="function"==typeof sel.getName?sel.getName():"Selection";if("undefined"!=typeof sel.rangeCount)for(var i=0,len=sel.rangeCount;i<len;++i)rangeInspects[i]=DomRange.inspect(sel.getRangeAt(i));return"["+name+"(Ranges: "+rangeInspects.join(", ")+")(anchor: "+anchor.inspect()+", focus: "+focus.inspect()+"]"}api.config.checkSelectionRanges=!0;var getNativeSelection,selectionIsCollapsed,BOOLEAN="boolean",NUMBER="number",dom=api.dom,util=api.util,isHostMethod=util.isHostMethod,DomRange=api.DomRange,WrappedRange=api.WrappedRange,DOMException=api.DOMException,DomPosition=dom.DomPosition,features=api.features,CONTROL="Control",getDocument=dom.getDocument,getBody=dom.getBody,rangesEqual=DomRange.rangesEqual,implementsWinGetSelection=isHostMethod(window,"getSelection"),implementsDocSelection=util.isHostObject(document,"selection");features.implementsWinGetSelection=implementsWinGetSelection,features.implementsDocSelection=implementsDocSelection;var useDocumentSelection=implementsDocSelection&&(!implementsWinGetSelection||api.config.preferTextRange);useDocumentSelection?(getNativeSelection=getDocSelection,api.isSelectionValid=function(winParam){var doc=getWindow(winParam,"isSelectionValid").document,nativeSel=doc.selection;return"None"!=nativeSel.type||getDocument(nativeSel.createRange().parentElement())==doc}):implementsWinGetSelection?(getNativeSelection=getWinSelection,api.isSelectionValid=function(){return!0}):module.fail("Neither document.selection or window.getSelection() detected."),api.getNativeSelection=getNativeSelection;var testSelection=getNativeSelection(),testRange=api.createNativeRange(document),body=getBody(document),selectionHasAnchorAndFocus=util.areHostProperties(testSelection,["anchorNode","focusNode","anchorOffset","focusOffset"]);features.selectionHasAnchorAndFocus=selectionHasAnchorAndFocus;var selectionHasExtend=isHostMethod(testSelection,"extend");features.selectionHasExtend=selectionHasExtend;var selectionHasRangeCount=typeof testSelection.rangeCount==NUMBER;features.selectionHasRangeCount=selectionHasRangeCount;var selectionSupportsMultipleRanges=!1,collapsedNonEditableSelectionsSupported=!0,addRangeBackwardToNative=selectionHasExtend?function(nativeSelection,range){var doc=DomRange.getRangeDocument(range),endRange=api.createRange(doc);endRange.collapseToPoint(range.endContainer,range.endOffset),nativeSelection.addRange(getNativeRange(endRange)),nativeSelection.extend(range.startContainer,range.startOffset)}:null;util.areHostMethods(testSelection,["addRange","getRangeAt","removeAllRanges"])&&typeof testSelection.rangeCount==NUMBER&&features.implementsDomRange&&!function(){var sel=window.getSelection();if(sel){for(var originalSelectionRangeCount=sel.rangeCount,selectionHasMultipleRanges=originalSelectionRangeCount>1,originalSelectionRanges=[],originalSelectionBackward=winSelectionIsBackward(sel),i=0;i<originalSelectionRangeCount;++i)originalSelectionRanges[i]=sel.getRangeAt(i);var body=getBody(document),testEl=body.appendChild(document.createElement("div"));testEl.contentEditable="false";var textNode=testEl.appendChild(document.createTextNode("")),r1=document.createRange();if(r1.setStart(textNode,1),r1.collapse(!0),sel.addRange(r1),collapsedNonEditableSelectionsSupported=1==sel.rangeCount,sel.removeAllRanges(),!selectionHasMultipleRanges){var chromeMatch=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(chromeMatch&&parseInt(chromeMatch[1])>=36)selectionSupportsMultipleRanges=!1;else{var r2=r1.cloneRange();r1.setStart(textNode,0),r2.setEnd(textNode,3),r2.setStart(textNode,2),sel.addRange(r1),sel.addRange(r2),selectionSupportsMultipleRanges=2==sel.rangeCount}}for(body.removeChild(testEl),sel.removeAllRanges(),i=0;i<originalSelectionRangeCount;++i)0==i&&originalSelectionBackward?addRangeBackwardToNative?addRangeBackwardToNative(sel,originalSelectionRanges[i]):(api.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),sel.addRange(originalSelectionRanges[i])):sel.addRange(originalSelectionRanges[i])}}(),features.selectionSupportsMultipleRanges=selectionSupportsMultipleRanges,features.collapsedNonEditableSelectionsSupported=collapsedNonEditableSelectionsSupported;var testControlRange,implementsControlRange=!1;body&&isHostMethod(body,"createControlRange")&&(testControlRange=body.createControlRange(),util.areHostProperties(testControlRange,["item","add"])&&(implementsControlRange=!0)),features.implementsControlRange=implementsControlRange,selectionIsCollapsed=selectionHasAnchorAndFocus?function(sel){return sel.anchorNode===sel.focusNode&&sel.anchorOffset===sel.focusOffset}:function(sel){return!!sel.rangeCount&&sel.getRangeAt(sel.rangeCount-1).collapsed;
};var getSelectionRangeAt;isHostMethod(testSelection,"getRangeAt")?getSelectionRangeAt=function(sel,index){try{return sel.getRangeAt(index)}catch(ex){return null}}:selectionHasAnchorAndFocus&&(getSelectionRangeAt=function(sel){var doc=getDocument(sel.anchorNode),range=api.createRange(doc);return range.setStartAndEnd(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset),range.collapsed!==this.isCollapsed&&range.setStartAndEnd(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset),range}),WrappedSelection.prototype=api.selectionPrototype;var cachedRangySelections=[],getSelection=function(win){if(win&&win instanceof WrappedSelection)return win.refresh(),win;win=getWindow(win,"getNativeSelection");var sel=actOnCachedSelection(win),nativeSel=getNativeSelection(win),docSel=implementsDocSelection?getDocSelection(win):null;return sel?(sel.nativeSelection=nativeSel,sel.docSelection=docSel,sel.refresh()):(sel=new WrappedSelection(nativeSel,docSel,win),cachedRangySelections.push({win:win,selection:sel})),sel};api.getSelection=getSelection,api.getIframeSelection=function(iframeEl){return module.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),api.getSelection(dom.getIframeWindow(iframeEl))};var selProto=WrappedSelection.prototype;if(!useDocumentSelection&&selectionHasAnchorAndFocus&&util.areHostMethods(testSelection,["removeAllRanges","addRange"])){selProto.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),updateEmptySelection(this)};var addRangeBackward=function(sel,range){addRangeBackwardToNative(sel.nativeSelection,range),sel.refresh()};selectionHasRangeCount?selProto.addRange=function(range,direction){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL)addRangeToControlSelection(this,range);else if(isDirectionBackward(direction)&&selectionHasExtend)addRangeBackward(this,range);else{var previousRangeCount;if(selectionSupportsMultipleRanges?previousRangeCount=this.rangeCount:(this.removeAllRanges(),previousRangeCount=0),this.nativeSelection.addRange(getNativeRange(range).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==previousRangeCount+1){if(api.config.checkSelectionRanges){var nativeRange=getSelectionRangeAt(this.nativeSelection,this.rangeCount-1);nativeRange&&!rangesEqual(nativeRange,range)&&(range=new WrappedRange(nativeRange))}this._ranges[this.rangeCount-1]=range,updateAnchorAndFocusFromRange(this,range,selectionIsBackward(this.nativeSelection)),this.isCollapsed=selectionIsCollapsed(this)}else this.refresh()}}:selProto.addRange=function(range,direction){isDirectionBackward(direction)&&selectionHasExtend?addRangeBackward(this,range):(this.nativeSelection.addRange(getNativeRange(range)),this.refresh())},selProto.setRanges=function(ranges){if(implementsControlRange&&implementsDocSelection&&ranges.length>1)createControlSelection(this,ranges);else{this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i)this.addRange(ranges[i])}}}else{if(!(isHostMethod(testSelection,"empty")&&isHostMethod(testRange,"select")&&implementsControlRange&&useDocumentSelection))return module.fail("No means of selecting a Range or TextRange was found"),!1;selProto.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var doc;if(this.anchorNode)doc=getDocument(this.anchorNode);else if(this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();controlRange.length&&(doc=getDocument(controlRange.item(0)))}if(doc){var textRange=getBody(doc).createTextRange();textRange.select(),this.docSelection.empty()}}}catch(ex){}updateEmptySelection(this)},selProto.addRange=function(range){this.docSelection.type==CONTROL?addRangeToControlSelection(this,range):(api.WrappedTextRange.rangeToTextRange(range).select(),this._ranges[0]=range,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,updateAnchorAndFocusFromRange(this,range,!1))},selProto.setRanges=function(ranges){this.removeAllRanges();var rangeCount=ranges.length;rangeCount>1?createControlSelection(this,ranges):rangeCount&&this.addRange(ranges[0])}}selProto.getRangeAt=function(index){if(index<0||index>=this.rangeCount)throw new DOMException("INDEX_SIZE_ERR");return this._ranges[index].cloneRange()};var refreshSelection;if(useDocumentSelection)refreshSelection=function(sel){var range;api.isSelectionValid(sel.win)?range=sel.docSelection.createRange():(range=getBody(sel.win.document).createTextRange(),range.collapse(!0)),sel.docSelection.type==CONTROL?updateControlSelection(sel):isTextRange(range)?updateFromTextRange(sel,range):updateEmptySelection(sel)};else if(isHostMethod(testSelection,"getRangeAt")&&typeof testSelection.rangeCount==NUMBER)refreshSelection=function(sel){if(implementsControlRange&&implementsDocSelection&&sel.docSelection.type==CONTROL)updateControlSelection(sel);else if(sel._ranges.length=sel.rangeCount=sel.nativeSelection.rangeCount,sel.rangeCount){for(var i=0,len=sel.rangeCount;i<len;++i)sel._ranges[i]=new api.WrappedRange(sel.nativeSelection.getRangeAt(i));updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],selectionIsBackward(sel.nativeSelection)),sel.isCollapsed=selectionIsCollapsed(sel)}else updateEmptySelection(sel)};else{if(!selectionHasAnchorAndFocus||typeof testSelection.isCollapsed!=BOOLEAN||typeof testRange.collapsed!=BOOLEAN||!features.implementsDomRange)return module.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;refreshSelection=function(sel){var range,nativeSel=sel.nativeSelection;nativeSel.anchorNode?(range=getSelectionRangeAt(nativeSel,0),sel._ranges=[range],sel.rangeCount=1,updateAnchorAndFocusFromNativeSelection(sel),sel.isCollapsed=selectionIsCollapsed(sel)):updateEmptySelection(sel)}}selProto.refresh=function(checkForChanges){var oldRanges=checkForChanges?this._ranges.slice(0):null,oldAnchorNode=this.anchorNode,oldAnchorOffset=this.anchorOffset;if(refreshSelection(this),checkForChanges){var i=oldRanges.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=oldAnchorNode||this.anchorOffset!=oldAnchorOffset)return!0;for(;i--;)if(!rangesEqual(oldRanges[i],this._ranges[i]))return!0;return!1}};var removeRangeManually=function(sel,range){var ranges=sel.getAllRanges();sel.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i)rangesEqual(range,ranges[i])||sel.addRange(ranges[i]);sel.rangeCount||updateEmptySelection(sel)};implementsControlRange&&implementsDocSelection?selProto.removeRange=function(range){if(this.docSelection.type==CONTROL){for(var el,controlRange=this.docSelection.createRange(),rangeElement=getSingleElementFromRange(range),doc=getDocument(controlRange.item(0)),newControlRange=getBody(doc).createControlRange(),removed=!1,i=0,len=controlRange.length;i<len;++i)el=controlRange.item(i),el!==rangeElement||removed?newControlRange.add(controlRange.item(i)):removed=!0;newControlRange.select(),updateControlSelection(this)}else removeRangeManually(this,range)}:selProto.removeRange=function(range){removeRangeManually(this,range)};var selectionIsBackward;!useDocumentSelection&&selectionHasAnchorAndFocus&&features.implementsDomRange?(selectionIsBackward=winSelectionIsBackward,selProto.isBackward=function(){return selectionIsBackward(this)}):selectionIsBackward=selProto.isBackward=function(){return!1},selProto.isBackwards=selProto.isBackward,selProto.toString=function(){for(var rangeTexts=[],i=0,len=this.rangeCount;i<len;++i)rangeTexts[i]=""+this._ranges[i];return rangeTexts.join("")},selProto.collapse=function(node,offset){assertNodeInSameDocument(this,node);var range=api.createRange(node);range.collapseToPoint(node,offset),this.setSingleRange(range),this.isCollapsed=!0},selProto.collapseToStart=function(){if(!this.rangeCount)throw new DOMException("INVALID_STATE_ERR");var range=this._ranges[0];this.collapse(range.startContainer,range.startOffset)},selProto.collapseToEnd=function(){if(!this.rangeCount)throw new DOMException("INVALID_STATE_ERR");var range=this._ranges[this.rangeCount-1];this.collapse(range.endContainer,range.endOffset)},selProto.selectAllChildren=function(node){assertNodeInSameDocument(this,node);var range=api.createRange(node);range.selectNodeContents(node),this.setSingleRange(range)},selProto.deleteFromDocument=function(){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){for(var element,controlRange=this.docSelection.createRange();controlRange.length;)element=controlRange.item(0),controlRange.remove(element),element.parentNode.removeChild(element);this.refresh()}else if(this.rangeCount){var ranges=this.getAllRanges();if(ranges.length){this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i)ranges[i].deleteContents();this.addRange(ranges[len-1])}}},selProto.eachRange=function(func,returnValue){for(var i=0,len=this._ranges.length;i<len;++i)if(func(this.getRangeAt(i)))return returnValue},selProto.getAllRanges=function(){var ranges=[];return this.eachRange(function(range){ranges.push(range)}),ranges},selProto.setSingleRange=function(range,direction){this.removeAllRanges(),this.addRange(range,direction)},selProto.callMethodOnEachRange=function(methodName,params){var results=[];return this.eachRange(function(range){results.push(range[methodName].apply(range,params))}),results},selProto.setStart=createStartOrEndSetter(!0),selProto.setEnd=createStartOrEndSetter(!1),api.rangePrototype.select=function(direction){getSelection(this.getDocument()).setSingleRange(this,direction)},selProto.changeEachRange=function(func){var ranges=[],backward=this.isBackward();this.eachRange(function(range){func(range),ranges.push(range)}),this.removeAllRanges(),backward&&1==ranges.length?this.addRange(ranges[0],"backward"):this.setRanges(ranges)},selProto.containsNode=function(node,allowPartial){return this.eachRange(function(range){return range.containsNode(node,allowPartial)},!0)||!1},selProto.getBookmark=function(containerNode){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[containerNode])}},selProto.moveToBookmark=function(bookmark){for(var rangeBookmark,range,selRanges=[],i=0;rangeBookmark=bookmark.rangeBookmarks[i++];)range=api.createRange(this.win),range.moveToBookmark(rangeBookmark),selRanges.push(range);bookmark.backward?this.setSingleRange(selRanges[0],"backward"):this.setRanges(selRanges)},selProto.toHtml=function(){var rangeHtmls=[];return this.eachRange(function(range){rangeHtmls.push(DomRange.toHtml(range))}),rangeHtmls.join("")},features.implementsTextRange&&(selProto.getNativeTextRange=function(){var sel;if(sel=this.docSelection){var range=sel.createRange();if(isTextRange(range))return range;throw module.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return api.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw module.createError("getNativeTextRange: selection contains no range")}),selProto.getName=function(){return"WrappedSelection"},selProto.inspect=function(){return inspect(this)},selProto.detach=function(){actOnCachedSelection(this.win,"delete"),deleteProperties(this)},WrappedSelection.detachAll=function(){actOnCachedSelection(null,"deleteAll")},WrappedSelection.inspect=inspect,WrappedSelection.isDirectionBackward=isDirectionBackward,api.Selection=WrappedSelection,api.selectionPrototype=selProto,api.addShimListener(function(win){"undefined"==typeof win.getSelection&&(win.getSelection=function(){return getSelection(win)}),win=null})}),api)},this),function(factory,global){"function"==typeof define&&define.amd?define(["rangy"],factory):factory(global.rangy)}(function(rangy){rangy.createModule("SaveRestore",["WrappedRange"],function(api,module){function gEBI(id,doc){return(doc||document).getElementById(id)}function insertRangeBoundaryMarker(range,atStart){var markerEl,markerId="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),doc=dom.getDocument(range.startContainer),boundaryRange=range.cloneRange();return boundaryRange.collapse(atStart),markerEl=doc.createElement("span"),markerEl.id=markerId,markerEl.style.lineHeight="0",markerEl.style.display="none",markerEl.className="rangySelectionBoundary",markerEl.appendChild(doc.createTextNode(markerTextChar)),boundaryRange.insertNode(markerEl),markerEl}function setRangeBoundary(doc,range,markerId,atStart){var markerEl=gEBI(markerId,doc);markerEl?(range[atStart?"setStartBefore":"setEndBefore"](markerEl),markerEl.parentNode.removeChild(markerEl)):module.warn("Marker element has been removed. Cannot restore selection.")}function compareRanges(r1,r2){return r2.compareBoundaryPoints(r1.START_TO_START,r1)}function saveRange(range,backward){var startEl,endEl,doc=api.DomRange.getRangeDocument(range),text=range.toString();return range.collapsed?(endEl=insertRangeBoundaryMarker(range,!1),{document:doc,markerId:endEl.id,collapsed:!0}):(endEl=insertRangeBoundaryMarker(range,!1),startEl=insertRangeBoundaryMarker(range,!0),{document:doc,startMarkerId:startEl.id,endMarkerId:endEl.id,collapsed:!1,backward:backward,toString:function(){return"original text: '"+text+"', new text: '"+range.toString()+"'"}})}function restoreRange(rangeInfo,normalize){var doc=rangeInfo.document;"undefined"==typeof normalize&&(normalize=!0);var range=api.createRange(doc);if(rangeInfo.collapsed){var markerEl=gEBI(rangeInfo.markerId,doc);if(markerEl){markerEl.style.display="inline";var previousNode=markerEl.previousSibling;previousNode&&3==previousNode.nodeType?(markerEl.parentNode.removeChild(markerEl),range.collapseToPoint(previousNode,previousNode.length)):(range.collapseBefore(markerEl),markerEl.parentNode.removeChild(markerEl))}else module.warn("Marker element has been removed. Cannot restore selection.")}else setRangeBoundary(doc,range,rangeInfo.startMarkerId,!0),setRangeBoundary(doc,range,rangeInfo.endMarkerId,!1);return normalize&&range.normalizeBoundaries(),range}function saveRanges(ranges,backward){var range,doc,rangeInfos=[];ranges=ranges.slice(0),ranges.sort(compareRanges);for(var i=0,len=ranges.length;i<len;++i)rangeInfos[i]=saveRange(ranges[i],backward);for(i=len-1;i>=0;--i)range=ranges[i],doc=api.DomRange.getRangeDocument(range),range.collapsed?range.collapseAfter(gEBI(rangeInfos[i].markerId,doc)):(range.setEndBefore(gEBI(rangeInfos[i].endMarkerId,doc)),range.setStartAfter(gEBI(rangeInfos[i].startMarkerId,doc)));return rangeInfos}function saveSelection(win){if(!api.isSelectionValid(win))return module.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var sel=api.getSelection(win),ranges=sel.getAllRanges(),backward=1==ranges.length&&sel.isBackward(),rangeInfos=saveRanges(ranges,backward);return backward?sel.setSingleRange(ranges[0],"backward"):sel.setRanges(ranges),{win:win,rangeInfos:rangeInfos,restored:!1}}function restoreRanges(rangeInfos){for(var ranges=[],rangeCount=rangeInfos.length,i=rangeCount-1;i>=0;i--)ranges[i]=restoreRange(rangeInfos[i],!0);return ranges}function restoreSelection(savedSelection,preserveDirection){if(!savedSelection.restored){var rangeInfos=savedSelection.rangeInfos,sel=api.getSelection(savedSelection.win),ranges=restoreRanges(rangeInfos),rangeCount=rangeInfos.length;1==rangeCount&&preserveDirection&&api.features.selectionHasExtend&&rangeInfos[0].backward?(sel.removeAllRanges(),sel.addRange(ranges[0],!0)):sel.setRanges(ranges),savedSelection.restored=!0}}function removeMarkerElement(doc,markerId){var markerEl=gEBI(markerId,doc);markerEl&&markerEl.parentNode.removeChild(markerEl)}function removeMarkers(savedSelection){for(var rangeInfo,rangeInfos=savedSelection.rangeInfos,i=0,len=rangeInfos.length;i<len;++i)rangeInfo=rangeInfos[i],rangeInfo.collapsed?removeMarkerElement(savedSelection.doc,rangeInfo.markerId):(removeMarkerElement(savedSelection.doc,rangeInfo.startMarkerId),removeMarkerElement(savedSelection.doc,rangeInfo.endMarkerId))}var dom=api.dom,markerTextChar="\ufeff";api.util.extend(api,{saveRange:saveRange,restoreRange:restoreRange,saveRanges:saveRanges,restoreRanges:restoreRanges,saveSelection:saveSelection,restoreSelection:restoreSelection,removeMarkerElement:removeMarkerElement,removeMarkers:removeMarkers})})},this);var Base=function(){};Base.extend=function(_instance,_static){var extend=Base.prototype.extend;Base._prototyping=!0;var proto=new this;extend.call(proto,_instance),proto.base=function(){},delete Base._prototyping;var constructor=proto.constructor,klass=proto.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==klass)this._constructing=!0,constructor.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||extend).call(arguments[0],proto)};return klass.ancestor=this,klass.extend=this.extend,klass.forEach=this.forEach,klass.implement=this.implement,klass.prototype=proto,klass.toString=this.toString,klass.valueOf=function(type){return"object"==type?klass:constructor.valueOf()},extend.call(klass,_static),"function"==typeof klass.init&&klass.init(),klass},Base.prototype={extend:function(source,value){if(arguments.length>1){var ancestor=this[source];if(ancestor&&"function"==typeof value&&(!ancestor.valueOf||ancestor.valueOf()!=value.valueOf())&&/\bbase\b/.test(value)){var method=value.valueOf();value=function(){var previous=this.base||Base.prototype.base;this.base=ancestor;var returnValue=method.apply(this,arguments);return this.base=previous,returnValue},value.valueOf=function(type){return"object"==type?value:method},value.toString=Base.toString}this[source]=value}else if(source){var extend=Base.prototype.extend;Base._prototyping||"function"==typeof this||(extend=this.extend||extend);for(var proto={toSource:null},hidden=["constructor","toString","valueOf"],i=Base._prototyping?0:1;key=hidden[i++];)source[key]!=proto[key]&&extend.call(this,key,source[key]);for(var key in source)proto[key]||extend.call(this,key,source[key])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(object,block,context){for(var key in object)void 0===this.prototype[key]&&block.call(context,object[key],key,object)},implement:function(){for(var i=0;i<arguments.length;i++)"function"==typeof arguments[i]?arguments[i](this.prototype):this.prototype.extend(arguments[i]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function iosVersion(userAgent){return+(/ipad|iphone|ipod/.test(userAgent)&&userAgent.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function androidVersion(userAgent){return+(userAgent.match(/android (\d+)/)||[void 0,0])[1]}function isIE(version,equation){var re,rv=-1;return"Microsoft Internet Explorer"==navigator.appName?re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(re=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")),re&&null!=re.exec(navigator.userAgent)&&(rv=parseFloat(RegExp.$1)),rv!==-1&&(!version||(equation?"<"===equation?version<rv:">"===equation?version>rv:"<="===equation?version<=rv:">="===equation?version>=rv:void 0:version===rv))}var userAgent=navigator.userAgent,testElement=document.createElement("div"),isGecko=userAgent.indexOf("Gecko")!==-1&&userAgent.indexOf("KHTML")===-1,isWebKit=userAgent.indexOf("AppleWebKit/")!==-1,isChrome=userAgent.indexOf("Chrome/")!==-1,isOpera=userAgent.indexOf("Opera/")!==-1;return{USER_AGENT:userAgent,supported:function(){var userAgent=this.USER_AGENT.toLowerCase(),hasContentEditableSupport="contentEditable"in testElement,hasEditingApiSupport=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,hasQuerySelectorSupport=document.querySelector&&document.querySelectorAll,isIncompatibleMobileBrowser=this.isIos()&&iosVersion(userAgent)<5||this.isAndroid()&&androidVersion(userAgent)<4||userAgent.indexOf("opera mobi")!==-1||userAgent.indexOf("hpwos/")!==-1;return hasContentEditableSupport&&hasEditingApiSupport&&hasQuerySelectorSupport&&!isIncompatibleMobileBrowser},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return this.USER_AGENT.indexOf("Android")!==-1},supportsSandboxedIframes:function(){return isIE()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return isIE()},hasCurrentStyleProperty:function(){return"currentStyle"in testElement},hasHistoryIssue:function(){return isGecko&&"Mac"===navigator.platform.substr(0,3)},insertsLineBreaksOnReturn:function(){return isGecko},supportsPlaceholderAttributeOn:function(element){return"placeholder"in element},supportsEvent:function(eventName){return"on"+eventName in testElement||function(){return testElement.setAttribute("on"+eventName,"return;"),"function"==typeof testElement["on"+eventName]}()},supportsEventsInIframeCorrectly:function(){return!isOpera},supportsHTML5Tags:function(context){var element=context.createElement("div"),html5="<article>foo</article>";return element.innerHTML=html5,element.innerHTML.toLowerCase()===html5},supportsCommand:function(){var buggyCommands={formatBlock:isIE(10,"<="),insertUnorderedList:isIE(),insertOrderedList:isIE()},supported={insertHTML:isGecko};return function(doc,command){var isBuggy=buggyCommands[command];if(!isBuggy){try{return doc.queryCommandSupported(command)}catch(e1){}try{return doc.queryCommandEnabled(command)}catch(e2){return!!supported[command]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return isIE()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return isGecko||isOpera||isWebKit},supportsGetAttributeCorrectly:function(){var td=document.createElement("td");return"1"!=td.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return isGecko||isIE()||isOpera},autoScrollsToCaret:function(){return!isWebKit},autoClosesUnclosedTags:function(){var returnValue,innerHTML,clonedTestElement=testElement.cloneNode(!1);return clonedTestElement.innerHTML="<p><div></div>",innerHTML=clonedTestElement.innerHTML.toLowerCase(),returnValue="<p></p><div></div>"===innerHTML||"<p><div></div></p>"===innerHTML,this.autoClosesUnclosedTags=function(){return returnValue},returnValue},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return isOpera},supportsSpeechApiOn:function(input){var chromeVersion=userAgent.match(/Chrome\/(\d+)/)||[void 0,0];return chromeVersion[1]>=11&&("onwebkitspeechchange"in input||"speech"in input)},crashesWhenDefineProperty:function(property){return isIE(9)&&("XMLHttpRequest"===property||"XDomainRequest"===property)},doesAsyncFocus:function(){return isIE()},hasProblemsSettingCaretAfterImg:function(){return isIE()},hasUndoInContextMenu:function(){return isGecko||isChrome||isOpera},hasInsertNodeIssue:function(){return isOpera},hasIframeFocusIssue:function(){return isIE()},createsNestedInvalidMarkupAfterPaste:function(){return isWebKit},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModenPaste:function(){return!("clipboardData"in window)}}}(),wysihtml5.lang.array=function(arr){return{contains:function(needle){if(Array.isArray(needle)){for(var i=needle.length;i--;)if(wysihtml5.lang.array(arr).indexOf(needle[i])!==-1)return!0;return!1}return wysihtml5.lang.array(arr).indexOf(needle)!==-1},indexOf:function(needle){if(arr.indexOf)return arr.indexOf(needle);for(var i=0,length=arr.length;i<length;i++)if(arr[i]===needle)return i;return-1},without:function(arrayToSubstract){arrayToSubstract=wysihtml5.lang.array(arrayToSubstract);for(var newArr=[],i=0,length=arr.length;i<length;i++)arrayToSubstract.contains(arr[i])||newArr.push(arr[i]);return newArr},get:function(){for(var i=0,length=arr.length,newArray=[];i<length;i++)newArray.push(arr[i]);return newArray},map:function(callback,thisArg){if(Array.prototype.map)return arr.map(callback,thisArg);for(var len=arr.length>>>0,A=new Array(len),i=0;i<len;i++)A[i]=callback.call(thisArg,arr[i],i,arr);return A},unique:function(){for(var vals=[],max=arr.length,idx=0;idx<max;)wysihtml5.lang.array(vals).contains(arr[idx])||vals.push(arr[idx]),idx++;return vals}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(eventName,handler){return this.events=this.events||{},this.events[eventName]=this.events[eventName]||[],this.events[eventName].push(handler),this},off:function(eventName,handler){this.events=this.events||{};var handlers,newHandlers,i=0;if(eventName){for(handlers=this.events[eventName]||[],newHandlers=[];i<handlers.length;i++)handlers[i]!==handler&&handler&&newHandlers.push(handlers[i]);this.events[eventName]=newHandlers}else this.events={};return this},fire:function(eventName,payload){this.events=this.events||{};for(var handlers=this.events[eventName]||[],i=0;i<handlers.length;i++)handlers[i].call(this,payload);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(obj){return{merge:function(otherObj){for(var i in otherObj)obj[i]=otherObj[i];return this},get:function(){return obj},clone:function(deep){var i,newObj={};if(null===obj||!wysihtml5.lang.object(obj).isPlainObject())return obj;for(i in obj)obj.hasOwnProperty(i)&&(deep?newObj[i]=wysihtml5.lang.object(obj[i]).clone(deep):newObj[i]=obj[i]);return newObj},isArray:function(){return"[object Array]"===Object.prototype.toString.call(obj)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(obj)},isPlainObject:function(){return"[object Object]"===Object.prototype.toString.call(obj)}}},function(){var WHITE_SPACE_START=/^\s+/,WHITE_SPACE_END=/\s+$/,ENTITY_REG_EXP=/[&<>\t"]/g,ENTITY_MAP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\t":"&nbsp; "};wysihtml5.lang.string=function(str){return str=String(str),{trim:function(){return str.replace(WHITE_SPACE_START,"").replace(WHITE_SPACE_END,"")},interpolate:function(vars){for(var i in vars)str=this.replace("#{"+i+"}").by(vars[i]);return str},replace:function(search){return{by:function(replace){return str.split(search).join(replace)}}},escapeHTML:function(linebreaks,convertSpaces){var html=str.replace(ENTITY_REG_EXP,function(c){return ENTITY_MAP[c]});return linebreaks&&(html=html.replace(/(?:\r\n|\r|\n)/g,"<br />")),convertSpaces&&(html=html.replace(/  /gi,"&nbsp; ")),html}}}}(),function(wysihtml5){function autoLink(element,ignoreInClasses){return _hasParentThatShouldBeIgnored(element,ignoreInClasses)?element:(element===element.ownerDocument.documentElement&&(element=element.ownerDocument.body),_parseNode(element,ignoreInClasses))}function _convertUrlsToLinks(str){return str.replace(URL_REG_EXP,function(match,url){var punctuation=(url.match(TRAILING_CHAR_REG_EXP)||[])[1]||"",opening=BRACKETS[punctuation];url=url.replace(TRAILING_CHAR_REG_EXP,""),url.split(opening).length>url.split(punctuation).length&&(url+=punctuation,punctuation="");var realUrl=url,displayUrl=url;return url.length>MAX_DISPLAY_LENGTH&&(displayUrl=displayUrl.substr(0,MAX_DISPLAY_LENGTH)+"..."),"www."===realUrl.substr(0,4)&&(realUrl="http://"+realUrl),'<a href="'+realUrl+'">'+displayUrl+"</a>"+punctuation})}function _getTempElement(context){var tempElement=context._wysihtml5_tempElement;return tempElement||(tempElement=context._wysihtml5_tempElement=context.createElement("div")),tempElement}function _wrapMatchesInNode(textNode){var parentNode=textNode.parentNode,nodeValue=wysihtml5.lang.string(textNode.data).escapeHTML(),tempElement=_getTempElement(parentNode.ownerDocument);for(tempElement.innerHTML="<span></span>"+_convertUrlsToLinks(nodeValue),tempElement.removeChild(tempElement.firstChild);tempElement.firstChild;)parentNode.insertBefore(tempElement.firstChild,textNode);parentNode.removeChild(textNode)}function _hasParentThatShouldBeIgnored(node,ignoreInClasses){for(var nodeName;node.parentNode;){if(node=node.parentNode,nodeName=node.nodeName,node.className&&wysihtml5.lang.array(node.className.split(" ")).contains(ignoreInClasses))return!0;if(IGNORE_URLS_IN.contains(nodeName))return!0;if("body"===nodeName)return!1}return!1}function _parseNode(element,ignoreInClasses){if(!(IGNORE_URLS_IN.contains(element.nodeName)||element.className&&wysihtml5.lang.array(element.className.split(" ")).contains(ignoreInClasses))){if(element.nodeType===wysihtml5.TEXT_NODE&&element.data.match(URL_REG_EXP))return void _wrapMatchesInNode(element);for(var childNodes=wysihtml5.lang.array(element.childNodes).get(),childNodesLength=childNodes.length,i=0;i<childNodesLength;i++)_parseNode(childNodes[i],ignoreInClasses);return element}}var IGNORE_URLS_IN=wysihtml5.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),URL_REG_EXP=/((https?:\/\/|www\.)[^\s<]{3,})/gi,TRAILING_CHAR_REG_EXP=/([^\w\/\-](,?))$/i,MAX_DISPLAY_LENGTH=100,BRACKETS={")":"(","]":"[","}":"{"};wysihtml5.dom.autoLink=autoLink,wysihtml5.dom.autoLink.URL_REG_EXP=URL_REG_EXP}(wysihtml5),function(wysihtml5){var api=wysihtml5.dom;api.addClass=function(element,className){var classList=element.classList;return classList?classList.add(className):void(api.hasClass(element,className)||(element.className+=" "+className))},api.removeClass=function(element,className){var classList=element.classList;return classList?classList.remove(className):void(element.className=element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)")," "))},api.hasClass=function(element,className){var classList=element.classList;if(classList)return classList.contains(className);var elementClassName=element.className;return elementClassName.length>0&&(elementClassName==className||new RegExp("(^|\\s)"+className+"(\\s|$)").test(elementClassName))}}(wysihtml5),wysihtml5.dom.contains=function(){var documentElement=document.documentElement;return documentElement.contains?function(container,element){return element.nodeType!==wysihtml5.ELEMENT_NODE&&(element=element.parentNode),container!==element&&container.contains(element)}:documentElement.compareDocumentPosition?function(container,element){return!!(16&container.compareDocumentPosition(element))}:void 0}(),wysihtml5.dom.convertToList=function(){function _createListItem(doc,list){var listItem=doc.createElement("li");return list.appendChild(listItem),listItem}function _createList(doc,type){return doc.createElement(type)}function convertToList(element,listType,uneditableClass){if("UL"===element.nodeName||"OL"===element.nodeName||"MENU"===element.nodeName)return element;var childNodes,childNodesLength,childNode,lineBreak,parentNode,isBlockElement,isLineBreak,currentListItem,i,doc=element.ownerDocument,list=_createList(doc,listType),lineBreaks=element.querySelectorAll("br"),lineBreaksLength=lineBreaks.length;for(i=0;i<lineBreaksLength;i++)for(lineBreak=lineBreaks[i];(parentNode=lineBreak.parentNode)&&parentNode!==element&&parentNode.lastChild===lineBreak;){if("block"===wysihtml5.dom.getStyle("display").from(parentNode)){parentNode.removeChild(lineBreak);break}wysihtml5.dom.insert(lineBreak).after(lineBreak.parentNode)}for(childNodes=wysihtml5.lang.array(element.childNodes).get(),childNodesLength=childNodes.length,i=0;i<childNodesLength;i++)currentListItem=currentListItem||_createListItem(doc,list),childNode=childNodes[i],isBlockElement="block"===wysihtml5.dom.getStyle("display").from(childNode),isLineBreak="BR"===childNode.nodeName,!isBlockElement||uneditableClass&&wysihtml5.dom.hasClass(childNode,uneditableClass)?isLineBreak?currentListItem=currentListItem.firstChild?null:currentListItem:currentListItem.appendChild(childNode):(currentListItem=currentListItem.firstChild?_createListItem(doc,list):currentListItem,currentListItem.appendChild(childNode),currentListItem=null);return 0===childNodes.length&&_createListItem(doc,list),
element.parentNode.replaceChild(list,element),list}return convertToList}(),wysihtml5.dom.copyAttributes=function(attributesToCopy){return{from:function(elementToCopyFrom){return{to:function(elementToCopyTo){for(var attribute,i=0,length=attributesToCopy.length;i<length;i++)attribute=attributesToCopy[i],"undefined"!=typeof elementToCopyFrom[attribute]&&""!==elementToCopyFrom[attribute]&&(elementToCopyTo[attribute]=elementToCopyFrom[attribute]);return{andTo:arguments.callee}}}}}},function(dom){var BOX_SIZING_PROPERTIES=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],shouldIgnoreBoxSizingBorderBox=function(element){return!!hasBoxSizingBorderBox(element)&&parseInt(dom.getStyle("width").from(element),10)<element.offsetWidth},hasBoxSizingBorderBox=function(element){for(var i=0,length=BOX_SIZING_PROPERTIES.length;i<length;i++)if("border-box"===dom.getStyle(BOX_SIZING_PROPERTIES[i]).from(element))return BOX_SIZING_PROPERTIES[i]};dom.copyStyles=function(stylesToCopy){return{from:function(element){shouldIgnoreBoxSizingBorderBox(element)&&(stylesToCopy=wysihtml5.lang.array(stylesToCopy).without(BOX_SIZING_PROPERTIES));for(var property,cssText="",length=stylesToCopy.length,i=0;i<length;i++)property=stylesToCopy[i],cssText+=property+":"+dom.getStyle(property).from(element)+";";return{to:function(element){return dom.setStyles(cssText).on(element),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(wysihtml5){wysihtml5.dom.delegate=function(container,selector,eventName,handler){return wysihtml5.dom.observe(container,eventName,function(event){for(var target=event.target,match=wysihtml5.lang.array(container.querySelectorAll(selector));target&&target!==container;){if(match.contains(target)){handler.call(target,event);break}target=target.parentNode}})}}(wysihtml5),function(wysihtml5){wysihtml5.dom.domNode=function(node){var defaultNodeTypes=[wysihtml5.ELEMENT_NODE,wysihtml5.TEXT_NODE],_isBlankText=function(node){return node.nodeType===wysihtml5.TEXT_NODE&&/^\s*$/g.test(node.data)};return{prev:function(options){var prevNode=node.previousSibling,types=options&&options.nodeTypes?options.nodeTypes:defaultNodeTypes;return prevNode?!wysihtml5.lang.array(types).contains(prevNode.nodeType)||options&&options.ignoreBlankTexts&&_isBlankText(prevNode)?wysihtml5.dom.domNode(prevNode).prev(options):prevNode:null},next:function(options){var nextNode=node.nextSibling,types=options&&options.nodeTypes?options.nodeTypes:defaultNodeTypes;return nextNode?!wysihtml5.lang.array(types).contains(nextNode.nodeType)||options&&options.ignoreBlankTexts&&_isBlankText(nextNode)?wysihtml5.dom.domNode(nextNode).next(options):nextNode:null}}}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var _innerHTMLShiv=function(html,context){var tempElement=context.createElement("div");tempElement.style.display="none",context.body.appendChild(tempElement);try{tempElement.innerHTML=html}catch(e){}return context.body.removeChild(tempElement),tempElement},_ensureHTML5Compatibility=function(context){if(!context._wysihtml5_supportsHTML5Tags){for(var i=0,length=HTML5_ELEMENTS.length;i<length;i++)context.createElement(HTML5_ELEMENTS[i]);context._wysihtml5_supportsHTML5Tags=!0}},HTML5_ELEMENTS=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(html,context){context=context||document;var tempElement;return"object"==typeof html&&html.nodeType?(tempElement=context.createElement("div"),tempElement.appendChild(html)):wysihtml5.browser.supportsHTML5Tags(context)?(tempElement=context.createElement("div"),tempElement.innerHTML=html):(_ensureHTML5Compatibility(context),tempElement=_innerHTMLShiv(html,context)),tempElement}}(),wysihtml5.dom.getParentElement=function(){function _isSameNodeName(nodeName,desiredNodeNames){return!desiredNodeNames||!desiredNodeNames.length||("string"==typeof desiredNodeNames?nodeName===desiredNodeNames:wysihtml5.lang.array(desiredNodeNames).contains(nodeName))}function _isElement(node){return node.nodeType===wysihtml5.ELEMENT_NODE}function _hasClassName(element,className,classRegExp){var classNames=(element.className||"").match(classRegExp)||[];return className?classNames[classNames.length-1]===className:!!classNames.length}function _hasStyle(element,cssStyle,styleRegExp){var styles=(element.getAttribute("style")||"").match(styleRegExp)||[];return cssStyle?styles[styles.length-1]===cssStyle:!!styles.length}return function(node,matchingSet,levels,container){var findByStyle=matchingSet.cssStyle||matchingSet.styleRegExp,findByClass=matchingSet.className||matchingSet.classRegExp;for(levels=levels||50;levels--&&node&&"BODY"!==node.nodeName&&(!container||node!==container);){if(_isElement(node)&&_isSameNodeName(node.nodeName,matchingSet.nodeName)&&(!findByStyle||_hasStyle(node,matchingSet.cssStyle,matchingSet.styleRegExp))&&(!findByClass||_hasClassName(node,matchingSet.className,matchingSet.classRegExp)))return node;node=node.parentNode}return null}}(),wysihtml5.dom.getStyle=function(){function camelize(str){return str.replace(REG_EXP_CAMELIZE,function(match){return match.charAt(1).toUpperCase()})}var stylePropertyMapping={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},REG_EXP_CAMELIZE=/\-[a-z]/g;return function(property){return{from:function(element){if(element.nodeType===wysihtml5.ELEMENT_NODE){var doc=element.ownerDocument,camelizedProperty=stylePropertyMapping[property]||camelize(property),style=element.style,currentStyle=element.currentStyle,styleValue=style[camelizedProperty];if(styleValue)return styleValue;if(currentStyle)try{return currentStyle[camelizedProperty]}catch(e){}var originalOverflow,returnValue,win=doc.defaultView||doc.parentWindow,needsOverflowReset=("height"===property||"width"===property)&&"TEXTAREA"===element.nodeName;return win.getComputedStyle?(needsOverflowReset&&(originalOverflow=style.overflow,style.overflow="hidden"),returnValue=win.getComputedStyle(element,null).getPropertyValue(property),needsOverflowReset&&(style.overflow=originalOverflow||""),returnValue):void 0}}}}}(),wysihtml5.dom.getTextNodes=function(node,ingoreEmpty){var all=[];for(node=node.firstChild;node;node=node.nextSibling)3==node.nodeType?ingoreEmpty&&/^\s*$/.test(node.innerText||node.textContent)||all.push(node):all=all.concat(wysihtml5.dom.getTextNodes(node,ingoreEmpty));return all},wysihtml5.dom.hasElementWithTagName=function(){function _getDocumentIdentifier(doc){return doc._wysihtml5_identifier||(doc._wysihtml5_identifier=DOCUMENT_IDENTIFIER++)}var LIVE_CACHE={},DOCUMENT_IDENTIFIER=1;return function(doc,tagName){var key=_getDocumentIdentifier(doc)+":"+tagName,cacheEntry=LIVE_CACHE[key];return cacheEntry||(cacheEntry=LIVE_CACHE[key]=doc.getElementsByTagName(tagName)),cacheEntry.length>0}}(),function(wysihtml5){function _getDocumentIdentifier(doc){return doc._wysihtml5_identifier||(doc._wysihtml5_identifier=DOCUMENT_IDENTIFIER++)}var LIVE_CACHE={},DOCUMENT_IDENTIFIER=1;wysihtml5.dom.hasElementWithClassName=function(doc,className){if(!wysihtml5.browser.supportsNativeGetElementsByClassName())return!!doc.querySelector("."+className);var key=_getDocumentIdentifier(doc)+":"+className,cacheEntry=LIVE_CACHE[key];return cacheEntry||(cacheEntry=LIVE_CACHE[key]=doc.getElementsByClassName(className)),cacheEntry.length>0}}(wysihtml5),wysihtml5.dom.insert=function(elementToInsert){return{after:function(element){element.parentNode.insertBefore(elementToInsert,element.nextSibling)},before:function(element){element.parentNode.insertBefore(elementToInsert,element)},into:function(element){element.appendChild(elementToInsert)}}},wysihtml5.dom.insertCSS=function(rules){return rules=rules.join("\n"),{into:function(doc){var styleElement=doc.createElement("style");styleElement.type="text/css",styleElement.styleSheet?styleElement.styleSheet.cssText=rules:styleElement.appendChild(doc.createTextNode(rules));var link=doc.querySelector("head link");if(link)return void link.parentNode.insertBefore(styleElement,link);var head=doc.querySelector("head");head&&head.appendChild(styleElement)}}},function(wysihtml5){wysihtml5.dom.lineBreaks=function(node){function _isLineBreak(n){return"BR"===n.nodeName}function _isLineBreakOrBlockElement(element){return!!_isLineBreak(element)||"block"===wysihtml5.dom.getStyle("display").from(element)}return{add:function(options){var doc=node.ownerDocument,nextSibling=wysihtml5.dom.domNode(node).next({ignoreBlankTexts:!0}),previousSibling=wysihtml5.dom.domNode(node).prev({ignoreBlankTexts:!0});nextSibling&&!_isLineBreakOrBlockElement(nextSibling)&&wysihtml5.dom.insert(doc.createElement("br")).after(node),previousSibling&&!_isLineBreakOrBlockElement(previousSibling)&&wysihtml5.dom.insert(doc.createElement("br")).before(node)},remove:function(options){var nextSibling=wysihtml5.dom.domNode(node).next({ignoreBlankTexts:!0}),previousSibling=wysihtml5.dom.domNode(node).prev({ignoreBlankTexts:!0});nextSibling&&_isLineBreak(nextSibling)&&nextSibling.parentNode.removeChild(nextSibling),previousSibling&&_isLineBreak(previousSibling)&&previousSibling.parentNode.removeChild(previousSibling)}}}}(wysihtml5),wysihtml5.dom.observe=function(element,eventNames,handler){eventNames="string"==typeof eventNames?[eventNames]:eventNames;for(var handlerWrapper,eventName,i=0,length=eventNames.length;i<length;i++)eventName=eventNames[i],element.addEventListener?element.addEventListener(eventName,handler,!1):(handlerWrapper=function(event){"target"in event||(event.target=event.srcElement),event.preventDefault=event.preventDefault||function(){this.returnValue=!1},event.stopPropagation=event.stopPropagation||function(){this.cancelBubble=!0},handler.call(element,event)},element.attachEvent("on"+eventName,handlerWrapper));return{stop:function(){for(var eventName,i=0,length=eventNames.length;i<length;i++)eventName=eventNames[i],element.removeEventListener?element.removeEventListener(eventName,handler,!1):element.detachEvent("on"+eventName,handlerWrapper)}}},wysihtml5.dom.parse=function(elementOrHtml_current,config_current){function parse(elementOrHtml,config){wysihtml5.lang.object(currentRules).merge(defaultRules).merge(config.rules).get();var element,newNode,firstChild,context=config.context||elementOrHtml.ownerDocument||document,fragment=context.createDocumentFragment(),isString="string"==typeof elementOrHtml,clearInternals=!1;for(config.clearInternals===!0&&(clearInternals=!0),element=isString?wysihtml5.dom.getAsDom(elementOrHtml,context):elementOrHtml,currentRules.selectors&&_applySelectorRules(element,currentRules.selectors);element.firstChild;)firstChild=element.firstChild,newNode=_convert(firstChild,config.cleanUp,clearInternals,config.uneditableClass),newNode&&fragment.appendChild(newNode),firstChild!==newNode&&element.removeChild(firstChild);if(config.unjoinNbsps)for(var txtnodes=wysihtml5.dom.getTextNodes(fragment),n=txtnodes.length;n--;)txtnodes[n].nodeValue=txtnodes[n].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return element.innerHTML="",element.appendChild(fragment),isString?wysihtml5.quirks.getCorrectInnerHTML(element):element}function _convert(oldNode,cleanUp,clearInternals,uneditableClass){var fragment,newNode,newChild,oldNodeType=oldNode.nodeType,oldChilds=oldNode.childNodes,oldChildsLength=oldChilds.length,method=NODE_TYPE_MAPPING[oldNodeType],i=0;if(uneditableClass&&1===oldNodeType&&wysihtml5.dom.hasClass(oldNode,uneditableClass))return oldNode;if(newNode=method&&method(oldNode,clearInternals),!newNode){if(newNode===!1){for(fragment=oldNode.ownerDocument.createDocumentFragment(),i=oldChildsLength;i--;)oldChilds[i]&&(newChild=_convert(oldChilds[i],cleanUp,clearInternals,uneditableClass),newChild&&(oldChilds[i]===newChild&&i--,fragment.insertBefore(newChild,fragment.firstChild)));return"block"===wysihtml5.dom.getStyle("display").from(oldNode)&&fragment.appendChild(oldNode.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(oldNode.nodeName.toLowerCase())&&oldNode.parentNode.lastChild!==oldNode&&(oldNode.nextSibling&&3===oldNode.nextSibling.nodeType&&/^\s/.test(oldNode.nextSibling.nodeValue)||fragment.appendChild(oldNode.ownerDocument.createTextNode(" "))),fragment.normalize&&fragment.normalize(),fragment}return null}for(i=0;i<oldChildsLength;i++)oldChilds[i]&&(newChild=_convert(oldChilds[i],cleanUp,clearInternals,uneditableClass),newChild&&(oldChilds[i]===newChild&&i--,newNode.appendChild(newChild)));if(cleanUp&&newNode.nodeName.toLowerCase()===DEFAULT_NODE_NAME&&(!newNode.childNodes.length||/^\s*$/gi.test(newNode.innerHTML)&&(clearInternals||"_wysihtml5-temp-placeholder"!==oldNode.className&&"rangySelectionBoundary"!==oldNode.className)||!newNode.attributes.length)){for(fragment=newNode.ownerDocument.createDocumentFragment();newNode.firstChild;)fragment.appendChild(newNode.firstChild);return fragment.normalize&&fragment.normalize(),fragment}return newNode.normalize&&newNode.normalize(),newNode}function _applySelectorRules(element,selectorRules){var sel,method,els;for(sel in selectorRules)if(selectorRules.hasOwnProperty(sel)){wysihtml5.lang.object(selectorRules[sel]).isFunction()?method=selectorRules[sel]:"string"==typeof selectorRules[sel]&&elementHandlingMethods[selectorRules[sel]]&&(method=elementHandlingMethods[selectorRules[sel]]),els=element.querySelectorAll(sel);for(var i=els.length;i--;)method(els[i])}}function _handleElement(oldNode,clearInternals){var rule,newNode,renameTag,tagRules=currentRules.tags,nodeName=oldNode.nodeName.toLowerCase(),scopeName=oldNode.scopeName;if(oldNode._wysihtml5)return null;if(oldNode._wysihtml5=1,"wysihtml5-temp"===oldNode.className)return null;if(scopeName&&"HTML"!=scopeName&&(nodeName=scopeName+":"+nodeName),"outerHTML"in oldNode&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==oldNode.nodeName||"</p>"===oldNode.outerHTML.slice(-4).toLowerCase()||(nodeName="div")),nodeName in tagRules){if(rule=tagRules[nodeName],!rule||rule.remove)return null;if(rule.unwrap)return!1;rule="string"==typeof rule?{rename_tag:rule}:rule}else{if(!oldNode.firstChild)return null;rule={rename_tag:DEFAULT_NODE_NAME}}if(rule.one_of_type&&!_testTypes(oldNode,currentRules,rule.one_of_type,clearInternals)){if(!rule.remove_action)return null;if("unwrap"===rule.remove_action)return!1;if("rename"!==rule.remove_action)return null;renameTag=rule.remove_action_rename_to||DEFAULT_NODE_NAME}return newNode=oldNode.ownerDocument.createElement(renameTag||rule.rename_tag||nodeName),_handleAttributes(oldNode,newNode,rule,clearInternals),_handleStyles(oldNode,newNode,rule),oldNode=null,newNode.normalize&&newNode.normalize(),newNode}function _testTypes(oldNode,rules,types,clearInternals){var definition,type;if("SPAN"===oldNode.nodeName&&!clearInternals&&("_wysihtml5-temp-placeholder"===oldNode.className||"rangySelectionBoundary"===oldNode.className))return!0;for(type in types)if(types.hasOwnProperty(type)&&rules.type_definitions&&rules.type_definitions[type]&&(definition=rules.type_definitions[type],_testType(oldNode,definition)))return!0;return!1}function _testType(oldNode,definition){var classesLength,s,a,attr,styleProp,nodeClasses=oldNode.getAttribute("class"),nodeStyles=oldNode.getAttribute("style");if(definition.methods)for(var m in definition.methods)if(definition.methods.hasOwnProperty(m)&&typeCeckMethods[m]&&typeCeckMethods[m](oldNode))return!0;if(nodeClasses&&definition.classes){nodeClasses=nodeClasses.replace(/^\s+/g,"").replace(/\s+$/g,"").split(WHITE_SPACE_REG_EXP),classesLength=nodeClasses.length;for(var i=0;i<classesLength;i++)if(definition.classes[nodeClasses[i]])return!0}if(nodeStyles&&definition.styles){nodeStyles=nodeStyles.split(";");for(s in definition.styles)if(definition.styles.hasOwnProperty(s))for(var sp=nodeStyles.length;sp--;)if(styleProp=nodeStyles[sp].split(":"),styleProp[0].replace(/\s/g,"").toLowerCase()===s&&(definition.styles[s]===!0||1===definition.styles[s]||wysihtml5.lang.array(definition.styles[s]).contains(styleProp[1].replace(/\s/g,"").toLowerCase())))return!0}if(definition.attrs)for(a in definition.attrs)if(definition.attrs.hasOwnProperty(a)&&(attr=wysihtml5.dom.getAttribute(oldNode,a),"string"==typeof attr&&attr.search(definition.attrs[a])>-1))return!0;return!1}function _handleStyles(oldNode,newNode,rule){var s,v;if(rule&&rule.keep_styles)for(s in rule.keep_styles)if(rule.keep_styles.hasOwnProperty(s)){if(v="float"===s?oldNode.style.styleFloat||oldNode.style.cssFloat:oldNode.style[s],rule.keep_styles[s]instanceof RegExp&&!rule.keep_styles[s].test(v))continue;"float"===s?newNode.style[oldNode.style.styleFloat?"styleFloat":"cssFloat"]=v:oldNode.style[s]&&(newNode.style[s]=v)}}function _getAttributesBeginningWith(beginning,attributes){var returnAttributes=[];for(var attr in attributes)attributes.hasOwnProperty(attr)&&0===attr.indexOf(beginning)&&returnAttributes.push(attr);return returnAttributes}function _checkAttribute(attributeName,attributeValue,methodName,nodeName){var newAttributeValue,method=attributeCheckMethods[methodName];return!(!method||!(attributeValue||"alt"===attributeName&&"IMG"==nodeName)||(newAttributeValue=method(attributeValue),"string"!=typeof newAttributeValue))&&newAttributeValue}function _checkAttributes(oldNode,local_attributes){var attributeName,newValue,matchingAttributes,globalAttributes=wysihtml5.lang.object(currentRules.attributes||{}).clone(),checkAttributes=wysihtml5.lang.object(globalAttributes).merge(wysihtml5.lang.object(local_attributes||{}).clone()).get(),attributes={},oldAttributes=wysihtml5.dom.getAttributes(oldNode);for(attributeName in checkAttributes)if(/\*$/.test(attributeName)){matchingAttributes=_getAttributesBeginningWith(attributeName.slice(0,-1),oldAttributes);for(var i=0,imax=matchingAttributes.length;i<imax;i++)newValue=_checkAttribute(matchingAttributes[i],oldAttributes[matchingAttributes[i]],checkAttributes[attributeName],oldNode.nodeName),newValue!==!1&&(attributes[matchingAttributes[i]]=newValue)}else newValue=_checkAttribute(attributeName,oldAttributes[attributeName],checkAttributes[attributeName],oldNode.nodeName),newValue!==!1&&(attributes[attributeName]=newValue);return attributes}function _handleAttributes(oldNode,newNode,rule,clearInternals){var classesLength,currentClass,newClass,attributeName,method,attributes={},setClass=rule.set_class,addClass=rule.add_class,addStyle=rule.add_style,setAttributes=rule.set_attributes,allowedClasses=currentRules.classes,i=0,classes=[],styles=[],newClasses=[],oldClasses=[];if(setAttributes&&(attributes=wysihtml5.lang.object(setAttributes).clone()),attributes=wysihtml5.lang.object(attributes).merge(_checkAttributes(oldNode,rule.check_attributes)).get(),setClass&&classes.push(setClass),addClass)for(attributeName in addClass)method=addClassMethods[addClass[attributeName]],method&&(newClass=method(wysihtml5.dom.getAttribute(oldNode,attributeName)),"string"==typeof newClass&&classes.push(newClass));if(addStyle)for(attributeName in addStyle)method=addStyleMethods[addStyle[attributeName]],method&&(newStyle=method(wysihtml5.dom.getAttribute(oldNode,attributeName)),"string"==typeof newStyle&&styles.push(newStyle));if("string"==typeof allowedClasses&&"any"===allowedClasses&&oldNode.getAttribute("class"))if(currentRules.classes_blacklist){for(oldClasses=oldNode.getAttribute("class"),oldClasses&&(classes=classes.concat(oldClasses.split(WHITE_SPACE_REG_EXP))),classesLength=classes.length;i<classesLength;i++)currentClass=classes[i],currentRules.classes_blacklist[currentClass]||newClasses.push(currentClass);newClasses.length&&(attributes["class"]=wysihtml5.lang.array(newClasses).unique().join(" "))}else attributes["class"]=oldNode.getAttribute("class");else{for(clearInternals||(allowedClasses["_wysihtml5-temp-placeholder"]=1,allowedClasses._rangySelectionBoundary=1,allowedClasses["wysiwyg-tmp-selected-cell"]=1),oldClasses=oldNode.getAttribute("class"),oldClasses&&(classes=classes.concat(oldClasses.split(WHITE_SPACE_REG_EXP))),classesLength=classes.length;i<classesLength;i++)currentClass=classes[i],allowedClasses[currentClass]&&newClasses.push(currentClass);newClasses.length&&(attributes["class"]=wysihtml5.lang.array(newClasses).unique().join(" "))}attributes["class"]&&clearInternals&&(attributes["class"]=attributes["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(attributes["class"])&&delete attributes["class"]),styles.length&&(attributes.style=wysihtml5.lang.array(styles).unique().join(" "));for(attributeName in attributes)try{newNode.setAttribute(attributeName,attributes[attributeName])}catch(e){}attributes.src&&("undefined"!=typeof attributes.width&&newNode.setAttribute("width",attributes.width),"undefined"!=typeof attributes.height&&newNode.setAttribute("height",attributes.height))}function _handleText(oldNode){var nextSibling=oldNode.nextSibling;if(!nextSibling||nextSibling.nodeType!==wysihtml5.TEXT_NODE){var data=oldNode.data.replace(INVISIBLE_SPACE_REG_EXP,"");return oldNode.ownerDocument.createTextNode(data)}nextSibling.data=oldNode.data.replace(INVISIBLE_SPACE_REG_EXP,"")+nextSibling.data.replace(INVISIBLE_SPACE_REG_EXP,"")}function _handleComment(oldNode){if(currentRules.comments)return oldNode.ownerDocument.createComment(oldNode.nodeValue)}var NODE_TYPE_MAPPING={1:_handleElement,3:_handleText,8:_handleComment},DEFAULT_NODE_NAME="span",WHITE_SPACE_REG_EXP=/\s+/,defaultRules={tags:{},classes:{}},currentRules={},INVISIBLE_SPACE_REG_EXP=/\uFEFF/g,attributeCheckMethods={url:function(){var REG_EXP=/^https?:\/\//i;return function(attributeValue){return attributeValue&&attributeValue.match(REG_EXP)?attributeValue.replace(REG_EXP,function(match){return match.toLowerCase()}):null}}(),src:function(){var REG_EXP=/^(\/|https?:\/\/)/i;return function(attributeValue){return attributeValue&&attributeValue.match(REG_EXP)?attributeValue.replace(REG_EXP,function(match){return match.toLowerCase()}):null}}(),href:function(){var REG_EXP=/^(#|\/|https?:\/\/|mailto:)/i;return function(attributeValue){return attributeValue&&attributeValue.match(REG_EXP)?attributeValue.replace(REG_EXP,function(match){return match.toLowerCase()}):null}}(),alt:function(){var REG_EXP=/[^ a-z0-9_\-]/gi;return function(attributeValue){return attributeValue?attributeValue.replace(REG_EXP,""):""}}(),numbers:function(){var REG_EXP=/\D/g;return function(attributeValue){return attributeValue=(attributeValue||"").replace(REG_EXP,""),attributeValue||null}}(),any:function(){return function(attributeValue){return attributeValue}}()},addStyleMethods={align_text:function(){var mapping={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(attributeValue){return mapping[String(attributeValue).toLowerCase()]}}()},addClassMethods={align_img:function(){var mapping={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(attributeValue){return mapping[String(attributeValue).toLowerCase()]}}(),align_text:function(){var mapping={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(attributeValue){return mapping[String(attributeValue).toLowerCase()]}}(),clear_br:function(){var mapping={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(attributeValue){return mapping[String(attributeValue).toLowerCase()]}}(),size_font:function(){var mapping={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(attributeValue){return mapping[String(attributeValue).charAt(0)]}}()},typeCeckMethods={has_visible_contet:function(){var txt,visibleElements=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(el){if(txt=(el.innerText||el.textContent).replace(/\s/g,""),txt&&txt.length>0)return!0;for(var i=visibleElements.length;i--;)if(el.querySelector(visibleElements[i]))return!0;return!!(el.offsetWidth&&el.offsetWidth>0&&el.offsetHeight&&el.offsetHeight>0)}}()},elementHandlingMethods={unwrap:function(element){wysihtml5.dom.unwrap(element)},remove:function(element){element.parentNode.removeChild(element)}};return parse(elementOrHtml_current,config_current)},wysihtml5.dom.removeEmptyTextNodes=function(node){for(var childNode,childNodes=wysihtml5.lang.array(node.childNodes).get(),childNodesLength=childNodes.length,i=0;i<childNodesLength;i++)childNode=childNodes[i],childNode.nodeType===wysihtml5.TEXT_NODE&&""===childNode.data&&childNode.parentNode.removeChild(childNode)},wysihtml5.dom.renameElement=function(element,newNodeName){for(var firstChild,newElement=element.ownerDocument.createElement(newNodeName);firstChild=element.firstChild;)newElement.appendChild(firstChild);return wysihtml5.dom.copyAttributes(["align","className"]).from(element).to(newElement),element.parentNode.replaceChild(newElement,element),newElement},wysihtml5.dom.replaceWithChildNodes=function(node){if(node.parentNode){if(!node.firstChild)return void node.parentNode.removeChild(node);for(var fragment=node.ownerDocument.createDocumentFragment();node.firstChild;)fragment.appendChild(node.firstChild);node.parentNode.replaceChild(fragment,node),node=fragment=null}},function(dom){function _isBlockElement(node){return"block"===dom.getStyle("display").from(node)}function _isLineBreak(node){return"BR"===node.nodeName}function _appendLineBreak(element){var lineBreak=element.ownerDocument.createElement("br");element.appendChild(lineBreak)}function resolveList(list,useLineBreaks){if(list.nodeName.match(/^(MENU|UL|OL)$/)){var firstChild,lastChild,isLastChild,shouldAppendLineBreak,paragraph,listItem,doc=list.ownerDocument,fragment=doc.createDocumentFragment(),previousSibling=wysihtml5.dom.domNode(list).prev({ignoreBlankTexts:!0});if(useLineBreaks)for(!previousSibling||_isBlockElement(previousSibling)||_isLineBreak(previousSibling)||_appendLineBreak(fragment);listItem=list.firstElementChild||list.firstChild;){for(lastChild=listItem.lastChild;firstChild=listItem.firstChild;)isLastChild=firstChild===lastChild,shouldAppendLineBreak=isLastChild&&!_isBlockElement(firstChild)&&!_isLineBreak(firstChild),fragment.appendChild(firstChild),shouldAppendLineBreak&&_appendLineBreak(fragment);listItem.parentNode.removeChild(listItem)}else for(;listItem=list.firstElementChild||list.firstChild;){if(listItem.querySelector&&listItem.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;firstChild=listItem.firstChild;)fragment.appendChild(firstChild);else{for(paragraph=doc.createElement("p");firstChild=listItem.firstChild;)paragraph.appendChild(firstChild);fragment.appendChild(paragraph)}listItem.parentNode.removeChild(listItem)}list.parentNode.replaceChild(fragment,list)}}dom.resolveList=resolveList}(wysihtml5.dom),function(wysihtml5){var doc=document,windowProperties=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],windowProperties2=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],documentProperties=["referrer","write","open","close"];wysihtml5.dom.Sandbox=Base.extend({constructor:function(readyCallback,config){this.callback=readyCallback||wysihtml5.EMPTY_FUNCTION,this.config=wysihtml5.lang.object({}).merge(config).get(),this.editableArea=this._createIframe()},insertInto:function(element){"string"==typeof element&&(element=doc.getElementById(element)),element.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var iframe=this.getIframe();iframe.parentNode.removeChild(iframe)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var that=this,iframe=doc.createElement("iframe");return iframe.className="wysihtml5-sandbox",wysihtml5.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(iframe),wysihtml5.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(iframe.src="javascript:'<html></html>'"),iframe.onload=function(){iframe.onreadystatechange=iframe.onload=null,that._onLoadIframe(iframe)},iframe.onreadystatechange=function(){/loaded|complete/.test(iframe.readyState)&&(iframe.onreadystatechange=iframe.onload=null,that._onLoadIframe(iframe))},iframe},_onLoadIframe:function(iframe){if(wysihtml5.dom.contains(doc.documentElement,iframe)){var that=this,iframeWindow=iframe.contentWindow,iframeDocument=iframe.contentWindow.document,charset=doc.characterSet||doc.charset||"utf-8",sandboxHtml=this._getHtml({charset:charset,stylesheets:this.config.stylesheets});if(iframeDocument.open("text/html","replace"),iframeDocument.write(sandboxHtml),iframeDocument.close(),this.getWindow=function(){return iframe.contentWindow},this.getDocument=function(){return iframe.contentWindow.document},iframeWindow.onerror=function(errorMessage,fileName,lineNumber){throw new Error("wysihtml5.Sandbox: "+errorMessage,fileName,lineNumber)},!wysihtml5.browser.supportsSandboxedIframes()){var i,length;for(i=0,length=windowProperties.length;i<length;i++)this._unset(iframeWindow,windowProperties[i]);for(i=0,length=windowProperties2.length;i<length;i++)this._unset(iframeWindow,windowProperties2[i],wysihtml5.EMPTY_FUNCTION);for(i=0,length=documentProperties.length;i<length;i++)this._unset(iframeDocument,documentProperties[i]);this._unset(iframeDocument,"cookie","",!0)}this.loaded=!0,setTimeout(function(){that.callback(that)},0)}},_getHtml:function(templateVars){var length,stylesheets=templateVars.stylesheets,html="",i=0;if(stylesheets="string"==typeof stylesheets?[stylesheets]:stylesheets)for(length=stylesheets.length;i<length;i++)html+='<link rel="stylesheet" href="'+stylesheets[i]+'">';return templateVars.stylesheets=html,wysihtml5.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(templateVars)},_unset:function(object,property,value,setter){try{object[property]=value}catch(e){}try{object.__defineGetter__(property,function(){return value})}catch(e){}if(setter)try{object.__defineSetter__(property,function(){})}catch(e){}if(!wysihtml5.browser.crashesWhenDefineProperty(property))try{var config={get:function(){return value}};setter&&(config.set=function(){}),Object.defineProperty(object,property,config)}catch(e){}}})}(wysihtml5),function(wysihtml5){var doc=document;wysihtml5.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(readyCallback,config,contentEditable){this.callback=readyCallback||wysihtml5.EMPTY_FUNCTION,this.config=wysihtml5.lang.object({}).merge(config).get(),contentEditable?this.element=this._bindElement(contentEditable):this.element=this._createElement()},_createElement:function(){var element=doc.createElement("div");return element.className="wysihtml5-sandbox",this._loadElement(element),element},_bindElement:function(contentEditable){return contentEditable.className=contentEditable.className&&""!=contentEditable.className?contentEditable.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(contentEditable,!0),contentEditable},_loadElement:function(element,contentExists){var that=this;if(!contentExists){var sandboxHtml=this._getHtml();
element.innerHTML=sandboxHtml}this.getWindow=function(){return element.ownerDocument.defaultView},this.getDocument=function(){return element.ownerDocument},this.loaded=!0,setTimeout(function(){that.callback(that)},0)},_getHtml:function(templateVars){return""}})}(wysihtml5),function(){var mapping={className:"class"};wysihtml5.dom.setAttributes=function(attributes){return{on:function(element){for(var i in attributes)element.setAttribute(mapping[i]||i,attributes[i])}}}}(),wysihtml5.dom.setStyles=function(styles){return{on:function(element){var style=element.style;if("string"==typeof styles)return void(style.cssText+=";"+styles);for(var i in styles)"float"===i?(style.cssFloat=styles[i],style.styleFloat=styles[i]):style[i]=styles[i]}}},function(dom){dom.simulatePlaceholder=function(editor,view,placeholderText){var CLASS_NAME="placeholder",unset=function(){var composerIsVisible=view.element.offsetWidth>0&&view.element.offsetHeight>0;view.hasPlaceholderSet()&&(view.clear(),view.element.focus(),composerIsVisible&&setTimeout(function(){var sel=view.selection.getSelection();sel.focusNode&&sel.anchorNode||view.selection.selectNode(view.element.firstChild||view.element)},0)),view.placeholderSet=!1,dom.removeClass(view.element,CLASS_NAME)},set=function(){view.isEmpty()&&(view.placeholderSet=!0,view.setValue(placeholderText),dom.addClass(view.element,CLASS_NAME))};editor.on("set_placeholder",set).on("unset_placeholder",unset).on("focus:composer",unset).on("paste:composer",unset).on("blur:composer",set),set()}}(wysihtml5.dom),function(dom){var documentElement=document.documentElement;"textContent"in documentElement?(dom.setTextContent=function(element,text){element.textContent=text},dom.getTextContent=function(element){return element.textContent}):"innerText"in documentElement?(dom.setTextContent=function(element,text){element.innerText=text},dom.getTextContent=function(element){return element.innerText}):(dom.setTextContent=function(element,text){element.nodeValue=text},dom.getTextContent=function(element){return element.nodeValue})}(wysihtml5.dom),wysihtml5.dom.getAttribute=function(node,attributeName){var HAS_GET_ATTRIBUTE_BUG=!wysihtml5.browser.supportsGetAttributeCorrectly();attributeName=attributeName.toLowerCase();var nodeName=node.nodeName;if("IMG"==nodeName&&"src"==attributeName&&wysihtml5.dom.isLoadedImage(node)===!0)return node.src;if(HAS_GET_ATTRIBUTE_BUG&&"outerHTML"in node){var outerHTML=node.outerHTML.toLowerCase(),hasAttribute=outerHTML.indexOf(" "+attributeName+"=")!=-1;return hasAttribute?node.getAttribute(attributeName):null}return node.getAttribute(attributeName)},wysihtml5.dom.getAttributes=function(node){var attr,HAS_GET_ATTRIBUTE_BUG=!wysihtml5.browser.supportsGetAttributeCorrectly(),nodeName=node.nodeName,attributes=[];for(attr in node.attributes)(node.attributes.hasOwnProperty&&node.attributes.hasOwnProperty(attr)||!node.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(node.attributes,attr))&&node.attributes[attr].specified&&("IMG"==nodeName&&"src"==node.attributes[attr].name.toLowerCase()&&wysihtml5.dom.isLoadedImage(node)===!0?attributes.src=node.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(node.attributes[attr].name.toLowerCase())&&HAS_GET_ATTRIBUTE_BUG?1!==node.attributes[attr].value&&(attributes[node.attributes[attr].name]=node.attributes[attr].value):attributes[node.attributes[attr].name]=node.attributes[attr].value);return attributes},wysihtml5.dom.isLoadedImage=function(node){try{return node.complete&&!node.mozMatchesSelector(":-moz-broken")}catch(e){if(node.complete&&"complete"===node.readyState)return!0}},function(wysihtml5){function queryInList(list,query){for(var q,ret=[],e=0,len=list.length;e<len;e++)if(q=list[e].querySelectorAll(query))for(var i=q.length;i--;ret.unshift(q[i]));return ret}function removeElement(el){el.parentNode.removeChild(el)}function insertAfter(referenceNode,newNode){referenceNode.parentNode.insertBefore(newNode,referenceNode.nextSibling)}function nextNode(node,tag){for(var element=node.nextSibling;1!=element.nodeType;)if(element=element.nextSibling,!tag||tag==element.tagName.toLowerCase())return element;return null}var api=wysihtml5.dom,MapCell=function(cell){this.el=cell,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},TableModifyerByCell=function(cell,table){cell?(this.cell=cell,this.table=api.getParentElement(cell,{nodeName:["TABLE"]})):table&&(this.table=table,this.cell=this.table.querySelectorAll("th, td")[0])};TableModifyerByCell.prototype={addSpannedCellToMap:function(cell,map,r,c,cspan,rspan){for(var spanCollect=[],rmax=r+(rspan?parseInt(rspan,10)-1:0),cmax=c+(cspan?parseInt(cspan,10)-1:0),rr=r;rr<=rmax;rr++){"undefined"==typeof map[rr]&&(map[rr]=[]);for(var cc=c;cc<=cmax;cc++)map[rr][cc]=new MapCell(cell),map[rr][cc].isColspan=cspan&&parseInt(cspan,10)>1,map[rr][cc].isRowspan=rspan&&parseInt(rspan,10)>1,map[rr][cc].firstCol=cc==c,map[rr][cc].lastCol=cc==cmax,map[rr][cc].firstRow=rr==r,map[rr][cc].lastRow=rr==rmax,map[rr][cc].isReal=cc==c&&rr==r,map[rr][cc].spanCollection=spanCollect,spanCollect.push(map[rr][cc])}},setCellAsModified:function(cell){if(cell.modified=!0,cell.spanCollection.length>0)for(var s=0,smax=cell.spanCollection.length;s<smax;s++)cell.spanCollection[s].modified=!0},setTableMap:function(){var ridx,row,cells,cidx,cell,c,cspan,rspan,map=[],tableRows=this.getTableRows();for(ridx=0;ridx<tableRows.length;ridx++)for(row=tableRows[ridx],cells=this.getRowCells(row),c=0,"undefined"==typeof map[ridx]&&(map[ridx]=[]),cidx=0;cidx<cells.length;cidx++){for(cell=cells[cidx];"undefined"!=typeof map[ridx][c];)c++;cspan=api.getAttribute(cell,"colspan"),rspan=api.getAttribute(cell,"rowspan"),cspan||rspan?(this.addSpannedCellToMap(cell,map,ridx,c,cspan,rspan),c+=cspan?parseInt(cspan,10):1):(map[ridx][c]=new MapCell(cell),c++)}return this.map=map,map},getRowCells:function(row){var inlineTables=this.table.querySelectorAll("table"),inlineCells=inlineTables?queryInList(inlineTables,"th, td"):[],allCells=row.querySelectorAll("th, td"),tableCells=inlineCells.length>0?wysihtml5.lang.array(allCells).without(inlineCells):allCells;return tableCells},getTableRows:function(){var inlineTables=this.table.querySelectorAll("table"),inlineRows=inlineTables?queryInList(inlineTables,"tr"):[],allRows=this.table.querySelectorAll("tr"),tableRows=inlineRows.length>0?wysihtml5.lang.array(allRows).without(inlineRows):allRows;return tableRows},getMapIndex:function(cell){for(var r_length=this.map.length,c_length=this.map&&this.map[0]?this.map[0].length:0,r_idx=0;r_idx<r_length;r_idx++)for(var c_idx=0;c_idx<c_length;c_idx++)if(this.map[r_idx][c_idx].el===cell)return{row:r_idx,col:c_idx};return!1},getElementAtIndex:function(idx){return this.setTableMap(),this.map[idx.row]&&this.map[idx.row][idx.col]&&this.map[idx.row][idx.col].el?this.map[idx.row][idx.col].el:null},getMapElsTo:function(to_cell){var els=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(to_cell),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var temp_idx=this.idx_start;this.idx_start=this.idx_end,this.idx_end=temp_idx}if(this.idx_start.col>this.idx_end.col){var temp_cidx=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=temp_cidx}if(null!=this.idx_start&&null!=this.idx_end)for(var row=this.idx_start.row,maxr=this.idx_end.row;row<=maxr;row++)for(var col=this.idx_start.col,maxc=this.idx_end.col;col<=maxc;col++)els.push(this.map[row][col].el);return els},orderSelectionEnds:function(secondcell){if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(secondcell),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var temp_idx=this.idx_start;this.idx_start=this.idx_end,this.idx_end=temp_idx}if(this.idx_start.col>this.idx_end.col){var temp_cidx=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=temp_cidx}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(tag,nr,attrs){for(var cell,doc=this.table.ownerDocument,frag=doc.createDocumentFragment(),i=0;i<nr;i++){if(cell=doc.createElement(tag),attrs)for(var attr in attrs)attrs.hasOwnProperty(attr)&&cell.setAttribute(attr,attrs[attr]);cell.appendChild(document.createTextNode("")),frag.appendChild(cell)}return frag},correctColIndexForUnreals:function(col,row){for(var r=this.map[row],corrIdx=-1,i=0;i<col;i++)r[i].isReal&&corrIdx++;return corrIdx},getLastNewCellOnRow:function(row,rowLimit){for(var cell,idx,cells=this.getRowCells(row),cidx=0,cmax=cells.length;cidx<cmax;cidx++)if(cell=cells[cidx],idx=this.getMapIndex(cell),idx===!1||"undefined"!=typeof rowLimit&&idx.row!=rowLimit)return cell;return null},removeEmptyTable:function(){var cells=this.table.querySelectorAll("td, th");return(!cells||0==cells.length)&&(removeElement(this.table),!0)},splitRowToCells:function(cell){if(cell.isColspan){var colspan=parseInt(api.getAttribute(cell.el,"colspan")||1,10),cType=cell.el.tagName.toLowerCase();if(colspan>1){var newCells=this.createCells(cType,colspan-1);insertAfter(cell.el,newCells)}cell.el.removeAttribute("colspan")}},getRealRowEl:function(force,idx){var r=null,c=null;idx=idx||this.idx;for(var cidx=0,cmax=this.map[idx.row].length;cidx<cmax;cidx++)if(c=this.map[idx.row][cidx],c.isReal&&(r=api.getParentElement(c.el,{nodeName:["TR"]})))return r;return null===r&&force&&(r=api.getParentElement(this.map[idx.row][idx.col].el,{nodeName:["TR"]})||null),r},injectRowAt:function(row,col,colspan,cType,c){var r=this.getRealRowEl(!1,{row:row,col:col}),new_cells=this.createCells(cType,colspan);if(r){var n_cidx=this.correctColIndexForUnreals(col,row);n_cidx>=0?insertAfter(this.getRowCells(r)[n_cidx],new_cells):r.insertBefore(new_cells,r.firstChild)}else{var rr=this.table.ownerDocument.createElement("tr");rr.appendChild(new_cells),insertAfter(api.getParentElement(c.el,{nodeName:["TR"]}),rr)}},canMerge:function(to){if(this.to=to,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var temp_idx=this.idx_start;this.idx_start=this.idx_end,this.idx_end=temp_idx}if(this.idx_start.col>this.idx_end.col){var temp_cidx=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=temp_cidx}for(var row=this.idx_start.row,maxr=this.idx_end.row;row<=maxr;row++)for(var col=this.idx_start.col,maxc=this.idx_end.col;col<=maxc;col++)if(this.map[row][col].isColspan||this.map[row][col].isRowspan)return!1;return!0},decreaseCellSpan:function(cell,span){var nr=parseInt(api.getAttribute(cell.el,span),10)-1;nr>=1?cell.el.setAttribute(span,nr):(cell.el.removeAttribute(span),"colspan"==span&&(cell.isColspan=!1),"rowspan"==span&&(cell.isRowspan=!1),cell.firstCol=!0,cell.lastCol=!0,cell.firstRow=!0,cell.lastRow=!0,cell.isReal=!0)},removeSurplusLines:function(){var row,cell,ridx,rmax,cidx,cmax,allRowspan;if(this.setTableMap(),this.map){for(ridx=0,rmax=this.map.length;ridx<rmax;ridx++){for(row=this.map[ridx],allRowspan=!0,cidx=0,cmax=row.length;cidx<cmax;cidx++)if(cell=row[cidx],!(api.getAttribute(cell.el,"rowspan")&&parseInt(api.getAttribute(cell.el,"rowspan"),10)>1&&cell.firstRow!==!0)){allRowspan=!1;break}if(allRowspan)for(cidx=0;cidx<cmax;cidx++)this.decreaseCellSpan(row[cidx],"rowspan")}var tableRows=this.getTableRows();for(ridx=0,rmax=tableRows.length;ridx<rmax;ridx++)row=tableRows[ridx],0==row.childNodes.length&&/^\s*$/.test(row.textContent||row.innerText)&&removeElement(row)}},fillMissingCells:function(){var r_max=0,c_max=0,prevcell=null;if(this.setTableMap(),this.map){r_max=this.map.length;for(var ridx=0;ridx<r_max;ridx++)this.map[ridx].length>c_max&&(c_max=this.map[ridx].length);for(var row=0;row<r_max;row++)for(var col=0;col<c_max;col++)this.map[row]&&!this.map[row][col]&&col>0&&(this.map[row][col]=new MapCell(this.createCells("td",1)),prevcell=this.map[row][col-1],prevcell&&prevcell.el&&prevcell.el.parent&&insertAfter(this.map[row][col-1].el,this.map[row][col].el))}},rectify:function(){return!this.removeEmptyTable()&&(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var thisCell=this.map[this.idx.row][this.idx.col],colspan=api.getAttribute(thisCell.el,"colspan")?parseInt(api.getAttribute(thisCell.el,"colspan"),10):1,cType=thisCell.el.tagName.toLowerCase();if(thisCell.isRowspan){var rowspan=parseInt(api.getAttribute(thisCell.el,"rowspan"),10);if(rowspan>1)for(var nr=1,maxr=rowspan-1;nr<=maxr;nr++)this.injectRowAt(this.idx.row+nr,this.idx.col,colspan,cType,thisCell);thisCell.el.removeAttribute("rowspan")}this.splitRowToCells(thisCell)}},merge:function(to){if(this.rectify())if(this.canMerge(to)){for(var rowspan=this.idx_end.row-this.idx_start.row+1,colspan=this.idx_end.col-this.idx_start.col+1,row=this.idx_start.row,maxr=this.idx_end.row;row<=maxr;row++)for(var col=this.idx_start.col,maxc=this.idx_end.col;col<=maxc;col++)row==this.idx_start.row&&col==this.idx_start.col?(rowspan>1&&this.map[row][col].el.setAttribute("rowspan",rowspan),colspan>1&&this.map[row][col].el.setAttribute("colspan",colspan)):(/^\s*<br\/?>\s*$/.test(this.map[row][col].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[row][col].el.innerHTML),removeElement(this.map[row][col].el));this.rectify()}else window.console},collapseCellToNextRow:function(cell){var cellIdx=this.getMapIndex(cell.el),newRowIdx=cellIdx.row+1,newIdx={row:newRowIdx,col:cellIdx.col};if(newRowIdx<this.map.length){var row=this.getRealRowEl(!1,newIdx);if(null!==row){var n_cidx=this.correctColIndexForUnreals(newIdx.col,newIdx.row);if(n_cidx>=0)insertAfter(this.getRowCells(row)[n_cidx],cell.el);else{var lastCell=this.getLastNewCellOnRow(row,newRowIdx);null!==lastCell?insertAfter(lastCell,cell.el):row.insertBefore(cell.el,row.firstChild)}parseInt(api.getAttribute(cell.el,"rowspan"),10)>2?cell.el.setAttribute("rowspan",parseInt(api.getAttribute(cell.el,"rowspan"),10)-1):cell.el.removeAttribute("rowspan")}}},removeRowCell:function(cell){cell.isReal?cell.isRowspan?this.collapseCellToNextRow(cell):removeElement(cell.el):parseInt(api.getAttribute(cell.el,"rowspan"),10)>2?cell.el.setAttribute("rowspan",parseInt(api.getAttribute(cell.el,"rowspan"),10)-1):cell.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var cells=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var modRow=this.map[this.idx.row],cidx=0,cmax=modRow.length;cidx<cmax;cidx++)modRow[cidx].isReal&&cells.push(modRow[cidx].el);return cells},getColumnElementsByCell:function(){var cells=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var ridx=0,rmax=this.map.length;ridx<rmax;ridx++)this.map[ridx][this.idx.col]&&this.map[ridx][this.idx.col].isReal&&cells.push(this.map[ridx][this.idx.col].el);return cells},removeRow:function(){var oldRow=api.getParentElement(this.cell,{nodeName:["TR"]});if(oldRow){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var modRow=this.map[this.idx.row],cidx=0,cmax=modRow.length;cidx<cmax;cidx++)modRow[cidx].modified||(this.setCellAsModified(modRow[cidx]),this.removeRowCell(modRow[cidx]));removeElement(oldRow)}},removeColCell:function(cell){cell.isColspan?parseInt(api.getAttribute(cell.el,"colspan"),10)>2?cell.el.setAttribute("colspan",parseInt(api.getAttribute(cell.el,"colspan"),10)-1):cell.el.removeAttribute("colspan"):cell.isReal&&removeElement(cell.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var ridx=0,rmax=this.map.length;ridx<rmax;ridx++)this.map[ridx][this.idx.col].modified||(this.setCellAsModified(this.map[ridx][this.idx.col]),this.removeColCell(this.map[ridx][this.idx.col]))},remove:function(what){if(this.rectify()){switch(what){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(where){var doc=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==where&&api.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(api.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(var modRow=this.map[this.idx.row],newRow=doc.createElement("tr"),ridx=0,rmax=modRow.length;ridx<rmax;ridx++)modRow[ridx].modified||(this.setCellAsModified(modRow[ridx]),this.addRowCell(modRow[ridx],newRow,where));switch(where){case"below":insertAfter(this.getRealRowEl(!0),newRow);break;case"above":var cr=api.getParentElement(this.map[this.idx.row][this.idx.col].el,{nodeName:["TR"]});cr&&cr.parentNode.insertBefore(newRow,cr)}}},addRowCell:function(cell,row,where){var colSpanAttr=cell.isColspan?{colspan:api.getAttribute(cell.el,"colspan")}:null;cell.isReal?"above"!=where&&cell.isRowspan?cell.el.setAttribute("rowspan",parseInt(api.getAttribute(cell.el,"rowspan"),10)+1):row.appendChild(this.createCells("td",1,colSpanAttr)):"above"!=where&&cell.isRowspan&&cell.lastRow?row.appendChild(this.createCells("td",1,colSpanAttr)):c.isRowspan&&cell.el.attr("rowspan",parseInt(api.getAttribute(cell.el,"rowspan"),10)+1)},add:function(where){this.rectify()&&("below"!=where&&"above"!=where||this.addRow(where),"before"!=where&&"after"!=where||this.addColumn(where))},addColCell:function(cell,ridx,where){var doAdd,cType=cell.el.tagName.toLowerCase();switch(where){case"before":doAdd=!cell.isColspan||cell.firstCol;break;case"after":doAdd=!cell.isColspan||cell.lastCol||cell.isColspan&&c.el==this.cell}if(doAdd){switch(where){case"before":cell.el.parentNode.insertBefore(this.createCells(cType,1),cell.el);break;case"after":insertAfter(cell.el,this.createCells(cType,1))}cell.isRowspan&&this.handleCellAddWithRowspan(cell,ridx+1,where)}else cell.el.setAttribute("colspan",parseInt(api.getAttribute(cell.el,"colspan"),10)+1)},addColumn:function(where){var row,modCell;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==where&&api.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(api.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1)for(var ridx=0,rmax=this.map.length;ridx<rmax;ridx++)row=this.map[ridx],row[this.idx.col]&&(modCell=row[this.idx.col],modCell.modified||(this.setCellAsModified(modCell),this.addColCell(modCell,ridx,where)))},handleCellAddWithRowspan:function(cell,ridx,where){for(var cidx,temp_r_cells,nrow,addRowsNr=parseInt(api.getAttribute(this.cell,"rowspan"),10)-1,crow=api.getParentElement(cell.el,{nodeName:["TR"]}),cType=cell.el.tagName.toLowerCase(),doc=this.table.ownerDocument,i=0;i<addRowsNr;i++)if(cidx=this.correctColIndexForUnreals(this.idx.col,ridx+i),crow=nextNode(crow,"tr"))if(cidx>0)switch(where){case"before":temp_r_cells=this.getRowCells(crow),cidx>0&&this.map[ridx+i][this.idx.col].el!=temp_r_cells[cidx]&&cidx==temp_r_cells.length-1?insertAfter(temp_r_cells[cidx],this.createCells(cType,1)):temp_r_cells[cidx].parentNode.insertBefore(this.createCells(cType,1),temp_r_cells[cidx]);break;case"after":insertAfter(this.getRowCells(crow)[cidx],this.createCells(cType,1))}else crow.insertBefore(this.createCells(cType,1),crow.firstChild);else nrow=doc.createElement("tr"),nrow.appendChild(this.createCells(cType,1)),this.table.appendChild(nrow)}},api.table={getCellsBetween:function(cell1,cell2){var c1=new TableModifyerByCell(cell1);return c1.getMapElsTo(cell2)},addCells:function(cell,where){var c=new TableModifyerByCell(cell);c.add(where)},removeCells:function(cell,what){var c=new TableModifyerByCell(cell);c.remove(what)},mergeCellsBetween:function(cell1,cell2){var c1=new TableModifyerByCell(cell1);c1.merge(cell2)},unmergeCell:function(cell){var c=new TableModifyerByCell(cell);c.unmerge()},orderSelectionEnds:function(cell,cell2){var c=new TableModifyerByCell(cell);return c.orderSelectionEnds(cell2)},indexOf:function(cell){var c=new TableModifyerByCell(cell);return c.setTableMap(),c.getMapIndex(cell)},findCell:function(table,idx){var c=new TableModifyerByCell(null,table);return c.getElementAtIndex(idx)},findRowByCell:function(cell){var c=new TableModifyerByCell(cell);return c.getRowElementsByCell()},findColumnByCell:function(cell){var c=new TableModifyerByCell(cell);return c.getColumnElementsByCell()},canMerge:function(cell1,cell2){var c=new TableModifyerByCell(cell1);return c.canMerge(cell2)}}}(wysihtml5),wysihtml5.dom.query=function(elements,query){var q,ret=[];elements.nodeType&&(elements=[elements]);for(var e=0,len=elements.length;e<len;e++)if(q=elements[e].querySelectorAll(query))for(var i=q.length;i--;ret.unshift(q[i]));return ret},wysihtml5.dom.compareDocumentPosition=function(){var documentElement=document.documentElement;return documentElement.compareDocumentPosition?function(container,element){return container.compareDocumentPosition(element)}:function(container,element){var thisOwner,otherOwner;if(thisOwner=9===container.nodeType?container:container.ownerDocument,otherOwner=9===element.nodeType?element:element.ownerDocument,container===element)return 0;if(container===element.ownerDocument)return 20;if(container.ownerDocument===element)return 10;if(thisOwner!==otherOwner)return 1;if(2===container.nodeType&&container.childNodes&&wysihtml5.lang.array(container.childNodes).indexOf(element)!==-1)return 20;if(2===element.nodeType&&element.childNodes&&wysihtml5.lang.array(element.childNodes).indexOf(container)!==-1)return 10;for(var point=container,parents=[],previous=null;point;){if(point==element)return 10;parents.push(point),point=point.parentNode}for(point=element,previous=null;point;){if(point==container)return 20;var location_index=wysihtml5.lang.array(parents).indexOf(point);if(location_index!==-1){var smallest_common_ancestor=parents[location_index],this_index=wysihtml5.lang.array(smallest_common_ancestor.childNodes).indexOf(parents[location_index-1]),other_index=wysihtml5.lang.array(smallest_common_ancestor.childNodes).indexOf(previous);return this_index>other_index?2:4}previous=point,point=point.parentNode}return 1}}(),wysihtml5.dom.unwrap=function(node){if(node.parentNode){for(;node.lastChild;)wysihtml5.dom.insert(node.lastChild).after(node);node.parentNode.removeChild(node)}},wysihtml5.dom.getPastedHtml=function(event){var html;return event.clipboardData&&(wysihtml5.lang.array(event.clipboardData.types).contains("text/html")?html=event.clipboardData.getData("text/html"):wysihtml5.lang.array(event.clipboardData.types).contains("text/plain")&&(html=wysihtml5.lang.string(event.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),html},wysihtml5.dom.getPastedHtmlWithDiv=function(composer,f){var selBookmark=composer.selection.getBookmark(),doc=composer.element.ownerDocument,cleanerDiv=doc.createElement("DIV");doc.body.appendChild(cleanerDiv),cleanerDiv.style.width="1px",cleanerDiv.style.height="1px",cleanerDiv.style.overflow="hidden",cleanerDiv.setAttribute("contenteditable","true"),cleanerDiv.focus(),setTimeout(function(){composer.selection.setBookmark(selBookmark),f(cleanerDiv.innerHTML),cleanerDiv.parentNode.removeChild(cleanerDiv)},0)},wysihtml5.quirks.cleanPastedHTML=function(){var styleToRegex=function(styleStr){var trimmedStr=wysihtml5.lang.string(styleStr).trim(),escapedStr=trimmedStr.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+escapedStr+"$).)*$","i")},extendRulesWithStyleExceptions=function(rules,exceptStyles){var tag,style,newRules=wysihtml5.lang.object(rules).clone(!0);for(tag in newRules.tags)if(newRules.tags.hasOwnProperty(tag)&&newRules.tags[tag].keep_styles)for(style in newRules.tags[tag].keep_styles)newRules.tags[tag].keep_styles.hasOwnProperty(style)&&exceptStyles[style]&&(newRules.tags[tag].keep_styles[style]=styleToRegex(exceptStyles[style]));return newRules},pickRuleset=function(ruleset,html){var defaultSet;if(!ruleset)return null;for(var i=0,max=ruleset.length;i<max;i++)if(ruleset[i].condition||(defaultSet=ruleset[i].set),ruleset[i].condition&&ruleset[i].condition.test(html))return ruleset[i].set;return defaultSet};return function(html,options){var newHtml,exceptStyles={color:wysihtml5.dom.getStyle("color").from(options.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(options.referenceNode)},rules=extendRulesWithStyleExceptions(pickRuleset(options.rules,html)||{},exceptStyles);return newHtml=wysihtml5.dom.parse(html,{rules:rules,cleanUp:!0,context:options.referenceNode.ownerDocument,uneditableClass:options.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}(),wysihtml5.quirks.ensureProperClearing=function(){var clearIfNecessary=function(){var element=this;setTimeout(function(){var innerHTML=element.innerHTML.toLowerCase();"<p>&nbsp;</p>"!=innerHTML&&"<p>&nbsp;</p><p>&nbsp;</p>"!=innerHTML||(element.innerHTML="")},0)};return function(composer){wysihtml5.dom.observe(composer.element,["cut","keydown"],clearIfNecessary)}}(),function(wysihtml5){var TILDE_ESCAPED="%7E";wysihtml5.quirks.getCorrectInnerHTML=function(element){var innerHTML=element.innerHTML;if(innerHTML.indexOf(TILDE_ESCAPED)===-1)return innerHTML;var url,urlToSearch,length,i,elementsWithTilde=element.querySelectorAll("[href*='~'], [src*='~']");for(i=0,length=elementsWithTilde.length;i<length;i++)url=elementsWithTilde[i].href||elementsWithTilde[i].src,urlToSearch=wysihtml5.lang.string(url).replace("~").by(TILDE_ESCAPED),innerHTML=wysihtml5.lang.string(innerHTML).replace(urlToSearch).by(url);return innerHTML}}(wysihtml5),function(wysihtml5){var CLASS_NAME="wysihtml5-quirks-redraw";wysihtml5.quirks.redraw=function(element){wysihtml5.dom.addClass(element,CLASS_NAME),wysihtml5.dom.removeClass(element,CLASS_NAME);try{var doc=element.ownerDocument;doc.execCommand("italic",!1,null),doc.execCommand("italic",!1,null)}catch(e){}}}(wysihtml5),wysihtml5.quirks.tableCellsSelection=function(editable,editor){function init(){return dom.observe(editable,"mousedown",function(event){var target=wysihtml5.dom.getParentElement(event.target,{nodeName:["TD","TH"]});target&&handleSelectionMousedown(target)}),select}function handleSelectionMousedown(target){select.start=target,select.end=target,select.cells=[target],select.table=dom.getParentElement(select.start,{nodeName:["TABLE"]}),select.table&&(removeCellSelections(),dom.addClass(target,selection_class),moveHandler=dom.observe(editable,"mousemove",handleMouseMove),upHandler=dom.observe(editable,"mouseup",handleMouseUp),editor.fire("tableselectstart").fire("tableselectstart:composer"))}function removeCellSelections(){if(editable){var selectedCells=editable.querySelectorAll("."+selection_class);if(selectedCells.length>0)for(var i=0;i<selectedCells.length;i++)dom.removeClass(selectedCells[i],selection_class)}}function addSelections(cells){for(var i=0;i<cells.length;i++)dom.addClass(cells[i],selection_class)}function handleMouseMove(event){var oldEnd,curTable=null,cell=dom.getParentElement(event.target,{nodeName:["TD","TH"]});cell&&select.table&&select.start&&(curTable=dom.getParentElement(cell,{nodeName:["TABLE"]}),curTable&&curTable===select.table&&(removeCellSelections(),oldEnd=select.end,select.end=cell,select.cells=dom.table.getCellsBetween(select.start,cell),select.cells.length>1&&editor.composer.selection.deselect(),addSelections(select.cells),select.end!==oldEnd&&editor.fire("tableselectchange").fire("tableselectchange:composer")))}function handleMouseUp(event){moveHandler.stop(),upHandler.stop(),editor.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){bindSideclick()},0)}function bindSideclick(){var sideClickHandler=dom.observe(editable.ownerDocument,"click",function(event){sideClickHandler.stop(),dom.getParentElement(event.target,{nodeName:["TABLE"]})!=select.table&&(removeCellSelections(),select.table=null,select.start=null,select.end=null,editor.fire("tableunselect").fire("tableunselect:composer"))})}function selectCells(start,end){select.start=start,select.end=end,select.table=dom.getParentElement(select.start,{nodeName:["TABLE"]}),selectedCells=dom.table.getCellsBetween(select.start,select.end),addSelections(selectedCells),bindSideclick(),editor.fire("tableselect").fire("tableselect:composer")}var dom=wysihtml5.dom,select={table:null,start:null,end:null,cells:null,select:selectCells},selection_class="wysiwyg-tmp-selected-cell",moveHandler=null,upHandler=null;return init()},function(wysihtml5){var RGBA_REGEX=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,RGB_REGEX=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,HEX6_REGEX=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,HEX3_REGEX=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,param_REGX=function(p){return new RegExp("(^|\\s|;)"+p+"\\s*:\\s*[^;$]+","gi")};wysihtml5.quirks.styleParser={parseColor:function(stylesStr,paramName){var str,colorMatch,paramRegex=param_REGX(paramName),params=stylesStr.match(paramRegex),radix=10;if(params){for(var i=params.length;i--;)params[i]=wysihtml5.lang.string(params[i].split(":")[1]).trim();if(str=params[params.length-1],RGBA_REGEX.test(str))colorMatch=str.match(RGBA_REGEX);else if(RGB_REGEX.test(str))colorMatch=str.match(RGB_REGEX);else if(HEX6_REGEX.test(str))colorMatch=str.match(HEX6_REGEX),radix=16;else if(HEX3_REGEX.test(str))return colorMatch=str.match(HEX3_REGEX),colorMatch.shift(),colorMatch.push(1),wysihtml5.lang.array(colorMatch).map(function(d,idx){return idx<3?16*parseInt(d,16)+parseInt(d,16):parseFloat(d)});if(colorMatch)return colorMatch.shift(),colorMatch[3]||colorMatch.push(1),wysihtml5.lang.array(colorMatch).map(function(d,idx){return idx<3?parseInt(d,radix):parseFloat(d)})}return!1},unparseColor:function(val,props){if(props){if("hex"==props)return val[0].toString(16).toUpperCase()+val[1].toString(16).toUpperCase()+val[2].toString(16).toUpperCase();if("hash"==props)return"#"+val[0].toString(16).toUpperCase()+val[1].toString(16).toUpperCase()+val[2].toString(16).toUpperCase();if("rgb"==props)return"rgb("+val[0]+","+val[1]+","+val[2]+")";if("rgba"==props)return"rgba("+val[0]+","+val[1]+","+val[2]+","+val[3]+")";if("csv"==props)return val[0]+","+val[1]+","+val[2]+","+val[3]}return val[3]&&1!==val[3]?"rgba("+val[0]+","+val[1]+","+val[2]+","+val[3]+")":"rgb("+val[0]+","+val[1]+","+val[2]+")"},parseFontSize:function(stylesStr){var params=stylesStr.match(param_REGX("font-size"));return!!params&&wysihtml5.lang.string(params[params.length-1].split(":")[1]).trim()}}}(wysihtml5),function(wysihtml5){function _getCumulativeOffsetTop(element){var top=0;if(element.parentNode)do top+=element.offsetTop||0,element=element.offsetParent;while(element);return top}function getDepth(ancestor,descendant){for(var ret=0;descendant!==ancestor;)if(ret++,descendant=descendant.parentNode,!descendant)throw new Error("not a descendant of ancestor!");return ret}function expandRangeToSurround(range){if(!range.canSurroundContents())for(var common=range.commonAncestorContainer,start_depth=getDepth(common,range.startContainer),end_depth=getDepth(common,range.endContainer);!range.canSurroundContents();)start_depth>end_depth?(range.setStartBefore(range.startContainer),start_depth=getDepth(common,range.startContainer)):(range.setEndAfter(range.endContainer),end_depth=getDepth(common,range.endContainer))}var dom=wysihtml5.dom;wysihtml5.Selection=Base.extend({constructor:function(editor,contain,unselectableClass){window.rangy.init(),this.editor=editor,this.composer=editor.composer,this.doc=this.composer.doc,this.contain=contain,this.unselectableClass=unselectableClass||!1},getBookmark:function(){var range=this.getRange();return range&&expandRangeToSurround(range),range&&range.cloneRange()},setBookmark:function(bookmark){bookmark&&this.setSelection(bookmark)},setBefore:function(node){var range=rangy.createRange(this.doc);return range.setStartBefore(node),
range.setEndBefore(node),this.setSelection(range)},setAfter:function(node){var range=rangy.createRange(this.doc);return range.setStartAfter(node),range.setEndAfter(node),this.setSelection(range)},selectNode:function(node,avoidInvisibleSpace){var range=rangy.createRange(this.doc),isElement=node.nodeType===wysihtml5.ELEMENT_NODE,canHaveHTML="canHaveHTML"in node?node.canHaveHTML:"IMG"!==node.nodeName,content=isElement?node.innerHTML:node.data,isEmpty=""===content||content===wysihtml5.INVISIBLE_SPACE,displayStyle=dom.getStyle("display").from(node),isBlockElement="block"===displayStyle||"list-item"===displayStyle;if(isEmpty&&isElement&&canHaveHTML&&!avoidInvisibleSpace)try{node.innerHTML=wysihtml5.INVISIBLE_SPACE}catch(e){}canHaveHTML?range.selectNodeContents(node):range.selectNode(node),canHaveHTML&&isEmpty&&isElement?range.collapse(isBlockElement):canHaveHTML&&isEmpty&&(range.setStartAfter(node),range.setEndAfter(node)),this.setSelection(range)},getSelectedNode:function(controlRange){var selection,range;return controlRange&&this.doc.selection&&"Control"===this.doc.selection.type&&(range=this.doc.selection.createRange(),range&&range.length)?range.item(0):(selection=this.getSelection(this.doc),selection.focusNode===selection.anchorNode?selection.focusNode:(range=this.getRange(this.doc),range?range.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var range=this.getRange();expandRangeToSurround(range),this.setSelection(range)},getSelectedOwnNodes:function(controlRange){for(var ranges=this.getOwnRanges(),ownNodes=[],i=0,maxi=ranges.length;i<maxi;i++)ownNodes.push(ranges[i].commonAncestorContainer||this.doc.body);return ownNodes},findNodesInSelection:function(nodeTypes){for(var curNodes,ranges=this.getOwnRanges(),nodes=[],i=0,maxi=ranges.length;i<maxi;i++)curNodes=ranges[i].getNodes([1],function(node){return wysihtml5.lang.array(nodeTypes).contains(node.nodeName)}),nodes=nodes.concat(curNodes);return nodes},containsUneditable:function(){for(var uneditables=this.getOwnUneditables(),selection=this.getSelection(),i=0,maxi=uneditables.length;i<maxi;i++)if(selection.containsNode(uneditables[i]))return!0;return!1},deleteContents:function(){for(var ranges=this.getOwnRanges(),i=ranges.length;i--;)ranges[i].deleteContents();this.setSelection(ranges[0])},getPreviousNode:function(node,ignoreEmpty){if(!node){var selection=this.getSelection();node=selection.anchorNode}if(node===this.contain)return!1;var parent,ret=node.previousSibling;return ret!==this.contain&&(ret&&3!==ret.nodeType&&1!==ret.nodeType?ret=this.getPreviousNode(ret,ignoreEmpty):ret&&3===ret.nodeType&&/^\s*$/.test(ret.textContent)?ret=this.getPreviousNode(ret,ignoreEmpty):ignoreEmpty&&ret&&1===ret.nodeType&&!wysihtml5.lang.array(["BR","HR","IMG"]).contains(ret.nodeName)&&/^[\s]*$/.test(ret.innerHTML)?ret=this.getPreviousNode(ret,ignoreEmpty):ret||node===this.contain||(parent=node.parentNode,parent!==this.contain&&(ret=this.getPreviousNode(parent,ignoreEmpty))),ret!==this.contain&&ret)},getSelectionParentsByTag:function(tagName){for(var curEl,nodes=this.getSelectedOwnNodes(),parents=[],i=0,maxi=nodes.length;i<maxi;i++)curEl=nodes[i].nodeName&&"LI"===nodes[i].nodeName?nodes[i]:wysihtml5.dom.getParentElement(nodes[i],{nodeName:["LI"]},!1,this.contain),curEl&&parents.push(curEl);return parents.length?parents:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var range=this.getRange(),sNode=range.startContainer,pos=range.startOffset,lastR=rangy.createRange(this.doc);return lastR.selectNodeContents(sNode),lastR.setStart(sNode,pos),lastR}},caretIsLastInSelection:function(){var endc=(rangy.createRange(this.doc),this.getSelection(),this.getRangeToNodeEnd().cloneContents()),endtxt=endc.textContent;return/^\s*$/.test(endtxt)},caretIsFirstInSelection:function(){var r=rangy.createRange(this.doc),s=this.getSelection(),range=this.getRange(),startNode=range.startContainer;return startNode.nodeType===wysihtml5.TEXT_NODE?this.isCollapsed()&&startNode.nodeType===wysihtml5.TEXT_NODE&&/^\s*$/.test(startNode.data.substr(0,range.startOffset)):(r.selectNodeContents(this.getRange().commonAncestorContainer),r.collapse(!0),this.isCollapsed()&&(r.startContainer===s.anchorNode||r.endContainer===s.anchorNode)&&r.startOffset===s.anchorOffset)},caretIsInTheBeginnig:function(ofNode){var selection=this.getSelection(),node=selection.anchorNode,offset=selection.anchorOffset;return ofNode?0===offset&&(node.nodeName&&node.nodeName===ofNode.toUpperCase()||wysihtml5.dom.getParentElement(node.parentNode,{nodeName:ofNode},1)):0===offset&&!this.getPreviousNode(node,!0)},caretIsBeforeUneditable:function(){var selection=this.getSelection(),node=selection.anchorNode,offset=selection.anchorOffset;if(0===offset){var prevNode=this.getPreviousNode(node,!0);if(prevNode)for(var uneditables=this.getOwnUneditables(),i=0,maxi=uneditables.length;i<maxi;i++)if(prevNode===uneditables[i])return uneditables[i]}return!1},executeAndRestoreRangy:function(method,restoreScrollPosition){var win=this.doc.defaultView||this.doc.parentWindow,sel=rangy.saveSelection(win);if(sel)try{method()}catch(e){setTimeout(function(){throw e},0)}else method();rangy.restoreSelection(sel)},executeAndRestore:function(method,restoreScrollPosition){var caretPlaceholder,newCaretPlaceholder,nextSibling,prevSibling,node,node2,range2,newRange,body=this.doc.body,oldScrollTop=restoreScrollPosition&&body.scrollTop,oldScrollLeft=restoreScrollPosition&&body.scrollLeft,className="_wysihtml5-temp-placeholder",placeholderHtml='<span class="'+className+'">'+wysihtml5.INVISIBLE_SPACE+"</span>",range=this.getRange(!0);if(!range)return void method(body,body);range.collapsed||(range2=range.cloneRange(),node2=range2.createContextualFragment(placeholderHtml),range2.collapse(!1),range2.insertNode(node2),range2.detach()),node=range.createContextualFragment(placeholderHtml),range.insertNode(node),node2&&(caretPlaceholder=this.contain.querySelectorAll("."+className),range.setStartBefore(caretPlaceholder[0]),range.setEndAfter(caretPlaceholder[caretPlaceholder.length-1])),this.setSelection(range);try{method(range.startContainer,range.endContainer)}catch(e){setTimeout(function(){throw e},0)}if(caretPlaceholder=this.contain.querySelectorAll("."+className),caretPlaceholder&&caretPlaceholder.length){newRange=rangy.createRange(this.doc),nextSibling=caretPlaceholder[0].nextSibling,caretPlaceholder.length>1&&(prevSibling=caretPlaceholder[caretPlaceholder.length-1].previousSibling),prevSibling&&nextSibling?(newRange.setStartBefore(nextSibling),newRange.setEndAfter(prevSibling)):(newCaretPlaceholder=this.doc.createTextNode(wysihtml5.INVISIBLE_SPACE),dom.insert(newCaretPlaceholder).after(caretPlaceholder[0]),newRange.setStartBefore(newCaretPlaceholder),newRange.setEndAfter(newCaretPlaceholder)),this.setSelection(newRange);for(var i=caretPlaceholder.length;i--;)caretPlaceholder[i].parentNode.removeChild(caretPlaceholder[i])}else this.contain.focus();restoreScrollPosition&&(body.scrollTop=oldScrollTop,body.scrollLeft=oldScrollLeft);try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(e2){}},set:function(node,offset){var newRange=rangy.createRange(this.doc);newRange.setStart(node,offset||0),this.setSelection(newRange)},insertHTML:function(html){var lastChild,node=(rangy.createRange(this.doc),this.doc.createElement("DIV")),fragment=this.doc.createDocumentFragment();for(node.innerHTML=html,lastChild=node.lastChild;node.firstChild;)fragment.appendChild(node.firstChild);this.insertNode(fragment),lastChild&&this.setAfter(lastChild)},insertNode:function(node){var range=this.getRange();range&&range.insertNode(node)},surround:function(nodeOptions){var node,ranges=this.getOwnRanges(),nodes=[];if(0==ranges.length)return nodes;for(var i=ranges.length;i--;){node=this.doc.createElement(nodeOptions.nodeName),nodes.push(node),nodeOptions.className&&(node.className=nodeOptions.className),nodeOptions.cssStyle&&node.setAttribute("style",nodeOptions.cssStyle);try{ranges[i].surroundContents(node),this.selectNode(node)}catch(e){node.appendChild(ranges[i].extractContents()),ranges[i].insertNode(node)}}return nodes},deblockAndSurround:function(nodeOptions){var tempDivElements,tempElements,firstChild,tempElement=this.doc.createElement("div"),range=rangy.createRange(this.doc);if(tempElement.className=nodeOptions.className,this.composer.commands.exec("formatBlock",nodeOptions.nodeName,nodeOptions.className),tempDivElements=this.contain.querySelectorAll("."+nodeOptions.className),tempDivElements[0])for(tempDivElements[0].parentNode.insertBefore(tempElement,tempDivElements[0]),range.setStartBefore(tempDivElements[0]),range.setEndAfter(tempDivElements[tempDivElements.length-1]),tempElements=range.extractContents();tempElements.firstChild;)if(firstChild=tempElements.firstChild,1==firstChild.nodeType&&wysihtml5.dom.hasClass(firstChild,nodeOptions.className)){for(;firstChild.firstChild;)tempElement.appendChild(firstChild.firstChild);"BR"!==firstChild.nodeName&&tempElement.appendChild(this.doc.createElement("br")),tempElements.removeChild(firstChild)}else tempElement.appendChild(firstChild);else tempElement=null;return tempElement},scrollIntoView:function(){var offsetTop,doc=this.doc,tolerance=5,hasScrollBars=doc.documentElement.scrollHeight>doc.documentElement.offsetHeight,tempElement=doc._wysihtml5ScrollIntoViewElement=doc._wysihtml5ScrollIntoViewElement||function(){var element=doc.createElement("span");return element.innerHTML=wysihtml5.INVISIBLE_SPACE,element}();hasScrollBars&&(this.insertNode(tempElement),offsetTop=_getCumulativeOffsetTop(tempElement),tempElement.parentNode.removeChild(tempElement),offsetTop>=doc.body.scrollTop+doc.documentElement.offsetHeight-tolerance&&(doc.body.scrollTop=offsetTop))},selectLine:function(){wysihtml5.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var win=this.doc.defaultView,selection=win.getSelection();selection.modify("move","left","lineboundary"),selection.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var rangeBottom,rangeEnd,measureNode,i,j,range=this.doc.selection.createRange(),rangeTop=range.boundingTop,scrollWidth=this.doc.body.scrollWidth;if(range.moveToPoint){for(0===rangeTop&&(measureNode=this.doc.createElement("span"),this.insertNode(measureNode),rangeTop=measureNode.offsetTop,measureNode.parentNode.removeChild(measureNode)),rangeTop+=1,i=-10;i<scrollWidth;i+=2)try{range.moveToPoint(i,rangeTop);break}catch(e1){}for(rangeBottom=rangeTop,rangeEnd=this.doc.selection.createRange(),j=scrollWidth;j>=0;j--)try{rangeEnd.moveToPoint(j,rangeBottom);break}catch(e2){}range.setEndPoint("EndToEnd",rangeEnd),range.select()}},getText:function(){var selection=this.getSelection();return selection?selection.toString():""},getNodes:function(nodeType,filter){var range=this.getRange();return range?range.getNodes([nodeType],filter):[]},fixRangeOverflow:function(range){if(this.contain&&this.contain.firstChild&&range){var containment=range.compareNode(this.contain);if(2!==containment)1===containment&&range.setStartBefore(this.contain.firstChild),0===containment&&range.setEndAfter(this.contain.lastChild),3===containment&&(range.setStartBefore(this.contain.firstChild),range.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(range)){var previousElementSibling=range.endContainer.previousElementSibling;previousElementSibling&&range.setEnd(previousElementSibling,this._endOffsetForNode(previousElementSibling))}}},_endOffsetForNode:function(node){var range=document.createRange();return range.selectNodeContents(node),range.endOffset},_detectInlineRangeProblems:function(range){var position=dom.compareDocumentPosition(range.startContainer,range.endContainer);return 0==range.endOffset&&4&position},getRange:function(dontFix){var selection=this.getSelection(),range=selection&&selection.rangeCount&&selection.getRangeAt(0);return dontFix!==!0&&this.fixRangeOverflow(range),range},getOwnUneditables:function(){var allUneditables=dom.query(this.contain,"."+this.unselectableClass),deepUneditables=dom.query(allUneditables,"."+this.unselectableClass);return wysihtml5.lang.array(allUneditables).without(deepUneditables)},getOwnRanges:function(){var tmpRanges,ranges=[],r=this.getRange();if(r&&ranges.push(r),this.unselectableClass&&this.contain&&r){var tmpRange,uneditables=this.getOwnUneditables();if(uneditables.length>0)for(var i=0,imax=uneditables.length;i<imax;i++){tmpRanges=[];for(var j=0,jmax=ranges.length;j<jmax;j++){if(ranges[j])switch(ranges[j].compareNode(uneditables[i])){case 2:break;case 3:tmpRange=ranges[j].cloneRange(),tmpRange.setEndBefore(uneditables[i]),tmpRanges.push(tmpRange),tmpRange=ranges[j].cloneRange(),tmpRange.setStartAfter(uneditables[i]),tmpRanges.push(tmpRange);break;default:tmpRanges.push(ranges[j])}ranges=tmpRanges}}}return ranges},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(range){var win=this.doc.defaultView||this.doc.parentWindow,selection=rangy.getSelection(win);return selection.setSingleRange(range)},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},isEndToEndInNode:function(nodeNames){var range=this.getRange(),parentElement=range.commonAncestorContainer,startNode=range.startContainer,endNode=range.endContainer;if(parentElement.nodeType===wysihtml5.TEXT_NODE&&(parentElement=parentElement.parentNode),startNode.nodeType===wysihtml5.TEXT_NODE&&!/^\s*$/.test(startNode.data.substr(range.startOffset)))return!1;if(endNode.nodeType===wysihtml5.TEXT_NODE&&!/^\s*$/.test(endNode.data.substr(range.endOffset)))return!1;for(;startNode&&startNode!==parentElement;){if(startNode.nodeType!==wysihtml5.TEXT_NODE&&!wysihtml5.dom.contains(parentElement,startNode))return!1;if(wysihtml5.dom.domNode(startNode).prev({ignoreBlankTexts:!0}))return!1;startNode=startNode.parentNode}for(;endNode&&endNode!==parentElement;){if(endNode.nodeType!==wysihtml5.TEXT_NODE&&!wysihtml5.dom.contains(parentElement,endNode))return!1;if(wysihtml5.dom.domNode(endNode).next({ignoreBlankTexts:!0}))return!1;endNode=endNode.parentNode}return!!wysihtml5.lang.array(nodeNames).contains(parentElement.nodeName)&&parentElement},deselect:function(){var sel=this.getSelection();sel&&sel.removeAllRanges()}})}(wysihtml5),function(wysihtml5,rangy){function hasClass(el,cssClass,regExp){if(!el.className)return!1;var matchingClassNames=el.className.match(regExp)||[];return matchingClassNames[matchingClassNames.length-1]===cssClass}function hasStyleAttr(el,regExp){if(!el.getAttribute||!el.getAttribute("style"))return!1;el.getAttribute("style").match(regExp);return!!el.getAttribute("style").match(regExp)}function addStyle(el,cssStyle,regExp){el.getAttribute("style")?(removeStyle(el,regExp),el.getAttribute("style")&&!/^\s*$/.test(el.getAttribute("style"))?el.setAttribute("style",cssStyle+";"+el.getAttribute("style")):el.setAttribute("style",cssStyle)):el.setAttribute("style",cssStyle)}function addClass(el,cssClass,regExp){el.className?(removeClass(el,regExp),el.className+=" "+cssClass):el.className=cssClass}function removeClass(el,regExp){el.className&&(el.className=el.className.replace(regExp,""))}function removeStyle(el,regExp){var s,s2=[];if(el.getAttribute("style")){s=el.getAttribute("style").split(";");for(var i=s.length;i--;)s[i].match(regExp)||/^\s*$/.test(s[i])||s2.push(s[i]);s2.length?el.setAttribute("style",s2.join(";")):el.removeAttribute("style")}}function getMatchingStyleRegexp(el,style){var regexes=[],sSplit=style.split(";"),elStyle=el.getAttribute("style");if(elStyle){elStyle=elStyle.replace(/\s/gi,"").toLowerCase(),regexes.push(new RegExp("(^|\\s|;)"+style.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var i=sSplit.length;i-- >0;)/^\s*$/.test(sSplit[i])||regexes.push(new RegExp("(^|\\s|;)"+sSplit[i].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var j=0,jmax=regexes.length;j<jmax;j++)if(elStyle.match(regexes[j]))return regexes[j]}return!1}function isMatchingAllready(node,tags,style,className){return style?getMatchingStyleRegexp(node,style):className?wysihtml5.dom.hasClass(node,className):rangy.dom.arrayContains(tags,node.tagName.toLowerCase())}function areMatchingAllready(nodes,tags,style,className){for(var i=nodes.length;i--;)if(!isMatchingAllready(nodes[i],tags,style,className))return!1;return!!nodes.length}function removeOrChangeStyle(el,style,regExp){var exactRegex=getMatchingStyleRegexp(el,style);return exactRegex?(removeStyle(el,exactRegex),"remove"):(addStyle(el,style,regExp),"change")}function hasSameClasses(el1,el2){return el1.className.replace(REG_EXP_WHITE_SPACE," ")==el2.className.replace(REG_EXP_WHITE_SPACE," ")}function replaceWithOwnChildren(el){for(var parent=el.parentNode;el.firstChild;)parent.insertBefore(el.firstChild,el);parent.removeChild(el)}function elementsHaveSameNonClassAttributes(el1,el2){if(el1.attributes.length!=el2.attributes.length)return!1;for(var attr1,attr2,name,i=0,len=el1.attributes.length;i<len;++i)if(attr1=el1.attributes[i],name=attr1.name,"class"!=name){if(attr2=el2.attributes.getNamedItem(name),attr1.specified!=attr2.specified)return!1;if(attr1.specified&&attr1.nodeValue!==attr2.nodeValue)return!1}return!0}function isSplitPoint(node,offset){return rangy.dom.isCharacterDataNode(node)?0==offset?!!node.previousSibling:offset!=node.length||!!node.nextSibling:offset>0&&offset<node.childNodes.length}function splitNodeAt(node,descendantNode,descendantOffset,container){var newNode;if(rangy.dom.isCharacterDataNode(descendantNode)&&(0==descendantOffset?(descendantOffset=rangy.dom.getNodeIndex(descendantNode),descendantNode=descendantNode.parentNode):descendantOffset==descendantNode.length?(descendantOffset=rangy.dom.getNodeIndex(descendantNode)+1,descendantNode=descendantNode.parentNode):newNode=rangy.dom.splitDataNode(descendantNode,descendantOffset)),!(newNode||container&&descendantNode===container)){newNode=descendantNode.cloneNode(!1),newNode.id&&newNode.removeAttribute("id");for(var child;child=descendantNode.childNodes[descendantOffset];)newNode.appendChild(child);rangy.dom.insertAfter(newNode,descendantNode)}return descendantNode==node?newNode:splitNodeAt(node,newNode.parentNode,rangy.dom.getNodeIndex(newNode),container)}function Merge(firstNode){this.isElementMerge=firstNode.nodeType==wysihtml5.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?firstNode.lastChild:firstNode,this.textNodes=[this.firstTextNode]}function HTMLApplier(tagNames,cssClass,similarClassRegExp,normalize,cssStyle,similarStyleRegExp,container){this.tagNames=tagNames||[defaultTagName],this.cssClass=cssClass||cssClass!==!1&&"",this.similarClassRegExp=similarClassRegExp,this.cssStyle=cssStyle||"",this.similarStyleRegExp=similarStyleRegExp,this.normalize=normalize,this.applyToAnyTagName=!1,this.container=container}var defaultTagName="span",REG_EXP_WHITE_SPACE=/\s+/g;Merge.prototype={doMerge:function(){for(var textNode,parent,text,textBits=[],i=0,len=this.textNodes.length;i<len;++i)textNode=this.textNodes[i],parent=textNode.parentNode,textBits[i]=textNode.data,i&&(parent.removeChild(textNode),parent.hasChildNodes()||parent.parentNode.removeChild(parent));return this.firstTextNode.data=text=textBits.join(""),text},getLength:function(){for(var i=this.textNodes.length,len=0;i--;)len+=this.textNodes[i].length;return len},toString:function(){for(var textBits=[],i=0,len=this.textNodes.length;i<len;++i)textBits[i]="'"+this.textNodes[i].data+"'";return"[Merge("+textBits.join(",")+")]"}},HTMLApplier.prototype={getAncestorWithClass:function(node){for(var cssClassMatch;node;){if(cssClassMatch=this.cssClass?hasClass(node,this.cssClass,this.similarClassRegExp):""===this.cssStyle,node.nodeType==wysihtml5.ELEMENT_NODE&&"false"!=node.getAttribute("contenteditable")&&rangy.dom.arrayContains(this.tagNames,node.tagName.toLowerCase())&&cssClassMatch)return node;node=node.parentNode}return!1},getAncestorWithStyle:function(node){for(var cssStyleMatch;node;){if(cssStyleMatch=!!this.cssStyle&&hasStyleAttr(node,this.similarStyleRegExp),node.nodeType==wysihtml5.ELEMENT_NODE&&"false"!=node.getAttribute("contenteditable")&&rangy.dom.arrayContains(this.tagNames,node.tagName.toLowerCase())&&cssStyleMatch)return node;node=node.parentNode}return!1},getMatchingAncestor:function(node){var ancestor=this.getAncestorWithClass(node),matchType=!1;return ancestor?this.cssStyle&&(matchType="class"):(ancestor=this.getAncestorWithStyle(node),ancestor&&(matchType="style")),{element:ancestor,type:matchType}},postApply:function(textNodes,range){for(var currentMerge,textNode,precedingTextNode,firstNode=textNodes[0],lastNode=textNodes[textNodes.length-1],merges=[],rangeStartNode=firstNode,rangeEndNode=lastNode,rangeStartOffset=0,rangeEndOffset=lastNode.length,i=0,len=textNodes.length;i<len;++i)textNode=textNodes[i],precedingTextNode=null,textNode&&textNode.parentNode&&(precedingTextNode=this.getAdjacentMergeableTextNode(textNode.parentNode,!1)),precedingTextNode?(currentMerge||(currentMerge=new Merge(precedingTextNode),merges.push(currentMerge)),currentMerge.textNodes.push(textNode),textNode===firstNode&&(rangeStartNode=currentMerge.firstTextNode,rangeStartOffset=rangeStartNode.length),textNode===lastNode&&(rangeEndNode=currentMerge.firstTextNode,rangeEndOffset=currentMerge.getLength())):currentMerge=null;if(lastNode&&lastNode.parentNode){var nextTextNode=this.getAdjacentMergeableTextNode(lastNode.parentNode,!0);nextTextNode&&(currentMerge||(currentMerge=new Merge(lastNode),merges.push(currentMerge)),currentMerge.textNodes.push(nextTextNode))}if(merges.length){for(i=0,len=merges.length;i<len;++i)merges[i].doMerge();range.setStart(rangeStartNode,rangeStartOffset),range.setEnd(rangeEndNode,rangeEndOffset)}},getAdjacentMergeableTextNode:function(node,forward){var adjacentNode,isTextNode=node.nodeType==wysihtml5.TEXT_NODE,el=isTextNode?node.parentNode:node,propName=forward?"nextSibling":"previousSibling";if(isTextNode){if(adjacentNode=node[propName],adjacentNode&&adjacentNode.nodeType==wysihtml5.TEXT_NODE)return adjacentNode}else if(adjacentNode=el[propName],adjacentNode&&this.areElementsMergeable(node,adjacentNode))return adjacentNode[forward?"firstChild":"lastChild"];return null},areElementsMergeable:function(el1,el2){return rangy.dom.arrayContains(this.tagNames,(el1.tagName||"").toLowerCase())&&rangy.dom.arrayContains(this.tagNames,(el2.tagName||"").toLowerCase())&&hasSameClasses(el1,el2)&&elementsHaveSameNonClassAttributes(el1,el2)},createContainer:function(doc){var el=doc.createElement(this.tagNames[0]);return this.cssClass&&(el.className=this.cssClass),this.cssStyle&&el.setAttribute("style",this.cssStyle),el},applyToTextNode:function(textNode){var parent=textNode.parentNode;if(1==parent.childNodes.length&&rangy.dom.arrayContains(this.tagNames,parent.tagName.toLowerCase()))this.cssClass&&addClass(parent,this.cssClass,this.similarClassRegExp),this.cssStyle&&addStyle(parent,this.cssStyle,this.similarStyleRegExp);else{var el=this.createContainer(rangy.dom.getDocument(textNode));textNode.parentNode.insertBefore(el,textNode),el.appendChild(textNode)}},isRemovable:function(el){return rangy.dom.arrayContains(this.tagNames,el.tagName.toLowerCase())&&""===wysihtml5.lang.string(el.className).trim()&&(!el.getAttribute("style")||""===wysihtml5.lang.string(el.getAttribute("style")).trim())},undoToTextNode:function(textNode,range,ancestorWithClass,ancestorWithStyle){var styleMode=!ancestorWithClass,ancestor=ancestorWithClass||ancestorWithStyle,styleChanged=!1;if(!range.containsNode(ancestor)){var ancestorRange=range.cloneRange();ancestorRange.selectNode(ancestor),ancestorRange.isPointInRange(range.endContainer,range.endOffset)&&isSplitPoint(range.endContainer,range.endOffset)&&(splitNodeAt(ancestor,range.endContainer,range.endOffset,this.container),range.setEndAfter(ancestor)),ancestorRange.isPointInRange(range.startContainer,range.startOffset)&&isSplitPoint(range.startContainer,range.startOffset)&&(ancestor=splitNodeAt(ancestor,range.startContainer,range.startOffset,this.container))}!styleMode&&this.similarClassRegExp&&removeClass(ancestor,this.similarClassRegExp),styleMode&&this.similarStyleRegExp&&(styleChanged="change"===removeOrChangeStyle(ancestor,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(ancestor)&&!styleChanged&&replaceWithOwnChildren(ancestor)},applyToRange:function(range){for(var textNodes,ri=range.length;ri--;){if(textNodes=range[ri].getNodes([wysihtml5.TEXT_NODE]),!textNodes.length)try{var node=this.createContainer(range[ri].endContainer.ownerDocument);return range[ri].surroundContents(node),void this.selectNode(range[ri],node)}catch(e){}if(range[ri].splitBoundaries(),textNodes=range[ri].getNodes([wysihtml5.TEXT_NODE]),textNodes.length){for(var textNode,i=0,len=textNodes.length;i<len;++i)textNode=textNodes[i],this.getMatchingAncestor(textNode).element||this.applyToTextNode(textNode);range[ri].setStart(textNodes[0],0),textNode=textNodes[textNodes.length-1],range[ri].setEnd(textNode,textNode.length),this.normalize&&this.postApply(textNodes,range[ri])}}},undoToRange:function(range){for(var textNodes,textNode,ancestor,ri=range.length;ri--;){if(textNodes=range[ri].getNodes([wysihtml5.TEXT_NODE]),textNodes.length)range[ri].splitBoundaries(),textNodes=range[ri].getNodes([wysihtml5.TEXT_NODE]);else{var doc=range[ri].endContainer.ownerDocument,node=doc.createTextNode(wysihtml5.INVISIBLE_SPACE);range[ri].insertNode(node),range[ri].selectNode(node),textNodes=[node]}for(var i=0,len=textNodes.length;i<len;++i)range[ri].isValid()&&(textNode=textNodes[i],ancestor=this.getMatchingAncestor(textNode),"style"===ancestor.type?this.undoToTextNode(textNode,range[ri],!1,ancestor.element):ancestor.element&&this.undoToTextNode(textNode,range[ri],ancestor.element));1==len?this.selectNode(range[ri],textNodes[0]):(range[ri].setStart(textNodes[0],0),textNode=textNodes[textNodes.length-1],range[ri].setEnd(textNode,textNode.length),this.normalize&&this.postApply(textNodes,range[ri]))}},selectNode:function(range,node){var isElement=node.nodeType===wysihtml5.ELEMENT_NODE,canHaveHTML=!("canHaveHTML"in node)||node.canHaveHTML,content=isElement?node.innerHTML:node.data,isEmpty=""===content||content===wysihtml5.INVISIBLE_SPACE;if(isEmpty&&isElement&&canHaveHTML)try{node.innerHTML=wysihtml5.INVISIBLE_SPACE}catch(e){}range.selectNodeContents(node),isEmpty&&isElement?range.collapse(!1):isEmpty&&(range.setStartAfter(node),range.setEndAfter(node))},getTextSelectedByRange:function(textNode,range){var textRange=range.cloneRange();textRange.selectNodeContents(textNode);var intersectionRange=textRange.intersection(range),text=intersectionRange?intersectionRange.toString():"";return textRange.detach(),text},isAppliedToRange:function(range){for(var ancestor,textNodes,ancestors=[],appliedType="full",ri=range.length;ri--;){if(textNodes=range[ri].getNodes([wysihtml5.TEXT_NODE]),!textNodes.length)return ancestor=this.getMatchingAncestor(range[ri].startContainer).element,!!ancestor&&{elements:[ancestor],coverage:appliedType};for(var selectedText,i=0,len=textNodes.length;i<len;++i)selectedText=this.getTextSelectedByRange(textNodes[i],range[ri]),ancestor=this.getMatchingAncestor(textNodes[i]).element,ancestor&&""!=selectedText?(ancestors.push(ancestor),1===wysihtml5.dom.getTextNodes(ancestor,!0).length?appliedType="full":"full"===appliedType&&(appliedType="inline")):ancestor||(appliedType="partial")}return!!ancestors.length&&{elements:ancestors,coverage:appliedType}},toggleRange:function(range){var parentsExactMatch,isApplied=this.isAppliedToRange(range);isApplied?"full"===isApplied.coverage?this.undoToRange(range):"inline"===isApplied.coverage?(parentsExactMatch=areMatchingAllready(isApplied.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(range),parentsExactMatch||this.applyToRange(range)):(areMatchingAllready(isApplied.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(range),this.applyToRange(range)):this.applyToRange(range)}},wysihtml5.selection.HTMLApplier=HTMLApplier}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(editor){this.editor=editor,this.composer=editor.composer,this.doc=this.composer.doc},support:function(command){return wysihtml5.browser.supportsCommand(this.doc,command)},exec:function(command,value){var obj=wysihtml5.commands[command],args=wysihtml5.lang.array(arguments).get(),method=obj&&obj.exec,result=null;if(this.editor.fire("beforecommand:composer"),method)args.unshift(this.composer),result=method.apply(obj,args);else try{result=this.doc.execCommand(command,!1,value)}catch(e){}return this.editor.fire("aftercommand:composer"),result},state:function(command,commandValue){var obj=wysihtml5.commands[command],args=wysihtml5.lang.array(arguments).get(),method=obj&&obj.state;if(method)return args.unshift(this.composer),method.apply(obj,args);try{return this.doc.queryCommandState(command)}catch(e){return!1}},stateValue:function(command){var obj=wysihtml5.commands[command],args=wysihtml5.lang.array(arguments).get(),method=obj&&obj.stateValue;return!!method&&(args.unshift(this.composer),method.apply(obj,args))}}),wysihtml5.commands.bold={exec:function(composer,command){wysihtml5.commands.formatInline.execWithToggle(composer,command,"b")},state:function(composer,command){return wysihtml5.commands.formatInline.state(composer,command,"b")}},function(wysihtml5){function _format(composer,attributes){var length,anchors,anchor,hasElementChild,isEmpty,elementToSetCaretAfter,textContent,whiteSpace,j,doc=composer.doc,tempClass="_wysihtml5-temp-"+ +new Date,tempClassRegExp=/non-matching-class/g,i=0;for(wysihtml5.commands.formatInline.exec(composer,undef,NODE_NAME,tempClass,tempClassRegExp,undef,undef,!0,!0),anchors=doc.querySelectorAll(NODE_NAME+"."+tempClass),length=anchors.length;i<length;i++){anchor=anchors[i],anchor.removeAttribute("class");for(j in attributes)"text"!==j&&anchor.setAttribute(j,attributes[j])}elementToSetCaretAfter=anchor,1===length&&(textContent=dom.getTextContent(anchor),hasElementChild=!!anchor.querySelector("*"),isEmpty=""===textContent||textContent===wysihtml5.INVISIBLE_SPACE,!hasElementChild&&isEmpty&&(dom.setTextContent(anchor,attributes.text||anchor.href),whiteSpace=doc.createTextNode(" "),composer.selection.setAfter(anchor),dom.insert(whiteSpace).after(anchor),elementToSetCaretAfter=whiteSpace)),composer.selection.setAfter(elementToSetCaretAfter)}function _changeLinks(composer,anchors,attributes){for(var oldAttrs,a=anchors.length;a--;){oldAttrs=anchors[a].attributes;for(var oa=oldAttrs.length;oa--;)anchors[a].removeAttribute(oldAttrs.item(oa).name);for(var j in attributes)attributes.hasOwnProperty(j)&&anchors[a].setAttribute(j,attributes[j])}}var undef,NODE_NAME="A",dom=wysihtml5.dom;wysihtml5.commands.createLink={exec:function(composer,command,value){var anchors=this.state(composer,command);anchors?composer.selection.executeAndRestore(function(){_changeLinks(composer,anchors,value)}):(value="object"==typeof value?value:{href:value},_format(composer,value))},state:function(composer,command){return wysihtml5.commands.formatInline.state(composer,command,"A")}}}(wysihtml5),function(wysihtml5){function _removeFormat(composer,anchors){for(var anchor,codeElement,textContent,length=anchors.length,i=0;i<length;i++)anchor=anchors[i],codeElement=dom.getParentElement(anchor,{nodeName:"code"}),textContent=dom.getTextContent(anchor),textContent.match(dom.autoLink.URL_REG_EXP)&&!codeElement?codeElement=dom.renameElement(anchor,"code"):dom.replaceWithChildNodes(anchor)}var dom=wysihtml5.dom;wysihtml5.commands.removeLink={exec:function(composer,command){var anchors=this.state(composer,command);anchors&&composer.selection.executeAndRestore(function(){
_removeFormat(composer,anchors)})},state:function(composer,command){return wysihtml5.commands.formatInline.state(composer,command,"A")}}}(wysihtml5),function(wysihtml5){var REG_EXP=/wysiwyg-font-size-[0-9a-z\-]+/g;wysihtml5.commands.fontSize={exec:function(composer,command,size){wysihtml5.commands.formatInline.execWithToggle(composer,command,"span","wysiwyg-font-size-"+size,REG_EXP)},state:function(composer,command,size){return wysihtml5.commands.formatInline.state(composer,command,"span","wysiwyg-font-size-"+size,REG_EXP)}}}(wysihtml5),function(wysihtml5){var REG_EXP=/(\s|^)font-size\s*:\s*[^;\s]+;?/gi;wysihtml5.commands.fontSizeStyle={exec:function(composer,command,size){size="object"==typeof size?size.size:size,/^\s*$/.test(size)||wysihtml5.commands.formatInline.execWithToggle(composer,command,"span",!1,!1,"font-size:"+size,REG_EXP)},state:function(composer,command,size){return wysihtml5.commands.formatInline.state(composer,command,"span",!1,!1,"font-size",REG_EXP)},stateValue:function(composer,command){var styleStr,st=this.state(composer,command);return st&&wysihtml5.lang.object(st).isArray()&&(st=st[0]),!(!st||!(styleStr=st.getAttribute("style")))&&wysihtml5.quirks.styleParser.parseFontSize(styleStr)}}}(wysihtml5),function(wysihtml5){var REG_EXP=/wysiwyg-color-[0-9a-z]+/g;wysihtml5.commands.foreColor={exec:function(composer,command,color){wysihtml5.commands.formatInline.execWithToggle(composer,command,"span","wysiwyg-color-"+color,REG_EXP)},state:function(composer,command,color){return wysihtml5.commands.formatInline.state(composer,command,"span","wysiwyg-color-"+color,REG_EXP)}}}(wysihtml5),function(wysihtml5){var REG_EXP=/(\s|^)color\s*:\s*[^;\s]+;?/gi;wysihtml5.commands.foreColorStyle={exec:function(composer,command,color){var colString,colorVals=wysihtml5.quirks.styleParser.parseColor("object"==typeof color?"color:"+color.color:"color:"+color,"color");colorVals&&(colString="color: rgb("+colorVals[0]+","+colorVals[1]+","+colorVals[2]+");",1!==colorVals[3]&&(colString+="color: rgba("+colorVals[0]+","+colorVals[1]+","+colorVals[2]+","+colorVals[3]+");"),wysihtml5.commands.formatInline.execWithToggle(composer,command,"span",!1,!1,colString,REG_EXP))},state:function(composer,command){return wysihtml5.commands.formatInline.state(composer,command,"span",!1,!1,"color",REG_EXP)},stateValue:function(composer,command,props){var colorStr,st=this.state(composer,command);return st&&wysihtml5.lang.object(st).isArray()&&(st=st[0]),!!(st&&(colorStr=st.getAttribute("style"),colorStr&&colorStr))&&(val=wysihtml5.quirks.styleParser.parseColor(colorStr,"color"),wysihtml5.quirks.styleParser.unparseColor(val,props))}}}(wysihtml5),function(wysihtml5){var REG_EXP=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi;wysihtml5.commands.bgColorStyle={exec:function(composer,command,color){var colString,colorVals=wysihtml5.quirks.styleParser.parseColor("object"==typeof color?"background-color:"+color.color:"background-color:"+color,"background-color");colorVals&&(colString="background-color: rgb("+colorVals[0]+","+colorVals[1]+","+colorVals[2]+");",1!==colorVals[3]&&(colString+="background-color: rgba("+colorVals[0]+","+colorVals[1]+","+colorVals[2]+","+colorVals[3]+");"),wysihtml5.commands.formatInline.execWithToggle(composer,command,"span",!1,!1,colString,REG_EXP))},state:function(composer,command){return wysihtml5.commands.formatInline.state(composer,command,"span",!1,!1,"background-color",REG_EXP)},stateValue:function(composer,command,props){var colorStr,st=this.state(composer,command),val=!1;return st&&wysihtml5.lang.object(st).isArray()&&(st=st[0]),!(!st||!(colorStr=st.getAttribute("style")))&&(val=wysihtml5.quirks.styleParser.parseColor(colorStr,"background-color"),wysihtml5.quirks.styleParser.unparseColor(val,props))}}}(wysihtml5),function(wysihtml5){function _addClass(element,className,classRegExp){element.className?(_removeClass(element,classRegExp),element.className=wysihtml5.lang.string(element.className+" "+className).trim()):element.className=className}function _addStyle(element,cssStyle,styleRegExp){_removeStyle(element,styleRegExp),element.getAttribute("style")?element.setAttribute("style",wysihtml5.lang.string(element.getAttribute("style")+" "+cssStyle).trim()):element.setAttribute("style",cssStyle)}function _removeClass(element,classRegExp){var ret=classRegExp.test(element.className);return element.className=element.className.replace(classRegExp,""),""==wysihtml5.lang.string(element.className).trim()&&element.removeAttribute("class"),ret}function _removeStyle(element,styleRegExp){var ret=styleRegExp.test(element.getAttribute("style"));return element.setAttribute("style",(element.getAttribute("style")||"").replace(styleRegExp,"")),""==wysihtml5.lang.string(element.getAttribute("style")||"").trim()&&element.removeAttribute("style"),ret}function _removeLastChildIfLineBreak(node){var lastChild=node.lastChild;lastChild&&_isLineBreak(lastChild)&&lastChild.parentNode.removeChild(lastChild)}function _isLineBreak(node){return"BR"===node.nodeName}function _selectionWrap(composer,options){composer.selection.isCollapsed()&&composer.selection.selectLine();for(var surroundedNodes=composer.selection.surround(options),i=0,imax=surroundedNodes.length;i<imax;i++)wysihtml5.dom.lineBreaks(surroundedNodes[i]).remove(),_removeLastChildIfLineBreak(surroundedNodes[i])}function _hasClasses(element){return!!wysihtml5.lang.string(element.className).trim()}function _hasStyles(element){return!!wysihtml5.lang.string(element.getAttribute("style")||"").trim()}var dom=wysihtml5.dom,BLOCK_ELEMENTS_GROUP=["H1","H2","H3","H4","H5","H6","P","PRE","DIV"];wysihtml5.commands.formatBlock={exec:function(composer,command,nodeName,className,classRegExp,cssStyle,styleRegExp){var selectedNodes,classRemoveAction,blockRenameFound,styleRemoveAction,blockElement,blockElements=(composer.doc,this.state(composer,command,nodeName,className,classRegExp,cssStyle,styleRegExp)),useLineBreaks=composer.config.useLineBreaks,defaultNodeName=useLineBreaks?"DIV":"P";return nodeName="string"==typeof nodeName?nodeName.toUpperCase():nodeName,blockElements.length?void composer.selection.executeAndRestoreRangy(function(){for(var b=blockElements.length;b--;){if(classRegExp&&(classRemoveAction=_removeClass(blockElements[b],classRegExp)),styleRegExp&&(styleRemoveAction=_removeStyle(blockElements[b],styleRegExp)),(styleRemoveAction||classRemoveAction)&&null===nodeName&&blockElements[b].nodeName!=defaultNodeName)return;var hasClasses=_hasClasses(blockElements[b]),hasStyles=_hasStyles(blockElements[b]);hasClasses||hasStyles||!useLineBreaks&&"P"!==nodeName?dom.renameElement(blockElements[b],"P"===nodeName?"DIV":defaultNodeName):(wysihtml5.dom.lineBreaks(blockElements[b]).add(),dom.replaceWithChildNodes(blockElements[b]))}}):void((null===nodeName||wysihtml5.lang.array(BLOCK_ELEMENTS_GROUP).contains(nodeName))&&(selectedNodes=composer.selection.findNodesInSelection(BLOCK_ELEMENTS_GROUP).concat(composer.selection.getSelectedOwnNodes()),composer.selection.executeAndRestoreRangy(function(){for(var n=selectedNodes.length;n--;)blockElement=dom.getParentElement(selectedNodes[n],{nodeName:BLOCK_ELEMENTS_GROUP}),blockElement==composer.element&&(blockElement=null),blockElement&&(nodeName&&(blockElement=dom.renameElement(blockElement,nodeName)),className&&_addClass(blockElement,className,classRegExp),cssStyle&&_addStyle(blockElement,cssStyle,styleRegExp),blockRenameFound=!0)}),blockRenameFound)||_selectionWrap(composer,{nodeName:nodeName||defaultNodeName,className:className||null,cssStyle:cssStyle||null}))},state:function(composer,command,nodeName,className,classRegExp,cssStyle,styleRegExp){var parent,nodes=composer.selection.getSelectedOwnNodes(),parents=[];nodeName="string"==typeof nodeName?nodeName.toUpperCase():nodeName;for(var i=0,maxi=nodes.length;i<maxi;i++)parent=dom.getParentElement(nodes[i],{nodeName:nodeName,className:className,classRegExp:classRegExp,cssStyle:cssStyle,styleRegExp:styleRegExp}),parent&&wysihtml5.lang.array(parents).indexOf(parent)==-1&&parents.push(parent);return 0!=parents.length&&parents}}}(wysihtml5),wysihtml5.commands.formatCode={exec:function(composer,command,classname){var code,range,selectedNodes,pre=this.state(composer);pre?composer.selection.executeAndRestore(function(){code=pre.querySelector("code"),wysihtml5.dom.replaceWithChildNodes(pre),code&&wysihtml5.dom.replaceWithChildNodes(code)}):(range=composer.selection.getRange(),selectedNodes=range.extractContents(),pre=composer.doc.createElement("pre"),code=composer.doc.createElement("code"),classname&&(code.className=classname),pre.appendChild(code),code.appendChild(selectedNodes),range.insertNode(pre),composer.selection.selectNode(pre))},state:function(composer){var selectedNode=composer.selection.getSelectedNode();return selectedNode&&selectedNode.nodeName&&"PRE"==selectedNode.nodeName&&selectedNode.firstChild&&selectedNode.firstChild.nodeName&&"CODE"==selectedNode.firstChild.nodeName?selectedNode:wysihtml5.dom.getParentElement(selectedNode,{nodeName:"CODE"})&&wysihtml5.dom.getParentElement(selectedNode,{nodeName:"PRE"})}},function(wysihtml5){function _getTagNames(tagName){var alias=ALIAS_MAPPING[tagName];return alias?[tagName.toLowerCase(),alias.toLowerCase()]:[tagName.toLowerCase()]}function _getApplier(tagName,className,classRegExp,cssStyle,styleRegExp,container){var identifier=tagName;return className&&(identifier+=":"+className),cssStyle&&(identifier+=":"+cssStyle),htmlApplier[identifier]||(htmlApplier[identifier]=new wysihtml5.selection.HTMLApplier(_getTagNames(tagName),className,classRegExp,(!0),cssStyle,styleRegExp,container)),htmlApplier[identifier]}var ALIAS_MAPPING={strong:"b",em:"i",b:"strong",i:"em"},htmlApplier={};wysihtml5.commands.formatInline={exec:function(composer,command,tagName,className,classRegExp,cssStyle,styleRegExp,dontRestoreSelect,noCleanup){var range=composer.selection.createRange(),ownRanges=composer.selection.getOwnRanges();return!(!ownRanges||0==ownRanges.length)&&(composer.selection.getSelection().removeAllRanges(),_getApplier(tagName,className,classRegExp,cssStyle,styleRegExp,composer.element).toggleRange(ownRanges),void(dontRestoreSelect?noCleanup||composer.cleanUp():(range.setStart(ownRanges[0].startContainer,ownRanges[0].startOffset),range.setEnd(ownRanges[ownRanges.length-1].endContainer,ownRanges[ownRanges.length-1].endOffset),composer.selection.setSelection(range),composer.selection.executeAndRestore(function(){noCleanup||composer.cleanUp()},!0,!0))))},execWithToggle:function(composer,command,tagName,className,classRegExp,cssStyle,styleRegExp){var that=this;if(this.state(composer,command,tagName,className,classRegExp,cssStyle,styleRegExp)&&composer.selection.isCollapsed()&&!composer.selection.caretIsLastInSelection()&&!composer.selection.caretIsFirstInSelection()){var state_element=that.state(composer,command,tagName,className,classRegExp)[0];composer.selection.executeAndRestoreRangy(function(){state_element.parentNode;composer.selection.selectNode(state_element,!0),wysihtml5.commands.formatInline.exec(composer,command,tagName,className,classRegExp,cssStyle,styleRegExp,!0,!0)})}else this.state(composer,command,tagName,className,classRegExp,cssStyle,styleRegExp)&&!composer.selection.isCollapsed()?composer.selection.executeAndRestoreRangy(function(){wysihtml5.commands.formatInline.exec(composer,command,tagName,className,classRegExp,cssStyle,styleRegExp,!0,!0)}):wysihtml5.commands.formatInline.exec(composer,command,tagName,className,classRegExp,cssStyle,styleRegExp)},state:function(composer,command,tagName,className,classRegExp,cssStyle,styleRegExp){var ownRanges,isApplied,doc=composer.doc,aliasTagName=ALIAS_MAPPING[tagName]||tagName;return!(!wysihtml5.dom.hasElementWithTagName(doc,tagName)&&!wysihtml5.dom.hasElementWithTagName(doc,aliasTagName))&&(!(className&&!wysihtml5.dom.hasElementWithClassName(doc,className))&&(ownRanges=composer.selection.getOwnRanges(),!(!ownRanges||0===ownRanges.length)&&(isApplied=_getApplier(tagName,className,classRegExp,cssStyle,styleRegExp,composer.element).isAppliedToRange(ownRanges),!(!isApplied||!isApplied.elements)&&isApplied.elements)))}}}(wysihtml5),function(wysihtml5){wysihtml5.commands.insertBlockQuote={exec:function(composer,command){var state=this.state(composer,command),endToEndParent=composer.selection.isEndToEndInNode(["H1","H2","H3","H4","H5","H6","P"]);composer.selection.executeAndRestore(function(){if(state)composer.config.useLineBreaks&&wysihtml5.dom.lineBreaks(state).add(),wysihtml5.dom.unwrap(state);else if(composer.selection.isCollapsed()&&composer.selection.selectLine(),endToEndParent){var qouteEl=endToEndParent.ownerDocument.createElement("blockquote");wysihtml5.dom.insert(qouteEl).after(endToEndParent),qouteEl.appendChild(endToEndParent)}else composer.selection.surround({nodeName:"blockquote"})})},state:function(composer,command){var selectedNode=composer.selection.getSelectedNode(),node=wysihtml5.dom.getParentElement(selectedNode,{nodeName:"BLOCKQUOTE"},!1,composer.element);return!!node&&node}}}(wysihtml5),wysihtml5.commands.insertHTML={exec:function(composer,command,html){composer.commands.support(command)?composer.doc.execCommand(command,!1,html):composer.selection.insertHTML(html)},state:function(){return!1}},function(wysihtml5){var NODE_NAME="IMG";wysihtml5.commands.insertImage={exec:function(composer,command,value){value="object"==typeof value?value:{src:value};var textNode,parent,doc=composer.doc,image=this.state(composer);if(image)return composer.selection.setBefore(image),parent=image.parentNode,parent.removeChild(image),wysihtml5.dom.removeEmptyTextNodes(parent),"A"!==parent.nodeName||parent.firstChild||(composer.selection.setAfter(parent),parent.parentNode.removeChild(parent)),void wysihtml5.quirks.redraw(composer.element);image=doc.createElement(NODE_NAME);for(var i in value)image.setAttribute("className"===i?"class":i,value[i]);composer.selection.insertNode(image),wysihtml5.browser.hasProblemsSettingCaretAfterImg()?(textNode=doc.createTextNode(wysihtml5.INVISIBLE_SPACE),composer.selection.insertNode(textNode),composer.selection.setAfter(textNode)):composer.selection.setAfter(image)},state:function(composer){var selectedNode,text,imagesInSelection,doc=composer.doc;return!!wysihtml5.dom.hasElementWithTagName(doc,NODE_NAME)&&(!!(selectedNode=composer.selection.getSelectedNode())&&(selectedNode.nodeName===NODE_NAME?selectedNode:selectedNode.nodeType===wysihtml5.ELEMENT_NODE&&(text=composer.selection.getText(),!(text=wysihtml5.lang.string(text).trim())&&(imagesInSelection=composer.selection.getNodes(wysihtml5.ELEMENT_NODE,function(node){return"IMG"===node.nodeName}),1===imagesInSelection.length&&imagesInSelection[0]))))}}}(wysihtml5),function(wysihtml5){var LINE_BREAK="<br>"+(wysihtml5.browser.needsSpaceAfterLineBreak()?" ":"");wysihtml5.commands.insertLineBreak={exec:function(composer,command){composer.commands.support(command)?(composer.doc.execCommand(command,!1,null),wysihtml5.browser.autoScrollsToCaret()||composer.selection.scrollIntoView()):composer.commands.exec("insertHTML",LINE_BREAK)},state:function(){return!1}}}(wysihtml5),wysihtml5.commands.insertOrderedList={exec:function(composer,command){wysihtml5.commands.insertList.exec(composer,command,"OL")},state:function(composer,command){return wysihtml5.commands.insertList.state(composer,command,"OL")}},wysihtml5.commands.insertUnorderedList={exec:function(composer,command){wysihtml5.commands.insertList.exec(composer,command,"UL")},state:function(composer,command){return wysihtml5.commands.insertList.state(composer,command,"UL")}},wysihtml5.commands.insertList=function(wysihtml5){var isNode=function(node,name){if(node&&node.nodeName){"string"==typeof name&&(name=[name]);for(var n=name.length;n--;)if(node.nodeName===name[n])return!0}return!1},findListEl=function(node,nodeName,composer){var ret={el:null,other:!1};if(node){var parentLi=wysihtml5.dom.getParentElement(node,{nodeName:"LI"}),otherNodeName="UL"===nodeName?"OL":"UL";isNode(node,nodeName)?ret.el=node:isNode(node,otherNodeName)?ret={el:node,other:!0}:parentLi&&(isNode(parentLi.parentNode,nodeName)?ret.el=parentLi.parentNode:isNode(parentLi.parentNode,otherNodeName)&&(ret={el:parentLi.parentNode,other:!0}))}return ret.el&&!composer.element.contains(ret.el)&&(ret.el=null),ret},handleSameTypeList=function(el,nodeName,composer){var innerLists,otherNodeName="UL"===nodeName?"OL":"UL";composer.selection.executeAndRestore(function(){var otherLists=getListsInSelection(otherNodeName,composer);if(otherLists.length)for(var l=otherLists.length;l--;)wysihtml5.dom.renameElement(otherLists[l],nodeName.toLowerCase());else{innerLists=getListsInSelection(["OL","UL"],composer);for(var i=innerLists.length;i--;)wysihtml5.dom.resolveList(innerLists[i],composer.config.useLineBreaks);wysihtml5.dom.resolveList(el,composer.config.useLineBreaks)}})},handleOtherTypeList=function(el,nodeName,composer){var otherNodeName="UL"===nodeName?"OL":"UL";composer.selection.executeAndRestore(function(){for(var renameLists=[el].concat(getListsInSelection(otherNodeName,composer)),l=renameLists.length;l--;)wysihtml5.dom.renameElement(renameLists[l],nodeName.toLowerCase())})},getListsInSelection=function(nodeName,composer){for(var ranges=composer.selection.getOwnRanges(),renameLists=[],r=ranges.length;r--;)renameLists=renameLists.concat(ranges[r].getNodes([1],function(node){return isNode(node,nodeName)}));return renameLists},createListFallback=function(nodeName,composer){composer.selection.executeAndRestoreRangy(function(){var isEmpty,list,tempClassName="_wysihtml5-temp-"+(new Date).getTime(),tempElement=composer.selection.deblockAndSurround({nodeName:"div",className:tempClassName}),INVISIBLE_SPACE_REG_EXP=/\uFEFF/g;tempElement.innerHTML=tempElement.innerHTML.replace(INVISIBLE_SPACE_REG_EXP,""),tempElement&&(isEmpty=wysihtml5.lang.array(["","<br>",wysihtml5.INVISIBLE_SPACE]).contains(tempElement.innerHTML),list=wysihtml5.dom.convertToList(tempElement,nodeName.toLowerCase(),composer.parent.config.uneditableContainerClassname),isEmpty&&composer.selection.selectNode(list.querySelector("li"),!0))})};return{exec:function(composer,command,nodeName){var doc=composer.doc,cmd="OL"===nodeName?"insertOrderedList":"insertUnorderedList",selectedNode=composer.selection.getSelectedNode(),list=findListEl(selectedNode,nodeName,composer);list.el?list.other?handleOtherTypeList(list.el,nodeName,composer):handleSameTypeList(list.el,nodeName,composer):composer.commands.support(cmd)?doc.execCommand(cmd,!1,null):createListFallback(nodeName,composer)},state:function(composer,command,nodeName){var selectedNode=composer.selection.getSelectedNode(),list=findListEl(selectedNode,nodeName,composer);return!(!list.el||list.other)&&list.el}}}(wysihtml5),wysihtml5.commands.italic={exec:function(composer,command){wysihtml5.commands.formatInline.execWithToggle(composer,command,"i")},state:function(composer,command){return wysihtml5.commands.formatInline.state(composer,command,"i")}},function(wysihtml5){var CLASS_NAME="wysiwyg-text-align-center",REG_EXP=/wysiwyg-text-align-[0-9a-z]+/g;wysihtml5.commands.justifyCenter={exec:function(composer,command){return wysihtml5.commands.formatBlock.exec(composer,"formatBlock",null,CLASS_NAME,REG_EXP)},state:function(composer,command){return wysihtml5.commands.formatBlock.state(composer,"formatBlock",null,CLASS_NAME,REG_EXP)}}}(wysihtml5),function(wysihtml5){var CLASS_NAME="wysiwyg-text-align-left",REG_EXP=/wysiwyg-text-align-[0-9a-z]+/g;wysihtml5.commands.justifyLeft={exec:function(composer,command){return wysihtml5.commands.formatBlock.exec(composer,"formatBlock",null,CLASS_NAME,REG_EXP)},state:function(composer,command){return wysihtml5.commands.formatBlock.state(composer,"formatBlock",null,CLASS_NAME,REG_EXP)}}}(wysihtml5),function(wysihtml5){var CLASS_NAME="wysiwyg-text-align-right",REG_EXP=/wysiwyg-text-align-[0-9a-z]+/g;wysihtml5.commands.justifyRight={exec:function(composer,command){return wysihtml5.commands.formatBlock.exec(composer,"formatBlock",null,CLASS_NAME,REG_EXP)},state:function(composer,command){return wysihtml5.commands.formatBlock.state(composer,"formatBlock",null,CLASS_NAME,REG_EXP)}}}(wysihtml5),function(wysihtml5){var CLASS_NAME="wysiwyg-text-align-justify",REG_EXP=/wysiwyg-text-align-[0-9a-z]+/g;wysihtml5.commands.justifyFull={exec:function(composer,command){return wysihtml5.commands.formatBlock.exec(composer,"formatBlock",null,CLASS_NAME,REG_EXP)},state:function(composer,command){return wysihtml5.commands.formatBlock.state(composer,"formatBlock",null,CLASS_NAME,REG_EXP)}}}(wysihtml5),function(wysihtml5){var STYLE_STR="text-align: right;",REG_EXP=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;wysihtml5.commands.alignRightStyle={exec:function(composer,command){return wysihtml5.commands.formatBlock.exec(composer,"formatBlock",null,null,null,STYLE_STR,REG_EXP)},state:function(composer,command){return wysihtml5.commands.formatBlock.state(composer,"formatBlock",null,null,null,STYLE_STR,REG_EXP)}}}(wysihtml5),function(wysihtml5){var STYLE_STR="text-align: left;",REG_EXP=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;wysihtml5.commands.alignLeftStyle={exec:function(composer,command){return wysihtml5.commands.formatBlock.exec(composer,"formatBlock",null,null,null,STYLE_STR,REG_EXP)},state:function(composer,command){return wysihtml5.commands.formatBlock.state(composer,"formatBlock",null,null,null,STYLE_STR,REG_EXP)}}}(wysihtml5),function(wysihtml5){var STYLE_STR="text-align: center;",REG_EXP=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;wysihtml5.commands.alignCenterStyle={exec:function(composer,command){return wysihtml5.commands.formatBlock.exec(composer,"formatBlock",null,null,null,STYLE_STR,REG_EXP)},state:function(composer,command){return wysihtml5.commands.formatBlock.state(composer,"formatBlock",null,null,null,STYLE_STR,REG_EXP)}}}(wysihtml5),wysihtml5.commands.redo={exec:function(composer){return composer.undoManager.redo()},state:function(composer){return!1}},wysihtml5.commands.underline={exec:function(composer,command){wysihtml5.commands.formatInline.execWithToggle(composer,command,"u")},state:function(composer,command){return wysihtml5.commands.formatInline.state(composer,command,"u")}},wysihtml5.commands.undo={exec:function(composer){return composer.undoManager.undo()},state:function(composer){return!1}},wysihtml5.commands.createTable={exec:function(composer,command,value){var col,row,html;if(value&&value.cols&&value.rows&&parseInt(value.cols,10)>0&&parseInt(value.rows,10)>0){for(html=value.tableStyle?'<table style="'+value.tableStyle+'">':"<table>",html+="<tbody>",row=0;row<value.rows;row++){for(html+="<tr>",col=0;col<value.cols;col++)html+="<td>&nbsp;</td>";html+="</tr>"}html+="</tbody></table>",composer.commands.exec("insertHTML",html)}},state:function(composer,command){return!1}},wysihtml5.commands.mergeTableCells={exec:function(composer,command){composer.tableSelection&&composer.tableSelection.start&&composer.tableSelection.end&&(this.state(composer,command)?wysihtml5.dom.table.unmergeCell(composer.tableSelection.start):wysihtml5.dom.table.mergeCellsBetween(composer.tableSelection.start,composer.tableSelection.end))},state:function(composer,command){if(composer.tableSelection){var start=composer.tableSelection.start,end=composer.tableSelection.end;if(start&&end&&start==end&&(wysihtml5.dom.getAttribute(start,"colspan")&&parseInt(wysihtml5.dom.getAttribute(start,"colspan"),10)>1||wysihtml5.dom.getAttribute(start,"rowspan")&&parseInt(wysihtml5.dom.getAttribute(start,"rowspan"),10)>1))return[start]}return!1}},wysihtml5.commands.addTableCells={exec:function(composer,command,value){if(composer.tableSelection&&composer.tableSelection.start&&composer.tableSelection.end){var tableSelect=wysihtml5.dom.table.orderSelectionEnds(composer.tableSelection.start,composer.tableSelection.end);"before"==value||"above"==value?wysihtml5.dom.table.addCells(tableSelect.start,value):"after"!=value&&"below"!=value||wysihtml5.dom.table.addCells(tableSelect.end,value),setTimeout(function(){composer.tableSelection.select(tableSelect.start,tableSelect.end)},0)}},state:function(composer,command){return!1}},wysihtml5.commands.deleteTableCells={exec:function(composer,command,value){if(composer.tableSelection&&composer.tableSelection.start&&composer.tableSelection.end){var selCell,tableSelect=wysihtml5.dom.table.orderSelectionEnds(composer.tableSelection.start,composer.tableSelection.end),idx=wysihtml5.dom.table.indexOf(tableSelect.start),table=composer.tableSelection.table;wysihtml5.dom.table.removeCells(tableSelect.start,value),setTimeout(function(){selCell=wysihtml5.dom.table.findCell(table,idx),selCell||("row"==value&&(selCell=wysihtml5.dom.table.findCell(table,{row:idx.row-1,col:idx.col})),"column"==value&&(selCell=wysihtml5.dom.table.findCell(table,{row:idx.row,col:idx.col-1}))),selCell&&composer.tableSelection.select(selCell,selCell)},0)}},state:function(composer,command){return!1}},wysihtml5.commands.indentList={exec:function(composer,command,value){var listEls=composer.selection.getSelectionParentsByTag("LI");return!!listEls&&this.tryToPushLiLevel(listEls,composer.selection)},state:function(composer,command){return!1},tryToPushLiLevel:function(liNodes,selection){var listTag,list,prevLi,liNode,prevLiList,found=!1;return selection.executeAndRestoreRangy(function(){for(var i=liNodes.length;i--;)liNode=liNodes[i],listTag="OL"===liNode.parentNode.nodeName?"OL":"UL",list=liNode.ownerDocument.createElement(listTag),prevLi=wysihtml5.dom.domNode(liNode).prev({nodeTypes:[wysihtml5.ELEMENT_NODE]}),prevLiList=prevLi?prevLi.querySelector("ul, ol"):null,prevLi&&(prevLiList?prevLiList.appendChild(liNode):(list.appendChild(liNode),prevLi.appendChild(list)),found=!0)}),found}},wysihtml5.commands.outdentList={exec:function(composer,command,value){var listEls=composer.selection.getSelectionParentsByTag("LI");return!!listEls&&this.tryToPullLiLevel(listEls,composer)},state:function(composer,command){return!1},tryToPullLiLevel:function(liNodes,composer){var listNode,outerListNode,outerLiNode,liNode,afterList,found=!1,that=this;return composer.selection.executeAndRestoreRangy(function(){for(var i=liNodes.length;i--;)if(liNode=liNodes[i],liNode.parentNode&&(listNode=liNode.parentNode,"OL"===listNode.tagName||"UL"===listNode.tagName)){if(found=!0,outerListNode=wysihtml5.dom.getParentElement(listNode.parentNode,{nodeName:["OL","UL"]},!1,composer.element),outerLiNode=wysihtml5.dom.getParentElement(listNode.parentNode,{nodeName:["LI"]},!1,composer.element),outerListNode&&outerLiNode)liNode.nextSibling&&(afterList=that.getAfterList(listNode,liNode),liNode.appendChild(afterList)),outerListNode.insertBefore(liNode,outerLiNode.nextSibling);else{liNode.nextSibling&&(afterList=that.getAfterList(listNode,liNode),liNode.appendChild(afterList));for(var j=liNode.childNodes.length;j--;)listNode.parentNode.insertBefore(liNode.childNodes[j],listNode.nextSibling);listNode.parentNode.insertBefore(document.createElement("br"),listNode.nextSibling),liNode.parentNode.removeChild(liNode)}0===listNode.childNodes.length&&listNode.parentNode.removeChild(listNode)}}),found},getAfterList:function(listNode,liNode){for(var nodeName=listNode.nodeName,newList=document.createElement(nodeName);liNode.nextSibling;)newList.appendChild(liNode.nextSibling);return newList}},function(wysihtml5){var Z_KEY=90,Y_KEY=89,BACKSPACE_KEY=8,DELETE_KEY=46,MAX_HISTORY_ENTRIES=25,DATA_ATTR_NODE="data-wysihtml5-selection-node",DATA_ATTR_OFFSET="data-wysihtml5-selection-offset",dom=('<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+wysihtml5.INVISIBLE_SPACE+"</span>",'<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+wysihtml5.INVISIBLE_SPACE+"</span>",wysihtml5.dom);wysihtml5.UndoManager=wysihtml5.lang.Dispatcher.extend({constructor:function(editor){this.editor=editor,this.composer=editor.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var lastKey,that=this;this.composer.sandbox.getDocument();dom.observe(this.element,"keydown",function(event){if(!event.altKey&&(event.ctrlKey||event.metaKey)){var keyCode=event.keyCode,isUndo=keyCode===Z_KEY&&!event.shiftKey,isRedo=keyCode===Z_KEY&&event.shiftKey||keyCode===Y_KEY;isUndo?(that.undo(),event.preventDefault()):isRedo&&(that.redo(),event.preventDefault())}}),dom.observe(this.element,"keydown",function(event){var keyCode=event.keyCode;keyCode!==lastKey&&(lastKey=keyCode,keyCode!==BACKSPACE_KEY&&keyCode!==DELETE_KEY||that.transact())}),this.editor.on("newword:composer",function(){that.transact()}).on("beforecommand:composer",function(){that.transact()})},transact:function(){var range,node,offset,element,position,previousHtml=this.historyStr[this.position-1],currentHtml=this.composer.getValue(!1,!1),composerIsVisible=this.element.offsetWidth>0&&this.element.offsetHeight>0;if(currentHtml!==previousHtml){var length=this.historyStr.length=this.historyDom.length=this.position;length>MAX_HISTORY_ENTRIES&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,composerIsVisible&&(range=this.composer.selection.getRange(),node=range&&range.startContainer?range.startContainer:this.element,offset=range&&range.startOffset?range.startOffset:0,node.nodeType===wysihtml5.ELEMENT_NODE?element=node:(element=node.parentNode,position=this.getChildNodeIndex(element,node)),element.setAttribute(DATA_ATTR_OFFSET,offset),"undefined"!=typeof position&&element.setAttribute(DATA_ATTR_NODE,position));var clone=this.element.cloneNode(!!currentHtml);this.historyDom.push(clone),this.historyStr.push(currentHtml),element&&(element.removeAttribute(DATA_ATTR_OFFSET),element.removeAttribute(DATA_ATTR_NODE))}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(historyEntry){this.element.innerHTML="";for(var i=0,childNodes=historyEntry.childNodes,length=historyEntry.childNodes.length;i<length;i++)this.element.appendChild(childNodes[i].cloneNode(!0));var offset,node,position;historyEntry.hasAttribute(DATA_ATTR_OFFSET)?(offset=historyEntry.getAttribute(DATA_ATTR_OFFSET),position=historyEntry.getAttribute(DATA_ATTR_NODE),node=this.element):(node=this.element.querySelector("["+DATA_ATTR_OFFSET+"]")||this.element,offset=node.getAttribute(DATA_ATTR_OFFSET),position=node.getAttribute(DATA_ATTR_NODE),node.removeAttribute(DATA_ATTR_OFFSET),node.removeAttribute(DATA_ATTR_NODE)),null!==position&&(node=this.getChildNodeByIndex(node,+position)),this.composer.selection.set(node,offset)},getChildNodeIndex:function(parent,child){for(var i=0,childNodes=parent.childNodes,length=childNodes.length;i<length;i++)if(childNodes[i]===child)return i},getChildNodeByIndex:function(parent,index){return parent.childNodes[index]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(parent,textareaElement,config){this.parent=parent,this.element=textareaElement,this.config=config,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var that=this;this.parent.on("beforeload",function(){that.parent.on("change_view",function(view){view===that.name?(that.parent.currentView=that,that.show(),setTimeout(function(){that.focus()},0)):that.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(wysihtml5){var dom=wysihtml5.dom,browser=wysihtml5.browser;wysihtml5.views.Composer=wysihtml5.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(parent,editableElement,config){
this.base(parent,editableElement,config),this.config.noTextarea?this.editableArea=editableElement:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=browser.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(parse,clearInternals){var value=this.isEmpty()?"":wysihtml5.quirks.getCorrectInnerHTML(this.element);return parse!==!1&&(value=this.parent.parse(value,clearInternals!==!1)),value},setValue:function(html,parse){parse&&(html=this.parent.parse(html));try{this.element.innerHTML=html}catch(e){this.element.innerText=html}},cleanUp:function(){this.parent.parse(this.element)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=dom.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(setToEnd){wysihtml5.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var lastChild=this.element.lastChild;setToEnd&&lastChild&&this.selection&&("BR"===lastChild.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return dom.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var innerHTML=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(innerHTML)||""===innerHTML||"<br>"===innerHTML||"<p></p>"===innerHTML||"<p><br></p>"===innerHTML||this.hasPlaceholderSet()},_initContentEditableArea:function(){var that=this;this.config.noTextarea?this.sandbox=new dom.ContentEditableArea(function(){that._create()},{},this.editableArea):(this.sandbox=new dom.ContentEditableArea(function(){that._create()}),this.editableArea=this.sandbox.getContentEditable(),dom.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var that=this;this.sandbox=new dom.Sandbox(function(){that._create()},{stylesheets:this.config.stylesheets}),this.editableArea=this.sandbox.getIframe();var textareaElement=this.textarea.element;dom.insert(this.editableArea).after(textareaElement),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var hiddenField=document.createElement("input");hiddenField.type="hidden",hiddenField.name="_wysihtml5_mode",hiddenField.value=1,dom.insert(hiddenField).after(this.textarea.element)}},_create:function(){var that=this;this.doc=this.sandbox.getDocument(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new wysihtml5.Selection(this.parent,this.element,this.config.uneditableContainerClassname),this.commands=new wysihtml5.Commands(this.parent),this.config.noTextarea||dom.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),dom.addClass(this.element,this.config.composerClassName),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var name=this.config.name;name&&(dom.addClass(this.element,name),this.config.contentEditableMode||dom.addClass(this.editableArea,name)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var placeholderText="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");placeholderText&&dom.simulatePlaceholder(this.parent,this,placeholderText),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||browser.isIos()||setTimeout(function(){that.focus(!0)},100),browser.clearsContentEditableCorrectly()||wysihtml5.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var that=this,supportsDisablingOfAutoLinking=browser.canDisableAutoLinking(),supportsAutoLinking=browser.doesAutoLinkingInContentEditable();if(supportsDisablingOfAutoLinking&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!supportsAutoLinking||supportsAutoLinking&&supportsDisablingOfAutoLinking)&&(this.parent.on("newword:composer",function(){dom.getTextContent(that.element).match(dom.autoLink.URL_REG_EXP)&&that.selection.executeAndRestore(function(startContainer,endContainer){for(var uneditables=that.element.querySelectorAll("."+that.config.uneditableContainerClassname),isInUneditable=!1,i=uneditables.length;i--;)wysihtml5.dom.contains(uneditables[i],endContainer)&&(isInUneditable=!0);isInUneditable||dom.autoLink(endContainer.parentNode,[that.config.uneditableContainerClassname])})}),dom.observe(this.element,"blur",function(){dom.autoLink(that.element,[that.config.uneditableContainerClassname])}));var links=this.sandbox.getDocument().getElementsByTagName("a"),urlRegExp=dom.autoLink.URL_REG_EXP,getTextContent=function(element){var textContent=wysihtml5.lang.string(dom.getTextContent(element)).trim();return"www."===textContent.substr(0,4)&&(textContent="http://"+textContent),textContent};dom.observe(this.element,"keydown",function(event){if(links.length){var textContent,selectedNode=that.selection.getSelectedNode(event.target.ownerDocument),link=dom.getParentElement(selectedNode,{nodeName:"A"},4);link&&(textContent=getTextContent(link),setTimeout(function(){var newTextContent=getTextContent(link);newTextContent!==textContent&&newTextContent.match(urlRegExp)&&link.setAttribute("href",newTextContent)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),browser.supportsEvent("resizeend")){var properties=["width","height"],propertiesLength=properties.length,element=this.element;dom.observe(element,"resizeend",function(event){var property,target=event.target||event.srcElement,style=target.style,i=0;if("IMG"===target.nodeName){for(;i<propertiesLength;i++)property=properties[i],style[property]&&(target.setAttribute(property,parseInt(style[property],10)),style[property]="");wysihtml5.quirks.redraw(element)}})}},_initUndoManager:function(){this.undoManager=new wysihtml5.UndoManager(this.parent)},_initLineBreaking:function(){function adjust(selectedNode){var parentElement=dom.getParentElement(selectedNode,{nodeName:["P","DIV"]},2);parentElement&&dom.contains(that.element,parentElement)&&that.selection.executeAndRestore(function(){that.config.useLineBreaks?dom.replaceWithChildNodes(parentElement):"P"!==parentElement.nodeName&&dom.renameElement(parentElement,"p")})}var that=this,USE_NATIVE_LINE_BREAK_INSIDE_TAGS=["LI","P","H1","H2","H3","H4","H5","H6"],LIST_TAGS=["UL","OL","MENU"];this.config.useLineBreaks||dom.observe(this.element,["focus","keydown"],function(){if(that.isEmpty()){var paragraph=that.doc.createElement("P");that.element.innerHTML="",that.element.appendChild(paragraph),browser.displaysCaretInEmptyContentEditableCorrectly()?that.selection.selectNode(paragraph,!0):(paragraph.innerHTML="<br>",that.selection.setBefore(paragraph.firstChild))}}),dom.observe(this.element,"keydown",function(event){var keyCode=event.keyCode;if(!event.shiftKey&&(keyCode===wysihtml5.ENTER_KEY||keyCode===wysihtml5.BACKSPACE_KEY)){var blockElement=dom.getParentElement(that.selection.getSelectedNode(),{nodeName:USE_NATIVE_LINE_BREAK_INSIDE_TAGS},4);return blockElement?void setTimeout(function(){var list,selectedNode=that.selection.getSelectedNode();if("LI"===blockElement.nodeName){if(!selectedNode)return;list=dom.getParentElement(selectedNode,{nodeName:LIST_TAGS},2),list||adjust(selectedNode)}keyCode===wysihtml5.ENTER_KEY&&blockElement.nodeName.match(/^H[1-6]$/)&&adjust(selectedNode)},0):void(that.config.useLineBreaks&&keyCode===wysihtml5.ENTER_KEY&&!wysihtml5.browser.insertsLineBreaksOnReturn()&&(event.preventDefault(),that.commands.exec("insertLineBreak")))}})}})}(wysihtml5),function(wysihtml5){var dom=wysihtml5.dom,doc=document,win=window,HOST_TEMPLATE=doc.createElement("div"),TEXT_FORMATTING=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],BOX_FORMATTING=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],ADDITIONAL_CSS_RULES=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",wysihtml5.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],focusWithoutScrolling=function(element){if(element.setActive)try{element.setActive()}catch(e){}else{var elementStyle=element.style,originalScrollTop=doc.documentElement.scrollTop||doc.body.scrollTop,originalScrollLeft=doc.documentElement.scrollLeft||doc.body.scrollLeft,originalStyles={position:elementStyle.position,top:elementStyle.top,left:elementStyle.left,WebkitUserSelect:elementStyle.WebkitUserSelect};dom.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(element),element.focus(),dom.setStyles(originalStyles).on(element),win.scrollTo&&win.scrollTo(originalScrollLeft,originalScrollTop)}};wysihtml5.views.Composer.prototype.style=function(){var displayValueForCopying,that=this,originalActiveElement=doc.querySelector(":focus"),textareaElement=this.textarea.element,hasPlaceholder=textareaElement.hasAttribute("placeholder"),originalPlaceholder=hasPlaceholder&&textareaElement.getAttribute("placeholder"),originalDisplayValue=textareaElement.style.display,originalDisabled=textareaElement.disabled;this.focusStylesHost=HOST_TEMPLATE.cloneNode(!1),this.blurStylesHost=HOST_TEMPLATE.cloneNode(!1),this.disabledStylesHost=HOST_TEMPLATE.cloneNode(!1),hasPlaceholder&&textareaElement.removeAttribute("placeholder"),textareaElement===originalActiveElement&&textareaElement.blur(),textareaElement.disabled=!1,textareaElement.style.display=displayValueForCopying="none",(textareaElement.getAttribute("rows")&&"auto"===dom.getStyle("height").from(textareaElement)||textareaElement.getAttribute("cols")&&"auto"===dom.getStyle("width").from(textareaElement))&&(textareaElement.style.display=displayValueForCopying=originalDisplayValue),dom.copyStyles(BOX_FORMATTING).from(textareaElement).to(this.editableArea).andTo(this.blurStylesHost),dom.copyStyles(TEXT_FORMATTING).from(textareaElement).to(this.element).andTo(this.blurStylesHost),dom.insertCSS(ADDITIONAL_CSS_RULES).into(this.element.ownerDocument),textareaElement.disabled=!0,dom.copyStyles(BOX_FORMATTING).from(textareaElement).to(this.disabledStylesHost),dom.copyStyles(TEXT_FORMATTING).from(textareaElement).to(this.disabledStylesHost),textareaElement.disabled=originalDisabled,textareaElement.style.display=originalDisplayValue,focusWithoutScrolling(textareaElement),textareaElement.style.display=displayValueForCopying,dom.copyStyles(BOX_FORMATTING).from(textareaElement).to(this.focusStylesHost),dom.copyStyles(TEXT_FORMATTING).from(textareaElement).to(this.focusStylesHost),textareaElement.style.display=originalDisplayValue,dom.copyStyles(["display"]).from(textareaElement).to(this.editableArea);var boxFormattingStyles=wysihtml5.lang.array(BOX_FORMATTING).without(["display"]);return originalActiveElement?originalActiveElement.focus():textareaElement.blur(),hasPlaceholder&&textareaElement.setAttribute("placeholder",originalPlaceholder),this.parent.on("focus:composer",function(){dom.copyStyles(boxFormattingStyles).from(that.focusStylesHost).to(that.editableArea),dom.copyStyles(TEXT_FORMATTING).from(that.focusStylesHost).to(that.element)}),this.parent.on("blur:composer",function(){dom.copyStyles(boxFormattingStyles).from(that.blurStylesHost).to(that.editableArea),dom.copyStyles(TEXT_FORMATTING).from(that.blurStylesHost).to(that.element)}),this.parent.observe("disable:composer",function(){dom.copyStyles(boxFormattingStyles).from(that.disabledStylesHost).to(that.editableArea),dom.copyStyles(TEXT_FORMATTING).from(that.disabledStylesHost).to(that.element)}),this.parent.observe("enable:composer",function(){dom.copyStyles(boxFormattingStyles).from(that.blurStylesHost).to(that.editableArea),dom.copyStyles(TEXT_FORMATTING).from(that.blurStylesHost).to(that.element)}),this}}(wysihtml5),function(wysihtml5){var dom=wysihtml5.dom,browser=wysihtml5.browser,shortcuts={66:"bold",73:"italic",85:"underline"},deleteAroundEditable=function(selection,uneditable,element){var prevNode=selection.getPreviousNode(uneditable,!0),curNode=selection.getSelectedNode();if(1!==curNode.nodeType&&curNode.parentNode!==element&&(curNode=curNode.parentNode),prevNode)if(1==curNode.nodeType){var first=curNode.firstChild;if(1==prevNode.nodeType)for(;curNode.firstChild;)prevNode.appendChild(curNode.firstChild);else for(;curNode.firstChild;)uneditable.parentNode.insertBefore(curNode.firstChild,uneditable);curNode.parentNode&&curNode.parentNode.removeChild(curNode),selection.setBefore(first)}else 1==prevNode.nodeType?prevNode.appendChild(curNode):uneditable.parentNode.insertBefore(curNode,uneditable),selection.setBefore(curNode)},handleDeleteKeyPress=function(event,selection,element,composer){if(selection.isCollapsed())if(selection.caretIsInTheBeginnig("LI"))event.preventDefault(),composer.commands.exec("outdentList");else if(selection.caretIsInTheBeginnig())event.preventDefault();else{if(selection.caretIsFirstInSelection()&&selection.getPreviousNode()&&selection.getPreviousNode().nodeName&&/^H\d$/gi.test(selection.getPreviousNode().nodeName)){var prevNode=selection.getPreviousNode();if(event.preventDefault(),/^\s*$/.test(prevNode.textContent||prevNode.innerText))prevNode.parentNode.removeChild(prevNode);else{var range=prevNode.ownerDocument.createRange();range.selectNodeContents(prevNode),range.collapse(!1),selection.setSelection(range)}}var beforeUneditable=selection.caretIsBeforeUneditable();beforeUneditable&&(event.preventDefault(),deleteAroundEditable(selection,beforeUneditable,element))}else selection.containsUneditable()&&(event.preventDefault(),selection.deleteContents())},handleTabKeyDown=function(composer,element){if(composer.selection.isCollapsed()){if(composer.selection.caretIsInTheBeginnig("LI")&&composer.commands.exec("indentList"))return}else composer.selection.deleteContents();composer.commands.exec("insertHTML","&emsp;")};wysihtml5.views.Composer.prototype.observe=function(){var that=this,state=this.getValue(!1,!1),container=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),element=this.element,focusBlurElement=browser.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?element:this.sandbox.getWindow(),pasteEvents=["drop","paste","beforepaste"],interactionEvents=["drop","paste","mouseup","focus","keyup"];if(dom.observe(container,"DOMNodeRemoved",function(){clearInterval(domNodeRemovedInterval),that.parent.fire("destroy:composer")}),!browser.supportsMutationEvents())var domNodeRemovedInterval=setInterval(function(){dom.contains(document.documentElement,container)||(clearInterval(domNodeRemovedInterval),that.parent.fire("destroy:composer"))},250);dom.observe(focusBlurElement,interactionEvents,function(){setTimeout(function(){that.parent.fire("interaction").fire("interaction:composer")},0)}),this.config.handleTables&&(!this.tableClickHandle&&this.doc.execCommand&&wysihtml5.browser.supportsCommand(this.doc,"enableObjectResizing")&&wysihtml5.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.tableClickHandle=dom.observe(container,["focus","mouseup","mouseover"],function(){that.doc.execCommand("enableObjectResizing",!1,"false"),that.doc.execCommand("enableInlineTableEditing",!1,"false"),that.tableClickHandle.stop()}):setTimeout(function(){that.doc.execCommand("enableObjectResizing",!1,"false"),that.doc.execCommand("enableInlineTableEditing",!1,"false")},0)),this.tableSelection=wysihtml5.quirks.tableCellsSelection(element,that.parent)),dom.observe(focusBlurElement,"focus",function(event){that.parent.fire("focus",event).fire("focus:composer",event),setTimeout(function(){state=that.getValue(!1,!1)},0)}),dom.observe(focusBlurElement,"blur",function(event){if(state!==that.getValue(!1,!1)){var changeevent=event;"function"==typeof Object.create&&(changeevent=Object.create(event,{type:{value:"change"}})),that.parent.fire("change",changeevent).fire("change:composer",changeevent)}that.parent.fire("blur",event).fire("blur:composer",event)}),dom.observe(element,"dragenter",function(){that.parent.fire("unset_placeholder")}),dom.observe(element,pasteEvents,function(event){that.parent.fire(event.type,event).fire(event.type+":composer",event)}),this.config.copyedFromMarking&&dom.observe(element,"copy",function(event){event.clipboardData&&(event.clipboardData.setData("text/html",that.config.copyedFromMarking+that.selection.getHtml()),event.preventDefault()),that.parent.fire(event.type,event).fire(event.type+":composer",event)}),dom.observe(element,"keyup",function(event){var keyCode=event.keyCode;keyCode!==wysihtml5.SPACE_KEY&&keyCode!==wysihtml5.ENTER_KEY||that.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){that.parent.fire("newword:composer")},0)}),browser.canSelectImagesInContentEditable()||dom.observe(element,"mousedown",function(event){var target=event.target,allImages=element.querySelectorAll("img"),notMyImages=element.querySelectorAll("."+that.config.uneditableContainerClassname+" img"),myImages=wysihtml5.lang.array(allImages).without(notMyImages);"IMG"===target.nodeName&&wysihtml5.lang.array(myImages).contains(target)&&that.selection.selectNode(target)}),browser.canSelectImagesInContentEditable()||dom.observe(element,"drop",function(event){setTimeout(function(){that.selection.getSelection().removeAllRanges()},0)}),browser.hasHistoryIssue()&&browser.supportsSelectionModify()&&dom.observe(element,"keydown",function(event){if(event.metaKey||event.ctrlKey){var keyCode=event.keyCode,win=element.ownerDocument.defaultView,selection=win.getSelection();37!==keyCode&&39!==keyCode||(37===keyCode&&(selection.modify("extend","left","lineboundary"),event.shiftKey||selection.collapseToStart()),39===keyCode&&(selection.modify("extend","right","lineboundary"),event.shiftKey||selection.collapseToEnd()),event.preventDefault())}}),dom.observe(element,"keydown",function(event){var keyCode=event.keyCode,command=shortcuts[keyCode];(event.ctrlKey||event.metaKey)&&!event.altKey&&command&&(that.commands.exec(command),event.preventDefault()),8===keyCode?handleDeleteKeyPress(event,that.selection,element,that):that.config.handleTabKey&&9===keyCode&&(event.preventDefault(),handleTabKeyDown(that,element))}),dom.observe(element,"keydown",function(event){var parent,target=that.selection.getSelectedNode(!0),keyCode=event.keyCode;!target||"IMG"!==target.nodeName||keyCode!==wysihtml5.BACKSPACE_KEY&&keyCode!==wysihtml5.DELETE_KEY||(parent=target.parentNode,parent.removeChild(target),"A"!==parent.nodeName||parent.firstChild||parent.parentNode.removeChild(parent),setTimeout(function(){wysihtml5.quirks.redraw(element)},0),event.preventDefault())}),!this.config.contentEditableMode&&browser.hasIframeFocusIssue()&&(dom.observe(container,"focus",function(){setTimeout(function(){that.doc.querySelector(":focus")!==that.element&&that.focus()},0)}),dom.observe(this.element,"blur",function(){setTimeout(function(){that.selection.getSelection().removeAllRanges()},0)}));var titlePrefixes={IMG:"Image: ",A:"Link: "};dom.observe(element,"mouseover",function(event){var title,target=event.target,nodeName=target.nodeName;if("A"===nodeName||"IMG"===nodeName){var hasTitle=target.hasAttribute("title");hasTitle||(title=titlePrefixes[nodeName]+(target.getAttribute("href")||target.getAttribute("src")),target.setAttribute("title",title))}})}}(wysihtml5),function(wysihtml5){var INTERVAL=400;wysihtml5.views.Synchronizer=Base.extend({constructor:function(editor,textarea,composer){this.editor=editor,this.textarea=textarea,this.composer=composer,this._observe()},fromComposerToTextarea:function(shouldParseHtml){this.textarea.setValue(wysihtml5.lang.string(this.composer.getValue(!1,!1)).trim(),shouldParseHtml)},fromTextareaToComposer:function(shouldParseHtml){var textareaValue=this.textarea.getValue(!1,!1);textareaValue?this.composer.setValue(textareaValue,shouldParseHtml):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(shouldParseHtml){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(shouldParseHtml):this.fromComposerToTextarea(shouldParseHtml)},_observe:function(){var interval,that=this,form=this.textarea.element.form,startInterval=function(){interval=setInterval(function(){that.fromComposerToTextarea()},INTERVAL)},stopInterval=function(){clearInterval(interval),interval=null};startInterval(),form&&(wysihtml5.dom.observe(form,"submit",function(){that.sync(!0)}),wysihtml5.dom.observe(form,"reset",function(){setTimeout(function(){that.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(view){"composer"!==view||interval?"textarea"===view&&(that.fromComposerToTextarea(!0),stopInterval()):(that.fromTextareaToComposer(!0),startInterval())}),this.editor.on("destroy:composer",stopInterval)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(parent,textareaElement,config){this.base(parent,textareaElement,config),this._observe()},clear:function(){this.element.value=""},getValue:function(parse){var value=this.isEmpty()?"":this.element.value;return parse!==!1&&(value=this.parent.parse(value)),value},setValue:function(html,parse){parse&&(html=this.parent.parse(html)),this.element.value=html},cleanUp:function(){var html=this.parent.parse(this.element.value);this.element.value=html},hasPlaceholderSet:function(){var supportsPlaceholder=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),placeholderText=this.element.getAttribute("placeholder")||null,value=this.element.value,isEmpty=!value;return supportsPlaceholder&&isEmpty||value===placeholderText},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var element=this.element,parent=this.parent,eventMapping={focusin:"focus",focusout:"blur"},events=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];parent.on("beforeload",function(){wysihtml5.dom.observe(element,events,function(event){var eventName=eventMapping[event.type]||event.type;parent.fire(eventName).fire(eventName+":textarea")}),wysihtml5.dom.observe(element,["paste","drop"],function(){setTimeout(function(){parent.fire("paste").fire("paste:textarea")},0)})})}}),function(wysihtml5){var undef,defaultConfig={name:undef,style:!0,toolbar:undef,showToolbarAfterInit:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},pasteParserRulesets:null,parser:wysihtml5.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:undef,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,uneditableContainerClassname:"wysihtml5-uneditable-container",copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};wysihtml5.Editor=wysihtml5.lang.Dispatcher.extend({constructor:function(editableElement,config){if(this.editableElement="string"==typeof editableElement?document.getElementById(editableElement):editableElement,this.config=wysihtml5.lang.object({}).merge(defaultConfig).merge(config).get(),this._isCompatible=wysihtml5.browser.supported(),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new wysihtml5.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&wysihtml5.browser.isTouchDevice()){var that=this;return void setTimeout(function(){that.fire("beforeload").fire("load")},0)}wysihtml5.dom.addClass(document.body,this.config.bodyClassName),this.composer=new wysihtml5.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea||(this.synchronizer=new wysihtml5.views.Synchronizer(this,this.textarea,this.composer)),this.config.toolbar&&(this.toolbar=new wysihtml5.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(parse,clearInternals){return this.currentView.getValue(parse,clearInternals)},setValue:function(html,parse){return this.fire("unset_placeholder"),html?(this.currentView.setValue(html,parse),this):this.clear()},cleanUp:function(){this.currentView.cleanUp()},focus:function(setToEnd){return this.currentView.focus(setToEnd),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(htmlOrElement,clearInternals){var parseContext=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,returnValue=this.config.parser(htmlOrElement,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:parseContext,uneditableClass:this.config.uneditableContainerClassname,clearInternals:clearInternals});return"object"==typeof htmlOrElement&&wysihtml5.quirks.redraw(htmlOrElement),returnValue},_initParser:function(){var oldHtml,that=this;wysihtml5.browser.supportsModenPaste()?this.on("paste:composer",function(event){event.preventDefault(),oldHtml=wysihtml5.dom.getPastedHtml(event),oldHtml&&that._cleanAndPaste(oldHtml)}):this.on("beforepaste:composer",function(event){event.preventDefault(),wysihtml5.dom.getPastedHtmlWithDiv(that.composer,function(pastedHTML){pastedHTML&&that._cleanAndPaste(pastedHTML)})})},_cleanAndPaste:function(oldHtml){var cleanHtml=wysihtml5.quirks.cleanPastedHTML(oldHtml,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.uneditableContainerClassname});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(cleanHtml)}})}(wysihtml5),function(wysihtml5){var dom=wysihtml5.dom,CLASS_NAME_OPENED="wysihtml5-command-dialog-opened",SELECTOR_FORM_ELEMENTS="input, select, textarea",SELECTOR_FIELDS="[data-wysihtml5-dialog-field]",ATTRIBUTE_FIELDS="data-wysihtml5-dialog-field";wysihtml5.toolbar.Dialog=wysihtml5.lang.Dispatcher.extend({constructor:function(link,container){this.link=link,this.container=container},_observe:function(){if(!this._observed){var that=this,callbackWrapper=function(event){var attributes=that._serialize();attributes==that.elementToChange?that.fire("edit",attributes):that.fire("save",attributes),that.hide(),event.preventDefault(),event.stopPropagation()};dom.observe(that.link,"click",function(){dom.hasClass(that.link,CLASS_NAME_OPENED)&&setTimeout(function(){that.hide()},0)}),dom.observe(this.container,"keydown",function(event){var keyCode=event.keyCode;keyCode===wysihtml5.ENTER_KEY&&callbackWrapper(event),keyCode===wysihtml5.ESCAPE_KEY&&(that.fire("cancel"),that.hide())}),dom.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",callbackWrapper),dom.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(event){that.fire("cancel"),that.hide(),event.preventDefault(),event.stopPropagation()});for(var formElements=this.container.querySelectorAll(SELECTOR_FORM_ELEMENTS),i=0,length=formElements.length,_clearInterval=function(){clearInterval(that.interval)};i<length;i++)dom.observe(formElements[i],"change",_clearInterval);this._observed=!0}},_serialize:function(){for(var data=this.elementToChange||{},fields=this.container.querySelectorAll(SELECTOR_FIELDS),length=fields.length,i=0;i<length;i++)data[fields[i].getAttribute(ATTRIBUTE_FIELDS)]=fields[i].value;return data},_interpolate:function(avoidHiddenFields){for(var field,fieldName,newValue,focusedElement=document.querySelector(":focus"),fields=this.container.querySelectorAll(SELECTOR_FIELDS),length=fields.length,i=0;i<length;i++)field=fields[i],field!==focusedElement&&(avoidHiddenFields&&"hidden"===field.type||(fieldName=field.getAttribute(ATTRIBUTE_FIELDS),newValue=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(fieldName)||"":field.defaultValue,field.value=newValue))},show:function(elementToChange){if(!dom.hasClass(this.link,CLASS_NAME_OPENED)){var that=this,firstField=this.container.querySelector(SELECTOR_FORM_ELEMENTS);if(this.elementToChange=elementToChange,this._observe(),this._interpolate(),elementToChange&&(this.interval=setInterval(function(){that._interpolate(!0)},500)),dom.addClass(this.link,CLASS_NAME_OPENED),this.container.style.display="",this.fire("show"),firstField&&!elementToChange)try{firstField.focus()}catch(e){}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,dom.removeClass(this.link,CLASS_NAME_OPENED),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(wysihtml5){var dom=wysihtml5.dom,linkStyles={position:"relative"},wrapperStyles={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},inputStyles={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},inputAttributes={"x-webkit-speech":"",speech:""};wysihtml5.toolbar.Speech=function(parent,link){
var input=document.createElement("input");if(!wysihtml5.browser.supportsSpeechApiOn(input))return void(link.style.display="none");var lang=parent.editor.textarea.element.getAttribute("lang");lang&&(inputAttributes.lang=lang);var wrapper=document.createElement("div");wysihtml5.lang.object(wrapperStyles).merge({width:link.offsetWidth+"px",height:link.offsetHeight+"px"}),dom.insert(input).into(wrapper),dom.insert(wrapper).into(link),dom.setStyles(inputStyles).on(input),dom.setAttributes(inputAttributes).on(input),dom.setStyles(wrapperStyles).on(wrapper),dom.setStyles(linkStyles).on(link);var eventName="onwebkitspeechchange"in input?"webkitspeechchange":"speechchange";dom.observe(input,eventName,function(){parent.execCommand("insertText",input.value),input.value=""}),dom.observe(input,"click",function(event){dom.hasClass(link,"wysihtml5-command-disabled")&&event.preventDefault(),event.stopPropagation()})}}(wysihtml5),function(wysihtml5){var CLASS_NAME_COMMAND_DISABLED="wysihtml5-command-disabled",CLASS_NAME_COMMANDS_DISABLED="wysihtml5-commands-disabled",CLASS_NAME_COMMAND_ACTIVE="wysihtml5-command-active",CLASS_NAME_ACTION_ACTIVE="wysihtml5-action-active",dom=wysihtml5.dom;wysihtml5.toolbar.Toolbar=Base.extend({constructor:function(editor,container,showOnInit){this.editor=editor,this.container="string"==typeof container?document.getElementById(container):container,this.composer=editor.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),showOnInit&&this.show(),null!=editor.config.classNameCommandDisabled&&(CLASS_NAME_COMMAND_DISABLED=editor.config.classNameCommandDisabled),null!=editor.config.classNameCommandsDisabled&&(CLASS_NAME_COMMANDS_DISABLED=editor.config.classNameCommandsDisabled),null!=editor.config.classNameCommandActive&&(CLASS_NAME_COMMAND_ACTIVE=editor.config.classNameCommandActive),null!=editor.config.classNameActionActive&&(CLASS_NAME_ACTION_ACTIVE=editor.config.classNameActionActive);for(var speechInputLinks=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),length=speechInputLinks.length,i=0;i<length;i++)new wysihtml5.toolbar.Speech(this,speechInputLinks[i])},_getLinks:function(type){for(var link,group,name,value,dialog,links=this[type+"Links"]=wysihtml5.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+type+"]")).get(),length=links.length,i=0,mapping=this[type+"Mapping"]={};i<length;i++)link=links[i],name=link.getAttribute("data-wysihtml5-"+type),value=link.getAttribute("data-wysihtml5-"+type+"-value"),group=this.container.querySelector("[data-wysihtml5-"+type+"-group='"+name+"']"),dialog=this._getDialog(link,name),mapping[name+":"+value]={link:link,group:group,name:name,value:value,dialog:dialog,state:!1}},_getDialog:function(link,command){var dialog,caretBookmark,that=this,dialogElement=this.container.querySelector("[data-wysihtml5-dialog='"+command+"']");return dialogElement&&(dialog=wysihtml5.toolbar["Dialog_"+command]?new wysihtml5.toolbar["Dialog_"+command](link,dialogElement):new wysihtml5.toolbar.Dialog(link,dialogElement),dialog.on("show",function(){caretBookmark=that.composer.selection.getBookmark(),that.editor.fire("show:dialog",{command:command,dialogContainer:dialogElement,commandLink:link})}),dialog.on("save",function(attributes){caretBookmark&&that.composer.selection.setBookmark(caretBookmark),that._execCommand(command,attributes),that.editor.fire("save:dialog",{command:command,dialogContainer:dialogElement,commandLink:link})}),dialog.on("cancel",function(){that.editor.focus(!1),that.editor.fire("cancel:dialog",{command:command,dialogContainer:dialogElement,commandLink:link})})),dialog},execCommand:function(command,commandValue){if(!this.commandsDisabled){var commandObj=this.commandMapping[command+":"+commandValue];commandObj&&commandObj.dialog&&!commandObj.state?commandObj.dialog.show():this._execCommand(command,commandValue)}},_execCommand:function(command,commandValue){this.editor.focus(!1),this.composer.commands.exec(command,commandValue),this._updateLinkStates()},execAction:function(action){var editor=this.editor;"change_view"===action&&editor.textarea&&(editor.currentView===editor.textarea?editor.fire("change_view","composer"):editor.fire("change_view","textarea")),"showSource"==action&&editor.fire("showSource")},_observe:function(){for(var that=this,editor=this.editor,container=this.container,links=this.commandLinks.concat(this.actionLinks),length=links.length,i=0;i<length;i++)"A"===links[i].nodeName?dom.setAttributes({href:"javascript:;",unselectable:"on"}).on(links[i]):dom.setAttributes({unselectable:"on"}).on(links[i]);dom.delegate(container,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(event){event.preventDefault()}),dom.delegate(container,"[data-wysihtml5-command]","click",function(event){var link=this,command=link.getAttribute("data-wysihtml5-command"),commandValue=link.getAttribute("data-wysihtml5-command-value");that.execCommand(command,commandValue),event.preventDefault()}),dom.delegate(container,"[data-wysihtml5-action]","click",function(event){var action=this.getAttribute("data-wysihtml5-action");that.execAction(action),event.preventDefault()}),editor.on("interaction:composer",function(){that._updateLinkStates()}),editor.on("focus:composer",function(){that.bookmark=null}),this.editor.config.handleTables&&(editor.on("tableselect:composer",function(){that.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""}),editor.on("tableunselect:composer",function(){that.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})),editor.on("change_view",function(currentView){editor.textarea&&setTimeout(function(){that.commandsDisabled="composer"!==currentView,that._updateLinkStates(),that.commandsDisabled?dom.addClass(container,CLASS_NAME_COMMANDS_DISABLED):dom.removeClass(container,CLASS_NAME_COMMANDS_DISABLED)},0)})},_updateLinkStates:function(){var i,state,action,command,commandMapping=this.commandMapping,actionMapping=this.actionMapping;for(i in commandMapping)command=commandMapping[i],this.commandsDisabled?(state=!1,dom.removeClass(command.link,CLASS_NAME_COMMAND_ACTIVE),command.group&&dom.removeClass(command.group,CLASS_NAME_COMMAND_ACTIVE),command.dialog&&command.dialog.hide()):(state=this.composer.commands.state(command.name,command.value),dom.removeClass(command.link,CLASS_NAME_COMMAND_DISABLED),command.group&&dom.removeClass(command.group,CLASS_NAME_COMMAND_DISABLED)),command.state!==state&&(command.state=state,state?(dom.addClass(command.link,CLASS_NAME_COMMAND_ACTIVE),command.group&&dom.addClass(command.group,CLASS_NAME_COMMAND_ACTIVE),command.dialog&&("object"==typeof state||wysihtml5.lang.object(state).isArray()?(!command.dialog.multiselect&&wysihtml5.lang.object(state).isArray()&&(state=1!==state.length||state[0],command.state=state),command.dialog.show(state)):command.dialog.hide())):(dom.removeClass(command.link,CLASS_NAME_COMMAND_ACTIVE),command.group&&dom.removeClass(command.group,CLASS_NAME_COMMAND_ACTIVE),command.dialog&&command.dialog.hide()));for(i in actionMapping)action=actionMapping[i],"change_view"===action.name&&(action.state=this.editor.currentView===this.editor.textarea,action.state?dom.addClass(action.link,CLASS_NAME_ACTION_ACTIVE):dom.removeClass(action.link,CLASS_NAME_ACTION_ACTIVE))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(wysihtml5){wysihtml5.toolbar.Dialog_createTable=wysihtml5.toolbar.Dialog.extend({show:function(elementToChange){this.base(elementToChange)}})}(wysihtml5),function(wysihtml5){var SELECTOR_FIELDS=(wysihtml5.dom,"[data-wysihtml5-dialog-field]"),ATTRIBUTE_FIELDS="data-wysihtml5-dialog-field";wysihtml5.toolbar.Dialog_foreColorStyle=wysihtml5.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var data={},fields=this.container.querySelectorAll(SELECTOR_FIELDS),length=fields.length,i=0;i<length;i++)data[fields[i].getAttribute(ATTRIBUTE_FIELDS)]=fields[i].value;return data},_interpolate:function(avoidHiddenFields){for(var field,focusedElement=document.querySelector(":focus"),fields=this.container.querySelectorAll(SELECTOR_FIELDS),length=fields.length,i=0,firstElement=this.elementToChange?wysihtml5.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,colorStr=firstElement?firstElement.getAttribute("style"):null,color=colorStr?wysihtml5.quirks.styleParser.parseColor(colorStr,"color"):null;i<length;i++)field=fields[i],field!==focusedElement&&(avoidHiddenFields&&"hidden"===field.type||"color"===field.getAttribute(ATTRIBUTE_FIELDS)&&(color?color[3]&&1!=color[3]?field.value="rgba("+color[0]+","+color[1]+","+color[2]+","+color[3]+");":field.value="rgb("+color[0]+","+color[1]+","+color[2]+");":field.value="rgb(0,0,0);"))}})}(wysihtml5),function(wysihtml5){wysihtml5.dom;wysihtml5.toolbar.Dialog_fontSizeStyle=wysihtml5.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(avoidHiddenFields){var focusedElement=document.querySelector(":focus"),field=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),firstElement=this.elementToChange?wysihtml5.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,styleStr=firstElement?firstElement.getAttribute("style"):null,size=styleStr?wysihtml5.quirks.styleParser.parseFontSize(styleStr):null;field&&field!==focusedElement&&size&&!/^\s*$/.test(size)&&(field.value=size)}})}(wysihtml5);var Handlebars=function(){var a=function(){"use strict";function a(a){this.string=a}var b;return a.prototype.toString=function(){return""+this.string},b=a}(),b=function(a){"use strict";function b(a){return h[a]||"&amp;"}function c(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])}function d(a){return a instanceof g?a.toString():a||0===a?(a=""+a,j.test(a)?a.replace(i,b):a):""}function e(a){return!a&&0!==a||!(!m(a)||0!==a.length)}var f={},g=a,h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,j=/[&<>"'`]/;f.extend=c;var k=Object.prototype.toString;f.toString=k;var l=function(a){return"function"==typeof a};l(/x/)&&(l=function(a){return"function"==typeof a&&"[object Function]"===k.call(a)});var l;f.isFunction=l;var m=Array.isArray||function(a){return!(!a||"object"!=typeof a)&&"[object Array]"===k.call(a)};return f.isArray=m,f.escapeExpression=d,f.isEmpty=e,f}(a),c=function(){"use strict";function a(a,b){var d;b&&b.firstLine&&(d=b.firstLine,a+=" - "+d+":"+b.firstColumn);for(var e=Error.prototype.constructor.call(this,a),f=0;f<c.length;f++)this[c[f]]=e[c[f]];d&&(this.lineNumber=d,this.column=b.firstColumn)}var b,c=["description","fileName","lineNumber","message","name","number","stack"];return a.prototype=new Error,b=a}(),d=function(a,b){"use strict";function c(a,b){this.helpers=a||{},this.partials=b||{},d(this)}function d(a){a.registerHelper("helperMissing",function(a){if(2!==arguments.length)throw new h("Missing helper: '"+a+"'")}),a.registerHelper("blockHelperMissing",function(b,c){var d=c.inverse||function(){},e=c.fn;return m(b)&&(b=b.call(this)),b===!0?e(this):b===!1||null==b?d(this):l(b)?b.length>0?a.helpers.each(b,c):d(this):e(b)}),a.registerHelper("each",function(a,b){var c,d=b.fn,e=b.inverse,f=0,g="";if(m(a)&&(a=a.call(this)),b.data&&(c=q(b.data)),a&&"object"==typeof a)if(l(a))for(var h=a.length;h>f;f++)c&&(c.index=f,c.first=0===f,c.last=f===a.length-1),g+=d(a[f],{data:c});else for(var i in a)a.hasOwnProperty(i)&&(c&&(c.key=i,c.index=f,c.first=0===f),g+=d(a[i],{data:c}),f++);return 0===f&&(g=e(this)),g}),a.registerHelper("if",function(a,b){return m(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||g.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})}),a.registerHelper("with",function(a,b){return m(a)&&(a=a.call(this)),g.isEmpty(a)?void 0:b.fn(a)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)})}function e(a,b){p.log(a,b)}var f={},g=a,h=b,i="1.3.0";f.VERSION=i;var j=4;f.COMPILER_REVISION=j;var k={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};f.REVISION_CHANGES=k;var l=g.isArray,m=g.isFunction,n=g.toString,o="[object Object]";f.HandlebarsEnvironment=c,c.prototype={constructor:c,logger:p,log:e,registerHelper:function(a,b,c){if(n.call(a)===o){if(c||b)throw new h("Arg not supported with multiple helpers");g.extend(this.helpers,a)}else c&&(b.not=c),this.helpers[a]=b},registerPartial:function(a,b){n.call(a)===o?g.extend(this.partials,a):this.partials[a]=b}};var p={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(a,b){if(p.level<=a){var c=p.methodMap[a];"undefined"!=typeof console&&console[c]&&void 0}}};f.logger=p,f.log=e;var q=function(a){var b={};return g.extend(b,a),b};return f.createFrame=q,f}(b,c),e=function(a,b,c){"use strict";function d(a){var b=a&&a[0]||1,c=m;if(b!==c){if(c>b){var d=n[c],e=n[b];throw new l("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new l("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function e(a,b){if(!b)throw new l("No environment passed to template");var c=function(a,c,d,e,f,g){var h=b.VM.invokePartial.apply(this,arguments);if(null!=h)return h;if(b.compile){var i={helpers:e,partials:f,data:g};return f[c]=b.compile(a,{data:void 0!==g},b),f[c](d,i)}throw new l("The partial "+c+" could not be compiled when running in runtime-only mode")},d={escapeExpression:k.escapeExpression,invokePartial:c,programs:[],program:function(a,b,c){var d=this.programs[a];return c?d=g(a,b,c):d||(d=this.programs[a]=g(a,b)),d},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c={},k.extend(c,b),k.extend(c,a)),c},programWithDepth:b.VM.programWithDepth,noop:b.VM.noop,compilerInfo:null};return function(c,e){e=e||{};var f,g,h=e.partial?e:b;e.partial||(f=e.helpers,g=e.partials);var i=a.call(d,h,c,f,g,e.data);return e.partial||b.VM.checkRevision(d.compilerInfo),i}}function f(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){return e=e||{},b.apply(this,[a,e.data||c].concat(d))};return e.program=a,e.depth=d.length,e}function g(a,b,c){var d=function(a,d){return d=d||{},b(a,d.data||c)};return d.program=a,d.depth=0,d}function h(a,b,c,d,e,f){var g={partial:!0,helpers:d,partials:e,data:f};if(void 0===a)throw new l("The partial "+b+" could not be found");return a instanceof Function?a(c,g):void 0}function i(){return""}var j={},k=a,l=b,m=c.COMPILER_REVISION,n=c.REVISION_CHANGES;return j.checkRevision=d,j.template=e,j.programWithDepth=f,j.program=g,j.invokePartial=h,j.noop=i,j}(b,c,d),f=function(a,b,c,d,e){"use strict";var f,g=a,h=b,i=c,j=d,k=e,l=function(){var a=new g.HandlebarsEnvironment;return j.extend(a,g),a.SafeString=h,a.Exception=i,a.Utils=j,a.VM=k,a.template=function(b){return k.template(b,a)},a},m=l();return m.create=l,f=m}(d,a,c,b,e);return f}();this.wysihtml5=this.wysihtml5||{},this.wysihtml5.tpl=this.wysihtml5.tpl||{},this.wysihtml5.tpl.blockquote=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+="btn-"+escapeExpression((stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,stack1=null==stack1||stack1===!1?stack1:stack1.size,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program3(depth0,data){return' \n      <span class="fa fa-quote-left"></span>\n    '}function program5(depth0,data){return'\n      <span class="glyphicon glyphicon-quote"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li>\n  <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="blockquote" data-wysihtml5-display-format-name="false" tabindex="-1">\n    ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.fa),{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.color=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+="btn-"+escapeExpression((stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,stack1=null==stack1||stack1===!1?stack1:stack1.size,typeof stack1===functionType?stack1.apply(depth0):stack1))}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-toggle="dropdown" tabindex="-1">\n    <span class="current-color">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.black,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="black"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="black">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.black,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="silver"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="silver">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.silver,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="gray"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="gray">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.gray,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="maroon"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="maroon">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.maroon,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="red"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.red,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="purple"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.purple,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="green"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.green,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="olive"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.olive,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="navy"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="navy">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.navy,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="blue"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.blue,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="orange"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="orange">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.colours,stack1=null==stack1||stack1===!1?stack1:stack1.orange,typeof stack1===functionType?stack1.apply(depth0):stack1))+"</a></li>\n  </ul>\n</li>\n"}),this.wysihtml5.tpl.emphasis=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+="btn-"+escapeExpression((stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,stack1=null==stack1||stack1===!1?stack1:stack1.size,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program3(depth0,data){var stack1,buffer="";return buffer+='\n    <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-command="small" title="CTRL+S" tabindex="-1">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.emphasis,stack1=null==stack1||stack1===!1?stack1:stack1.small,typeof stack1===functionType?stack1.apply(depth0):stack1))+"</a>\n    "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li>\n  <div class="btn-group">\n    <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-command="bold" title="CTRL+B" tabindex="-1">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.emphasis,stack1=null==stack1||stack1===!1?stack1:stack1.bold,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a>\n    <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-command="italic" title="CTRL+I" tabindex="-1">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.emphasis,stack1=null==stack1||stack1===!1?stack1:stack1.italic,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a>\n    <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-command="underline" title="CTRL+U" tabindex="-1">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.emphasis,stack1=null==stack1||stack1===!1?stack1:stack1.underline,typeof stack1===functionType?stack1.apply(depth0):stack1))+"</a>\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,stack1=null==stack1||stack1===!1?stack1:stack1.emphasis,null==stack1||stack1===!1?stack1:stack1.small),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n  </div>\n</li>\n"}),this.wysihtml5.tpl["font-styles"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+="btn-"+escapeExpression((stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,stack1=null==stack1||stack1===!1?stack1:stack1.size,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program3(depth0,data){return'\n      <span class="fa fa-font"></span>\n    '}function program5(depth0,data){return'\n      <span class="glyphicon glyphicon-font"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-toggle="dropdown">\n    ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.fa),{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <span class="current-font">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.font_styles,stack1=null==stack1||stack1===!1?stack1:stack1.normal,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" tabindex="-1">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.font_styles,stack1=null==stack1||stack1===!1?stack1:stack1.normal,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" tabindex="-1">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.font_styles,stack1=null==stack1||stack1===!1?stack1:stack1.h1,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" tabindex="-1">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.font_styles,stack1=null==stack1||stack1===!1?stack1:stack1.h2,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" tabindex="-1">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.font_styles,stack1=null==stack1||stack1===!1?stack1:stack1.h3,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h4" tabindex="-1">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.font_styles,stack1=null==stack1||stack1===!1?stack1:stack1.h4,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h5" tabindex="-1">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.font_styles,stack1=null==stack1||stack1===!1?stack1:stack1.h5,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h6" tabindex="-1">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.font_styles,stack1=null==stack1||stack1===!1?stack1:stack1.h6,typeof stack1===functionType?stack1.apply(depth0):stack1))+"</a></li>\n  </ul>\n</li>\n"}),this.wysihtml5.tpl.html=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+="btn-"+escapeExpression((stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,stack1=null==stack1||stack1===!1?stack1:stack1.size,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program3(depth0,data){return'\n        <span class="fa fa-pencil"></span>\n      '}function program5(depth0,data){return'\n        <span class="glyphicon glyphicon-pencil"></span>\n      '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li>\n  <div class="btn-group">\n    <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-action="change_view" title="'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.html,stack1=null==stack1||stack1===!1?stack1:stack1.edit,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" tabindex="-1">\n      ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,
null==stack1||stack1===!1?stack1:stack1.fa),{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </a>\n  </div>\n</li>\n"}),this.wysihtml5.tpl.image=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return"modal-sm"}function program3(depth0,data){var stack1,buffer="";return buffer+="btn-"+escapeExpression((stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,stack1=null==stack1||stack1===!1?stack1:stack1.size,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){return'\n      <span class="fa fa-file-image-o"></span>\n    '}function program7(depth0,data){return'\n      <span class="glyphicon glyphicon-picture"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li>\n  <div class="bootstrap-wysihtml5-insert-image-modal modal fade" data-wysihtml5-dialog="insertImage">\n    <div class="modal-dialog ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.smallmodals),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.image,stack1=null==stack1||stack1===!1?stack1:stack1.insert,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-image-url form-control" data-wysihtml5-dialog-field="src">\n          </div> \n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.image,stack1=null==stack1||stack1===!1?stack1:stack1.cancel,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a>\n          <a class="btn btn-primary" data-dismiss="modal"  data-wysihtml5-dialog-action="save" href="#">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.image,stack1=null==stack1||stack1===!1?stack1:stack1.insert,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-command="insertImage" title="'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.image,stack1=null==stack1||stack1===!1?stack1:stack1.insert,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" tabindex="-1">\n    ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.fa),{hash:{},inverse:self.program(7,program7,data),fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.link=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return"modal-sm"}function program3(depth0,data){var stack1,buffer="";return buffer+="btn-"+escapeExpression((stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,stack1=null==stack1||stack1===!1?stack1:stack1.size,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){return'\n      <span class="fa fa-share-square-o"></span>\n    '}function program7(depth0,data){return'\n      <span class="glyphicon glyphicon-share"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li>\n  <div class="bootstrap-wysihtml5-insert-link-modal modal fade" data-wysihtml5-dialog="createLink">\n    <div class="modal-dialog ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.smallmodals),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.link,stack1=null==stack1||stack1===!1?stack1:stack1.insert,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-link-url form-control" data-wysihtml5-dialog-field="href">\n          </div> \n          <div class="checkbox">\n            <label> \n              <input type="checkbox" class="bootstrap-wysihtml5-insert-link-target" checked>'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.link,stack1=null==stack1||stack1===!1?stack1:stack1.target,typeof stack1===functionType?stack1.apply(depth0):stack1))+'\n            </label>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.link,stack1=null==stack1||stack1===!1?stack1:stack1.cancel,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a>\n          <a href="#" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save">'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.link,stack1=null==stack1||stack1===!1?stack1:stack1.insert,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-command="createLink" title="'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.link,stack1=null==stack1||stack1===!1?stack1:stack1.insert,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" tabindex="-1">\n    ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.fa),{hash:{},inverse:self.program(7,program7,data),fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.lists=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+="btn-"+escapeExpression((stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,stack1=null==stack1||stack1===!1?stack1:stack1.size,typeof stack1===functionType?stack1.apply(depth0):stack1))}function program3(depth0,data){return'\n      <span class="fa fa-list-ul"></span>\n    '}function program5(depth0,data){return'\n      <span class="glyphicon glyphicon-list"></span>\n    '}function program7(depth0,data){return'\n      <span class="fa fa-list-ol"></span>\n    '}function program9(depth0,data){return'\n      <span class="glyphicon glyphicon-th-list"></span>\n    '}function program11(depth0,data){return'\n      <span class="fa fa-outdent"></span>\n    '}function program13(depth0,data){return'\n      <span class="glyphicon glyphicon-indent-right"></span>\n    '}function program15(depth0,data){return'\n      <span class="fa fa-indent"></span>\n    '}function program17(depth0,data){return'\n      <span class="glyphicon glyphicon-indent-left"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li>\n  <div class="btn-group">\n    <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-command="insertUnorderedList" title="'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.lists,stack1=null==stack1||stack1===!1?stack1:stack1.unordered,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" tabindex="-1">\n    ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.fa),{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </a>\n    <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-command="insertOrderedList" title="'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.lists,stack1=null==stack1||stack1===!1?stack1:stack1.ordered,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" tabindex="-1">\n    ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.fa),{hash:{},inverse:self.program(9,program9,data),fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </a>\n    <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-command="Outdent" title="'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.lists,stack1=null==stack1||stack1===!1?stack1:stack1.outdent,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" tabindex="-1">\n    ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.fa),{hash:{},inverse:self.program(13,program13,data),fn:self.program(11,program11,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </a>\n    <a class="btn ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.size),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' btn-default" data-wysihtml5-command="Indent" title="'+escapeExpression((stack1=depth0&&depth0.locale,stack1=null==stack1||stack1===!1?stack1:stack1.lists,stack1=null==stack1||stack1===!1?stack1:stack1.indent,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" tabindex="-1">\n    ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.options,stack1=null==stack1||stack1===!1?stack1:stack1.toolbar,null==stack1||stack1===!1?stack1:stack1.fa),{hash:{},inverse:self.program(17,program17,data),fn:self.program(15,program15,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </a>\n  </div>\n</li>\n"}),function(factory){"use strict";"function"==typeof define&&define.amd?define("bootstrap.wysihtml5",["jquery","wysihtml5","bootstrap","bootstrap.wysihtml5.templates","bootstrap.wysihtml5.commands"],factory):factory(jQuery,wysihtml5)}(function($,wysihtml5){"use strict";var bsWysihtml5=function($,wysihtml5){var templates=function(key,locale,options){if(wysihtml5.tpl[key])return wysihtml5.tpl[key]({locale:locale,options:options})},Wysihtml5=function(el,options){this.el=el;var toolbarOpts=$.extend(!0,{},defaultOptions,options);for(var t in toolbarOpts.customTemplates)toolbarOpts.customTemplates.hasOwnProperty(t)&&(wysihtml5.tpl[t]=toolbarOpts.customTemplates[t]);this.toolbar=this.createToolbar(el,toolbarOpts),this.editor=this.createEditor(toolbarOpts)};Wysihtml5.prototype={constructor:Wysihtml5,createEditor:function(options){options=options||{},options=$.extend(!0,{},options),options.toolbar=this.toolbar[0],this.initializeEditor(this.el[0],options)},initializeEditor:function(el,options){var editor=new wysihtml5.Editor(this.el[0],options);if(editor.on("beforeload",this.syncBootstrapDialogEvents),editor.on("beforeload",this.loadParserRules),editor.composer.editableArea.contentDocument?this.addMoreShortcuts(editor,editor.composer.editableArea.contentDocument.body||editor.composer.editableArea.contentDocument,options.shortcuts):this.addMoreShortcuts(editor,editor.composer.editableArea,options.shortcuts),options&&options.events)for(var eventName in options.events)options.events.hasOwnProperty(eventName)&&editor.on(eventName,options.events[eventName]);return editor},loadParserRules:function(){"string"===$.type(this.config.parserRules)&&$.ajax({dataType:"json",url:this.config.parserRules,context:this,error:function(jqXHR,textStatus,errorThrown){},success:function(parserRules){this.config.parserRules=parserRules}}),this.config.pasteParserRulesets&&"string"===$.type(this.config.pasteParserRulesets)&&$.ajax({dataType:"json",url:this.config.pasteParserRulesets,context:this,error:function(jqXHR,textStatus,errorThrown){},success:function(pasteParserRulesets){this.config.pasteParserRulesets=pasteParserRulesets}})},syncBootstrapDialogEvents:function(){var editor=this;$.map(this.toolbar.commandMapping,function(value){return[value]}).filter(function(commandObj){return commandObj.dialog}).map(function(commandObj){return commandObj.dialog}).forEach(function(dialog){dialog.on("show",function(){$(this.container).modal("show")}),dialog.on("hide",function(){$(this.container).modal("hide"),setTimeout(editor.composer.focus,0)}),$(dialog.container).on("shown.bs.modal",function(){$(this).find("input, select, textarea").first().focus()})}),this.on("change_view",function(){$(this.toolbar.container.children).find("a.btn").not('[data-wysihtml5-action="change_view"]').toggleClass("disabled")})},createToolbar:function(el,options){var self=this,toolbar=$("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"}),culture=options.locale||defaultOptions.locale||"en";locale.hasOwnProperty(culture)||(culture="en");var localeObject=$.extend(!0,{},locale.en,locale[culture]);for(var key in options.toolbar)options.toolbar[key]&&toolbar.append(templates(key,localeObject,options));return toolbar.find('a[data-wysihtml5-command="formatBlock"]').click(function(e){var target=e.delegateTarget||e.target||e.srcElement,el=$(target),showformat=el.data("wysihtml5-display-format-name"),formatname=el.data("wysihtml5-format-name")||el.html();void 0!==showformat&&"true"!==showformat||self.toolbar.find(".current-font").text(formatname)}),toolbar.find('a[data-wysihtml5-command="foreColor"]').click(function(e){var target=e.target||e.srcElement,el=$(target);self.toolbar.find(".current-color").text(el.html())}),this.el.before(toolbar),toolbar},addMoreShortcuts:function(editor,el,shortcuts){wysihtml5.dom.observe(el,"keydown",function(event){var keyCode=event.keyCode,command=shortcuts[keyCode];if((event.ctrlKey||event.metaKey||event.altKey)&&command&&wysihtml5.commands[command]){var commandObj=editor.toolbar.commandMapping[command+":null"];commandObj&&commandObj.dialog&&!commandObj.state?commandObj.dialog.show():wysihtml5.commands[command].exec(editor.composer,command),event.preventDefault()}})}};var methods={resetDefaults:function(){$.fn.wysihtml5.defaultOptions=$.extend(!0,{},$.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(options){return this.each(function(){var $this=$(this);$this.data("wysihtml5",new Wysihtml5($this,options))})},shallowExtend:function(options){var settings=$.extend({},$.fn.wysihtml5.defaultOptions,options||{},$(this).data()),that=this;return methods.bypassDefaults.apply(that,[settings])},deepExtend:function(options){var settings=$.extend(!0,{},$.fn.wysihtml5.defaultOptions,options||{}),that=this;return methods.bypassDefaults.apply(that,[settings])},init:function(options){var that=this;return methods.shallowExtend.apply(that,[options])}};$.fn.wysihtml5=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.wysihtml5"):methods.init.apply(this,arguments)},$.fn.wysihtml5.Constructor=Wysihtml5;var defaultOptions=$.fn.wysihtml5.defaultOptions={toolbar:{"font-styles":!0,color:!1,emphasis:{small:!0},blockquote:!0,lists:!0,html:!1,link:!0,image:!0,smallmodals:!1},useLineBreaks:!1,parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},strong:{},em:{},p:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url"},set_attributes:{target:"_blank",rel:"nofollow"}},span:1,div:1,small:1,code:1,pre:1}},locale:"en",shortcuts:{83:"small",75:"createLink"}};"undefined"==typeof $.fn.wysihtml5.defaultOptionsCache&&($.fn.wysihtml5.defaultOptionsCache=$.extend(!0,{},$.fn.wysihtml5.defaultOptions));var locale=$.fn.wysihtml5.locale={}};bsWysihtml5($,wysihtml5)}),function(wysihtml5){wysihtml5.commands.small={exec:function(composer,command){return wysihtml5.commands.formatInline.exec(composer,command,"small")},state:function(composer,command){return wysihtml5.commands.formatInline.state(composer,command,"small")}}}(wysihtml5),function(factory){"function"==typeof define&&define.amd?define("bootstrap.wysihtml5.en-US",["jquery","bootstrap.wysihtml5"],factory):factory(jQuery)}(function($){$.fn.wysihtml5.locale.en=$.fn.wysihtml5.locale["en-US"]={font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline",small:"Small"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},html:{edit:"Edit HTML"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}});